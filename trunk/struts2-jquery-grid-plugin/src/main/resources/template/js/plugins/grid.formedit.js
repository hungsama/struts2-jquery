/**
 * jqGrid extension for form editing Grid Data
 * Tony Tomov tony@trirand.com
 * http://trirand.com/blog/
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl-2.0.html
**/
(function(b){var a=null;b.jgrid.extend({searchGrid:function(c){c=b.extend({recreateFilter:false,drag:true,sField:"searchField",sValue:"searchString",sOper:"searchOper",sFilter:"filters",loadDefaults:true,beforeShowSearch:null,afterShowSearch:null,onInitializeSearch:null,closeAfterSearch:false,closeAfterReset:false,closeOnEscape:false,multipleSearch:false,cloneSearchRowOnAdd:true,sopt:null,stringResult:undefined,onClose:null,useDataProxy:false,overlay:true},b.jgrid.search,c||{});return this.each(function(){var l=this;if(!l.grid){return}var g="fbox_"+l.p.id;function u(x,w){var k=x.p.postData[w.sFilter];if(typeof(k)=="string"){k=b.jgrid.parse(k)}if(k){if(k.groupOp){x.SearchFilter.setGroupOp(k.groupOp)}if(k.rules){var y,j=0,e=k.rules.length,z=false;for(;j<e;j++){y=k.rules[j];if(y.field!==undefined&&y.op!==undefined&&y.data!==undefined){z=x.SearchFilter.setFilter({sfref:x.SearchFilter.$.find(".sf:last"),filter:b.extend({},y)});if(z){x.SearchFilter.add()}}}}}}function d(e){if(c.onClose){var j=c.onClose(e);if(typeof j=="boolean"&&!j){return}}e.hide();if(c.overlay===true){b(".jqgrid-overlay:first","#gbox_"+l.p.id).hide()}}function f(){var k=b(".ui-searchFilter").length;if(k>1){var j=b("#"+g).css("zIndex");b("#"+g).css({zIndex:parseInt(j,10)+k})}b("#"+g).show();if(c.overlay===true){b(".jqgrid-overlay:first","#gbox_"+l.p.id).show()}try{b(":input:visible","#"+g)[0].focus()}catch(e){}}function s(w){var e=(w!==undefined),k=b("#"+l.p.id),j={};if(c.multipleSearch===false){j[c.sField]=w.rules[0].field;j[c.sValue]=w.rules[0].data;j[c.sOper]=w.rules[0].op}else{j[c.sFilter]=w}k[0].p.search=e;b.extend(k[0].p.postData,j);k.trigger("reloadGrid",[{page:1}]);if(c.closeAfterSearch){d(b("#"+g))}}function m(w){var k=w&&w.hasOwnProperty("reload")?w.reload:true,j=b("#"+l.p.id),e={};j[0].p.search=false;if(c.multipleSearch===false){e[c.sField]=e[c.sValue]=e[c.sOper]=""}else{e[c.sFilter]=""}b.extend(j[0].p.postData,e);if(k){j.trigger("reloadGrid",[{page:1}])}if(c.closeAfterReset){d(b("#"+g))}}if(b.fn.searchFilter){if(c.recreateFilter===true){b("#"+g).remove()}if(b("#"+g).html()!=null){if(b.isFunction(c.beforeShowSearch)){c.beforeShowSearch(b("#"+g))}f();if(b.isFunction(c.afterShowSearch)){c.afterShowSearch(b("#"+g))}}else{var n=[],v=b("#"+l.p.id).jqGrid("getGridParam","colNames"),r=b("#"+l.p.id).jqGrid("getGridParam","colModel"),t=["eq","ne","lt","le","gt","ge","bw","bn","in","ni","ew","en","cn","nc"],i,q,h,p=[];if(c.sopt!==null){h=0;for(i=0;i<c.sopt.length;i++){if((q=b.inArray(c.sopt[i],t))!=-1){p[h]={op:c.sopt[i],text:c.odata[q]};h++}}}else{for(i=0;i<t.length;i++){p[i]={op:t[i],text:c.odata[i]}}}b.each(r,function(x,C){var z=(typeof C.search==="undefined")?true:C.search,y=(C.hidden===true),k=b.extend({},{text:v[x],itemval:C.index||C.name},this.searchoptions),w=(k.searchhidden===true);if(typeof k.sopt!=="undefined"){h=0;k.ops=[];if(k.sopt.length>0){for(i=0;i<k.sopt.length;i++){if((q=b.inArray(k.sopt[i],t))!=-1){k.ops[h]={op:k.sopt[i],text:c.odata[q]};h++}}}}if(typeof(this.stype)==="undefined"){this.stype="text"}if(this.stype=="select"){if(k.dataUrl!==undefined){}else{var j;if(k.value){j=k.value}else{if(this.editoptions){j=this.editoptions.value}}if(j){k.dataValues=[];if(typeof(j)==="string"){var e=j.split(";"),B;for(i=0;i<e.length;i++){B=e[i].split(":");k.dataValues[i]={value:B[0],text:B[1]}}}else{if(typeof(j)==="object"){i=0;for(var A in j){if(j.hasOwnProperty(A)){k.dataValues[i]={value:A,text:j[A]};i++}}}}}}}if((w&&z)||(z&&!y)){n.push(k)}});if(n.length>0){b("<div id='"+g+"' role='dialog' tabindex='-1'></div>").insertBefore("#gview_"+l.p.id);if(c.stringResult===undefined){c.stringResult=c.multipleSearch}l.SearchFilter=b("#"+g).searchFilter(n,{groupOps:c.groupOps,operators:p,onClose:d,resetText:c.Reset,searchText:c.Find,windowTitle:c.caption,rulesText:c.rulesText,matchText:c.matchText,onSearch:s,onReset:m,stringResult:c.stringResult,ajaxSelectOptions:b.extend({},b.jgrid.ajaxOptions,l.p.ajaxSelectOptions||{}),clone:c.cloneSearchRowOnAdd});b(".ui-widget-overlay","#"+g).remove();if(l.p.direction=="rtl"){b(".ui-closer","#"+g).css("float","left")}if(c.drag===true){b("#"+g+" table thead tr:first td:first").css("cursor","move");if(jQuery.fn.jqDrag){b("#"+g).jqDrag(b("#"+g+" table thead tr:first td:first"))}else{try{b("#"+g).draggable({handle:b("#"+g+" table thead tr:first td:first")})}catch(o){}}}if(c.multipleSearch===false){b(".ui-del, .ui-add, .ui-del, .ui-add-last, .matchText, .rulesText","#"+g).hide();b("select[name='groupOp']","#"+g).hide()}if(c.multipleSearch===true&&c.loadDefaults===true){u(l,c)}if(b.isFunction(c.onInitializeSearch)){c.onInitializeSearch(b("#"+g))}if(b.isFunction(c.beforeShowSearch)){c.beforeShowSearch(b("#"+g))}f();if(b.isFunction(c.afterShowSearch)){c.afterShowSearch(b("#"+g))}if(c.closeOnEscape===true){b("#"+g).keydown(function(j){if(j.which==27){d(b("#"+g))}})}}}}})},editGridRow:function(c,d){d=b.extend({top:0,left:0,width:300,height:"auto",dataheight:"auto",modal:false,drag:true,resize:true,url:null,mtype:"POST",clearAfterAdd:true,closeAfterEdit:false,reloadAfterSubmit:true,onInitializeForm:null,beforeInitData:null,beforeShowForm:null,afterShowForm:null,beforeSubmit:null,afterSubmit:null,onclickSubmit:null,afterComplete:null,onclickPgButtons:null,afterclickPgButtons:null,editData:{},recreateForm:false,jqModal:true,closeOnEscape:false,addedrow:"first",topinfo:"",bottominfo:"",saveicon:[],closeicon:[],savekey:[false,13],navkeys:[false,38,40],checkOnSubmit:false,checkOnUpdate:false,_savedData:{},processing:false,onClose:null,ajaxEditOptions:{},serializeEditData:null,viewPagerButtons:true},b.jgrid.edit,d||{});a=d;return this.each(function(){var e=this;if(!e.grid||!c){return}var A=e.p.id,x="FrmGrid_"+A,u="TblGrid_"+A,i={themodal:"editmod"+A,modalhead:"edithd"+A,modalcontent:"editcnt"+A,scrollelm:x},B=b.isFunction(a.beforeShowForm)?a.beforeShowForm:false,L=b.isFunction(a.afterShowForm)?a.afterShowForm:false,K=b.isFunction(a.beforeInitData)?a.beforeInitData:false,o=b.isFunction(a.onInitializeForm)?a.onInitializeForm:false,F=null,G=1,q=0,C,O,E,z;if(c=="new"){c="_empty";d.caption=d.addCaption}else{d.caption=d.editCaption}if(d.recreateForm===true&&b("#"+i.themodal).html()!=null){b("#"+i.themodal).remove()}var k=true;if(d.checkOnUpdate&&d.jqModal&&!d.modal){k=false}function T(){b(".FormElement","#"+u).each(function(X){var aa=b(".customelement",this);if(aa.length){var Y=aa[0],V=b(Y).attr("name");b.each(e.p.colModel,function(ab,ad){if(this.name==V&&this.editoptions&&b.isFunction(this.editoptions.custom_value)){try{C[V]=this.editoptions.custom_value(b("#"+V,"#"+u),"get");if(C[V]===undefined){throw"e1"}}catch(ac){if(ac=="e1"){info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+b.jgrid.edit.msg.novalue,jQuery.jgrid.edit.bClose)}else{info_dialog(jQuery.jgrid.errors.errcap,ac.message,jQuery.jgrid.edit.bClose)}}return true}})}else{switch(b(this).get(0).type){case"checkbox":if(b(this).attr("checked")){C[this.name]=b(this).val()}else{var W=b(this).attr("offval");C[this.name]=W}break;case"select-one":C[this.name]=b("option:selected",this).val();O[this.name]=b("option:selected",this).text();break;case"select-multiple":C[this.name]=b(this).val();if(C[this.name]){C[this.name]=C[this.name].join(",")}else{C[this.name]=""}var Z=[];b("option:selected",this).each(function(ab,ac){Z[ab]=b(ac).text()});O[this.name]=Z.join(",");break;case"password":case"text":case"textarea":case"button":C[this.name]=b(this).val();break}if(e.p.autoencode){C[this.name]=b.jgrid.htmlEncode(C[this.name])}}});return true}function s(X,ae,ab,Z){var al,af,W,aa=0,ad,ak,V,ah=[],Y=false,ag="<td class='CaptionTD ui-widget-content'>&#160;</td><td class='DataTD ui-widget-content' style='white-space:pre'>&#160;</td>",aj="";for(var ac=1;ac<=Z;ac++){aj+=ag}if(X!="_empty"){Y=b(ae).jqGrid("getInd",X)}b(ae.p.colModel).each(function(ao){al=this.name;if(this.editrules&&this.editrules.edithidden===true){af=false}else{af=this.hidden===true?true:false}ak=af?"style='display:none'":"";if(al!=="cb"&&al!=="subgrid"&&this.editable===true&&al!=="rn"){if(Y===false){ad=""}else{if(al==ae.p.ExpandColumn&&ae.p.treeGrid===true){ad=b("td:eq("+ao+")",ae.rows[Y]).text()}else{try{ad=b.unformat(b("td:eq("+ao+")",ae.rows[Y]),{rowId:X,colModel:this},ao)}catch(am){ad=b("td:eq("+ao+")",ae.rows[Y]).html()}}}var an=b.extend({},this.editoptions||{},{id:al,name:al}),at=b.extend({},{elmprefix:"",elmsuffix:"",rowabove:false,rowcontent:""},this.formoptions||{}),ap=parseInt(at.rowpos,10)||aa+1,ar=parseInt((parseInt(at.colpos,10)||1)*2,10);if(X=="_empty"&&an.defaultValue){ad=b.isFunction(an.defaultValue)?an.defaultValue():an.defaultValue}if(!this.edittype){this.edittype="text"}if(e.p.autoencode){ad=b.jgrid.htmlDecode(ad)}V=createEl(this.edittype,an,ad,false,b.extend({},b.jgrid.ajaxOptions,ae.p.ajaxSelectOptions||{}));if(ad===""&&this.edittype=="checkbox"){ad=b(V).attr("offval")}if(ad===""&&this.edittype=="select"){ad=b("option:eq(0)",V).text()}if(a.checkOnSubmit||a.checkOnUpdate){a._savedData[al]=ad}b(V).addClass("FormElement");W=b(ab).find("tr[rowpos="+ap+"]");if(at.rowabove){var aq=b("<tr><td class='contentinfo' colspan='"+(Z*2)+"'>"+at.rowcontent+"</td></tr>");b(ab).append(aq);aq[0].rp=ap}if(W.length===0){W=b("<tr "+ak+" rowpos='"+ap+"'></tr>").addClass("FormData").attr("id","tr_"+al);b(W).append(aj);b(ab).append(W);W[0].rp=ap}b("td:eq("+(ar-2)+")",W[0]).html(typeof at.label==="undefined"?ae.p.colNames[ao]:at.label);b("td:eq("+(ar-1)+")",W[0]).append(at.elmprefix).append(V).append(at.elmsuffix);ah[aa]=ao;aa++}});if(aa>0){var ai=b("<tr class='FormData' style='display:none'><td class='CaptionTD'></td><td colspan='"+(Z*2-1)+"' class='DataTD'><input class='FormElement' id='id_g' type='text' name='"+ae.p.id+"_id' value='"+X+"'/></td></tr>");ai[0].rp=aa+999;b(ab).append(ai);if(a.checkOnSubmit||a.checkOnUpdate){a._savedData[ae.p.id+"_id"]=X}}return ah}function p(V,ac,Y){var ag,Z=0,ad,ab,W,aa,ae;if(a.checkOnSubmit||a.checkOnUpdate){a._savedData={};a._savedData[ac.p.id+"_id"]=V}var af=ac.p.colModel;if(V=="_empty"){b(af).each(function(ah){ag=this.name;W=b.extend({},this.editoptions||{});ab=b("#"+b.jgrid.jqID(ag),"#"+Y);if(ab[0]!=null){aa="";if(W.defaultValue){aa=b.isFunction(W.defaultValue)?W.defaultValue():W.defaultValue;if(ab[0].type=="checkbox"){ae=aa.toLowerCase();if(ae.search(/(false|0|no|off|undefined)/i)<0&&ae!==""){ab[0].checked=true;ab[0].defaultChecked=true;ab[0].value=aa}else{ab.attr({checked:"",defaultChecked:""})}}else{ab.val(aa)}}else{if(ab[0].type=="checkbox"){ab[0].checked=false;ab[0].defaultChecked=false;aa=b(ab).attr("offval")}else{if(ab[0].type&&ab[0].type.substr(0,6)=="select"){ab[0].selectedIndex=0}else{ab.val(aa)}}}if(a.checkOnSubmit===true||a.checkOnUpdate){a._savedData[ag]=aa}}});b("#id_g","#"+Y).val(V);return}var X=b(ac).jqGrid("getInd",V,true);if(!X){return}b("td",X).each(function(ak){ag=af[ak].name;if(ag!=="cb"&&ag!=="subgrid"&&ag!=="rn"&&af[ak].editable===true){if(ag==ac.p.ExpandColumn&&ac.p.treeGrid===true){ad=b(this).text()}else{try{ad=b.unformat(b(this),{rowId:V,colModel:af[ak]},ak)}catch(aj){ad=b(this).html()}}if(e.p.autoencode){ad=b.jgrid.htmlDecode(ad)}if(a.checkOnSubmit===true||a.checkOnUpdate){a._savedData[ag]=ad}ag=b.jgrid.jqID(ag);switch(af[ak].edittype){case"password":case"text":case"button":case"image":b("#"+ag,"#"+Y).val(ad);break;case"textarea":if(ad=="&nbsp;"||ad=="&#160;"||(ad.length==1&&ad.charCodeAt(0)==160)){ad=""}b("#"+ag,"#"+Y).val(ad);break;case"select":var ai=ad.split(",");ai=b.map(ai,function(am){return b.trim(am)});b("#"+ag+" option","#"+Y).each(function(am){if(!af[ak].editoptions.multiple&&(ai[0]==b.trim(b(this).text())||ai[0]==b.trim(b(this).val()))){this.selected=true}else{if(af[ak].editoptions.multiple){if(b.inArray(b.trim(b(this).text()),ai)>-1||b.inArray(b.trim(b(this).val()),ai)>-1){this.selected=true}else{this.selected=false}}else{this.selected=false}}});break;case"checkbox":ad=ad+"";if(af[ak].editoptions&&af[ak].editoptions.value){var ah=af[ak].editoptions.value.split(":");if(ah[0]==ad){b("#"+ag,"#"+Y).attr("checked",true);b("#"+ag,"#"+Y).attr("defaultChecked",true)}else{b("#"+ag,"#"+Y).attr("checked",false);b("#"+ag,"#"+Y).attr("defaultChecked","")}}else{ad=ad.toLowerCase();if(ad.search(/(false|0|no|off|undefined)/i)<0&&ad!==""){b("#"+ag,"#"+Y).attr("checked",true);b("#"+ag,"#"+Y).attr("defaultChecked",true)}else{b("#"+ag,"#"+Y).attr("checked",false);b("#"+ag,"#"+Y).attr("defaultChecked","")}}break;case"custom":try{if(af[ak].editoptions&&b.isFunction(af[ak].editoptions.custom_value)){af[ak].editoptions.custom_value(b("#"+ag,"#"+Y),"set",ad)}else{throw"e1"}}catch(al){if(al=="e1"){info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+b.jgrid.edit.msg.nodefined,jQuery.jgrid.edit.bClose)}else{info_dialog(jQuery.jgrid.errors.errcap,al.message,jQuery.jgrid.edit.bClose)}}break}Z++}});if(Z>0){b("#id_g","#"+u).val(V)}}function j(){var Y=[true,"",""],X={},ab=e.p.prmNames,aa,ac;if(b.isFunction(a.beforeCheckValues)){var W=a.beforeCheckValues(C,b("#"+x),C[e.p.id+"_id"]=="_empty"?ab.addoper:ab.editoper);if(W&&typeof(W)==="object"){C=W}}for(var Z in C){if(C.hasOwnProperty(Z)){Y=checkValues(C[Z],Z,e);if(Y[0]===false){break}}}if(Y[0]){if(b.isFunction(a.onclickSubmit)){X=a.onclickSubmit(a,C)||{}}if(b.isFunction(a.beforeSubmit)){Y=a.beforeSubmit(C,b("#"+x))}}if(Y[0]&&!a.processing){a.processing=true;b("#sData","#"+u+"_2").addClass("ui-state-active");ac=ab.oper;aa=ab.id;C[ac]=(b.trim(C[e.p.id+"_id"])=="_empty")?ab.addoper:ab.editoper;if(C[ac]!=ab.addoper){C[aa]=C[e.p.id+"_id"]}else{if(C[aa]===undefined){C[aa]=C[e.p.id+"_id"]}}delete C[e.p.id+"_id"];C=b.extend(C,a.editData,X);var V=b.extend({url:a.url?a.url:b(e).jqGrid("getGridParam","editurl"),type:a.mtype,data:b.isFunction(a.serializeEditData)?a.serializeEditData(C):C,complete:function(af,ad){if(ad!="success"){Y[0]=false;if(b.isFunction(a.errorTextFormat)){Y[1]=a.errorTextFormat(af)}else{Y[1]=ad+" Status: '"+af.statusText+"'. Error code: "+af.status}}else{if(b.isFunction(a.afterSubmit)){Y=a.afterSubmit(af,C)}}if(Y[0]===false){b("#FormError>td","#"+u).html(Y[1]);b("#FormError","#"+u).show()}else{b.each(e.p.colModel,function(ah,aj){if(O[this.name]&&this.formatter&&this.formatter=="select"){try{delete O[this.name]}catch(ai){}}});C=b.extend(C,O);if(e.p.autoencode){b.each(C,function(ai,ah){C[ai]=b.jgrid.htmlDecode(ah)})}a.reloadAfterSubmit=a.reloadAfterSubmit&&e.p.datatype!="local";if(C[ac]==ab.addoper){if(!Y[2]){Y[2]=(parseInt(e.p.records,10)+1)+""}C[aa]=Y[2];if(a.closeAfterAdd){if(a.reloadAfterSubmit){b(e).trigger("reloadGrid")}else{b(e).jqGrid("addRowData",Y[2],C,d.addedrow);b(e).jqGrid("setSelection",Y[2])}hideModal("#"+i.themodal,{gb:"#gbox_"+A,jqm:d.jqModal,onClose:a.onClose})}else{if(a.clearAfterAdd){if(a.reloadAfterSubmit){b(e).trigger("reloadGrid")}else{b(e).jqGrid("addRowData",Y[2],C,d.addedrow)}p("_empty",e,x)}else{if(a.reloadAfterSubmit){b(e).trigger("reloadGrid")}else{b(e).jqGrid("addRowData",Y[2],C,d.addedrow)}}}}else{if(a.reloadAfterSubmit){b(e).trigger("reloadGrid");if(!a.closeAfterEdit){setTimeout(function(){b(e).jqGrid("setSelection",C[aa])},1000)}}else{if(e.p.treeGrid===true){b(e).jqGrid("setTreeRow",C[aa],C)}else{b(e).jqGrid("setRowData",C[aa],C)}}if(a.closeAfterEdit){hideModal("#"+i.themodal,{gb:"#gbox_"+A,jqm:d.jqModal,onClose:a.onClose})}}if(b.isFunction(a.afterComplete)){F=af;setTimeout(function(){a.afterComplete(F,C,b("#"+x));F=null},500)}}a.processing=false;if(a.checkOnSubmit||a.checkOnUpdate){b("#"+x).data("disabled",false);if(a._savedData[e.p.id+"_id"]!="_empty"){for(var ae in a._savedData){if(C[ae]){a._savedData[ae]=C[ae]}}}}b("#sData","#"+u+"_2").removeClass("ui-state-active");try{b(":input:visible","#"+x)[0].focus()}catch(ag){}},error:function(af,ad,ae){b("#FormError>td","#"+u).html(ad+" : "+ae);b("#FormError","#"+u).show();a.processing=false;b("#"+x).data("disabled",false);b("#sData","#"+u+"_2").removeClass("ui-state-active")}},b.jgrid.ajaxOptions,a.ajaxEditOptions);if(!V.url&&!a.useDataProxy){if(b.isFunction(e.p.dataProxy)){a.useDataProxy=true}else{Y[0]=false;Y[1]+=" "+b.jgrid.errors.nourl}}if(Y[0]){if(a.useDataProxy){e.p.dataProxy.call(e,V,"set_"+e.p.id)}else{b.ajax(V)}}}if(Y[0]===false){b("#FormError>td","#"+u).html(Y[1]);b("#FormError","#"+u).show()}}function I(Y,V){var W=false,X;for(X in Y){if(Y[X]!=V[X]){W=true;break}}return W}function g(){var V=true;b("#FormError","#"+u).hide();if(a.checkOnUpdate){C={};O={};T();E=b.extend({},C,O);z=I(E,a._savedData);if(z){b("#"+x).data("disabled",true);b(".confirm","#"+i.themodal).show();V=false}}return V}if(b("#"+i.themodal).html()!=null){b(".ui-jqdialog-title","#"+i.modalhead).html(d.caption);b("#FormError","#"+u).hide();if(a.topinfo){b(".topinfo","#"+u+"_2").html(a.topinfo);b(".tinfo","#"+u+"_2").show()}else{b(".tinfo","#"+u+"_2").hide()}if(a.bottominfo){b(".bottominfo","#"+u+"_2").html(a.bottominfo);b(".binfo","#"+u+"_2").show()}else{b(".binfo","#"+u+"_2").hide()}if(K){K(b("#"+x))}p(c,e,x);if(c=="_empty"||!a.viewPagerButtons){b("#pData, #nData","#"+u+"_2").hide()}else{b("#pData, #nData","#"+u+"_2").show()}if(a.processing===true){a.processing=false;b("#sData","#"+u+"_2").removeClass("ui-state-active")}if(b("#"+x).data("disabled")===true){b(".confirm","#"+i.themodal).hide();b("#"+x).data("disabled",false)}if(B){B(b("#"+x))}b("#"+i.themodal).data("onClose",a.onClose);viewModal("#"+i.themodal,{gbox:"#gbox_"+A,jqm:d.jqModal,jqM:false,closeoverlay:k,modal:d.modal});if(!k){b(".jqmOverlay").click(function(){if(!g()){return false}hideModal("#"+i.themodal,{gb:"#gbox_"+A,jqm:d.jqModal,onClose:a.onClose});return false})}if(L){L(b("#"+x))}}else{b(e.p.colModel).each(function(V){var W=this.formoptions;G=Math.max(G,W?W.colpos||0:0);q=Math.max(q,W?W.rowpos||0:0)});var r=isNaN(d.dataheight)?d.dataheight:d.dataheight+"px",R=b("<form name='FormPost' id='"+x+"' class='FormGrid' onSubmit='return false;' style='width:100%;overflow:auto;position:relative;height:"+r+";'></form>").data("disabled",false),y=b("<table id='"+u+"' class='EditTable' cellspacing='0' cellpading='0' border='0'><tbody></tbody></table>");b(R).append(y);var J=b("<tr id='FormError' style='display:none'><td class='ui-state-error' colspan='"+(G*2)+"'></td></tr>");J[0].rp=0;b(y).append(J);J=b("<tr style='display:none' class='tinfo'><td class='topinfo' colspan='"+(G*2)+"'>"+a.topinfo+"</td></tr>");J[0].rp=0;b(y).append(J);if(K){K(b("#"+x))}var f=e.p.direction=="rtl"?true:false,Q=f?"nData":"pData",S=f?"pData":"nData";s(c,e,y,G);var l="<a href='javascript:void(0)' id='"+Q+"' class='fm-button ui-state-default ui-corner-left'><span class='ui-icon ui-icon-triangle-1-w'></span></div>",m="<a href='javascript:void(0)' id='"+S+"' class='fm-button ui-state-default ui-corner-right'><span class='ui-icon ui-icon-triangle-1-e'></span></div>",h="<a href='javascript:void(0)' id='sData' class='fm-button ui-state-default ui-corner-all'>"+d.bSubmit+"</a>",t="<a href='javascript:void(0)' id='cData' class='fm-button ui-state-default ui-corner-all'>"+d.bCancel+"</a>";var N="<table border='0' class='EditTable' id='"+u+"_2'><tbody><tr id='Act_Buttons'><td class='navButton ui-widget-content'>"+(f?m+l:l+m)+"</td><td class='EditButton ui-widget-content'>"+h+t+"</td></tr>";N+="<tr style='display:none' class='binfo'><td class='bottominfo' colspan='2'>"+a.bottominfo+"</td></tr>";N+="</tbody></table>";if(q>0){var w=[];b.each(b(y)[0].rows,function(V,W){w[V]=W});w.sort(function(W,V){if(W.rp>V.rp){return 1}if(W.rp<V.rp){return -1}return 0});b.each(w,function(V,W){b("tbody",y).append(W)})}d.gbox="#gbox_"+A;var n=false;if(d.closeOnEscape===true){d.closeOnEscape=false;n=true}var M=b("<span></span>").append(R).append(N);createModal(i,M,d,"#gview_"+e.p.id,b("#gbox_"+e.p.id)[0]);if(f){b("#pData, #nData","#"+u+"_2").css("float","right");b(".EditButton","#"+u+"_2").css("text-align","left")}if(a.topinfo){b(".tinfo","#"+u+"_2").show()}if(a.bottominfo){b(".binfo","#"+u+"_2").show()}M=null;N=null;b("#"+i.themodal).keydown(function(V){var W=V.target;if(b("#"+x).data("disabled")===true){return false}if(a.savekey[0]===true&&V.which==a.savekey[1]){if(W.tagName!="TEXTAREA"){b("#sData","#"+u+"_2").trigger("click");return false}}if(V.which===27){if(!g()){return false}if(n){hideModal(this,{gb:d.gbox,jqm:d.jqModal,onClose:a.onClose})}return false}if(a.navkeys[0]===true){if(b("#id_g","#"+u).val()=="_empty"){return true}if(V.which==a.navkeys[1]){b("#pData","#"+u+"_2").trigger("click");return false}if(V.which==a.navkeys[2]){b("#nData","#"+u+"_2").trigger("click");return false}}});if(d.checkOnUpdate){b("a.ui-jqdialog-titlebar-close span","#"+i.themodal).removeClass("jqmClose");b("a.ui-jqdialog-titlebar-close","#"+i.themodal).unbind("click").click(function(){if(!g()){return false}hideModal("#"+i.themodal,{gb:"#gbox_"+A,jqm:d.jqModal,onClose:a.onClose});return false})}d.saveicon=b.extend([true,"left","ui-icon-disk"],d.saveicon);d.closeicon=b.extend([true,"left","ui-icon-close"],d.closeicon);if(d.saveicon[0]===true){b("#sData","#"+u+"_2").addClass(d.saveicon[1]=="right"?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+d.saveicon[2]+"'></span>")}if(d.closeicon[0]===true){b("#cData","#"+u+"_2").addClass(d.closeicon[1]=="right"?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+d.closeicon[2]+"'></span>")}if(a.checkOnSubmit||a.checkOnUpdate){h="<a href='javascript:void(0)' id='sNew' class='fm-button ui-state-default ui-corner-all' style='z-index:1002'>"+d.bYes+"</a>";m="<a href='javascript:void(0)' id='nNew' class='fm-button ui-state-default ui-corner-all' style='z-index:1002'>"+d.bNo+"</a>";t="<a href='javascript:void(0)' id='cNew' class='fm-button ui-state-default ui-corner-all' style='z-index:1002'>"+d.bExit+"</a>";var D,v=d.zIndex||999;v++;if(b.browser.msie&&b.browser.version==6){D='<iframe style="display:block;position:absolute;z-index:-1;filter:Alpha(Opacity=\'0\');" src="javascript:false;"></iframe>'}else{D=""}b("<div class='ui-widget-overlay jqgrid-overlay confirm' style='z-index:"+v+";display:none;'>&#160;"+D+"</div><div class='confirm ui-widget-content ui-jqconfirm' style='z-index:"+(v+1)+"'>"+d.saveData+"<br/><br/>"+h+m+t+"</div>").insertAfter("#"+x);b("#sNew","#"+i.themodal).click(function(){j();b("#"+x).data("disabled",false);b(".confirm","#"+i.themodal).hide();return false});b("#nNew","#"+i.themodal).click(function(){b(".confirm","#"+i.themodal).hide();b("#"+x).data("disabled",false);setTimeout(function(){b(":input","#"+x)[0].focus()},0);return false});b("#cNew","#"+i.themodal).click(function(){b(".confirm","#"+i.themodal).hide();b("#"+x).data("disabled",false);hideModal("#"+i.themodal,{gb:"#gbox_"+A,jqm:d.jqModal,onClose:a.onClose});return false})}if(o){o(b("#"+x))}if(c=="_empty"||!a.viewPagerButtons){b("#pData,#nData","#"+u+"_2").hide()}else{b("#pData,#nData","#"+u+"_2").show()}if(B){B(b("#"+x))}b("#"+i.themodal).data("onClose",a.onClose);viewModal("#"+i.themodal,{gbox:"#gbox_"+A,jqm:d.jqModal,closeoverlay:k,modal:d.modal});if(!k){b(".jqmOverlay").click(function(){if(!g()){return false}hideModal("#"+i.themodal,{gb:"#gbox_"+A,jqm:d.jqModal,onClose:a.onClose});return false})}if(L){L(b("#"+x))}b(".fm-button","#"+i.themodal).hover(function(){b(this).addClass("ui-state-hover")},function(){b(this).removeClass("ui-state-hover")});b("#sData","#"+u+"_2").click(function(V){C={};O={};b("#FormError","#"+u).hide();T();if(C[e.p.id+"_id"]=="_empty"){j()}else{if(d.checkOnSubmit===true){E=b.extend({},C,O);z=I(E,a._savedData);if(z){b("#"+x).data("disabled",true);b(".confirm","#"+i.themodal).show()}else{j()}}else{j()}}return false});b("#cData","#"+u+"_2").click(function(V){if(!g()){return false}hideModal("#"+i.themodal,{gb:"#gbox_"+A,jqm:d.jqModal,onClose:a.onClose});return false});b("#nData","#"+u+"_2").click(function(V){if(!g()){return false}b("#FormError","#"+u).hide();var W=U();W[0]=parseInt(W[0],10);if(W[0]!=-1&&W[1][W[0]+1]){if(b.isFunction(d.onclickPgButtons)){d.onclickPgButtons("next",b("#"+x),W[1][W[0]])}p(W[1][W[0]+1],e,x);b(e).jqGrid("setSelection",W[1][W[0]+1]);if(b.isFunction(d.afterclickPgButtons)){d.afterclickPgButtons("next",b("#"+x),W[1][W[0]+1])}H(W[0]+1,W[1].length-1)}return false});b("#pData","#"+u+"_2").click(function(W){if(!g()){return false}b("#FormError","#"+u).hide();var V=U();if(V[0]!=-1&&V[1][V[0]-1]){if(b.isFunction(d.onclickPgButtons)){d.onclickPgButtons("prev",b("#"+x),V[1][V[0]])}p(V[1][V[0]-1],e,x);b(e).jqGrid("setSelection",V[1][V[0]-1]);if(b.isFunction(d.afterclickPgButtons)){d.afterclickPgButtons("prev",b("#"+x),V[1][V[0]-1])}H(V[0]-1,V[1].length-1)}return false})}function H(W,X,V){if(W===0){b("#pData","#"+u+"_2").addClass("ui-state-disabled")}else{b("#pData","#"+u+"_2").removeClass("ui-state-disabled")}if(W==X){b("#nData","#"+u+"_2").addClass("ui-state-disabled")}else{b("#nData","#"+u+"_2").removeClass("ui-state-disabled")}}function U(){var W=b(e).jqGrid("getDataIDs"),V=b("#id_g","#"+u).val(),X=b.inArray(V,W);return[X,W]}var P=U();H(P[0],P[1].length-1)})},viewGridRow:function(c,d){d=b.extend({top:0,left:0,width:0,height:"auto",dataheight:"auto",modal:false,drag:true,resize:true,jqModal:true,closeOnEscape:false,labelswidth:"30%",closeicon:[],navkeys:[false,38,40],onClose:null,beforeShowForm:null,viewPagerButtons:true},b.jgrid.view,d||{});return this.each(function(){var v=this;if(!v.grid||!c){return}if(!d.imgpath){d.imgpath=v.p.imgpath}var r=v.p.id,y="ViewGrid_"+r,s="ViewTbl_"+r,j={themodal:"viewmod"+r,modalhead:"viewhd"+r,modalcontent:"viewcnt"+r,scrollelm:y},h=1,f=0;function k(){if(d.closeOnEscape===true||d.navkeys[0]===true){setTimeout(function(){b(".ui-jqdialog-titlebar-close","#"+j.modalhead).focus()},0)}}function n(I,O,M,U){var E,H,P,S=0,X,Y,W=[],N=false,J="<td class='CaptionTD form-view-label ui-widget-content' width='"+d.labelswidth+"'>&#160;</td><td class='DataTD form-view-data ui-helper-reset ui-widget-content'>&#160;</td>",L="",F="<td class='CaptionTD form-view-label ui-widget-content'>&#160;</td><td class='DataTD form-view-data ui-widget-content'>&#160;</td>",K=["integer","number","currency"],R=0,Q=0,G,D,V;for(var T=1;T<=U;T++){L+=T==1?J:F}b(O.p.colModel).each(function(aa){if(this.editrules&&this.editrules.edithidden===true){H=false}else{H=this.hidden===true?true:false}if(!H&&this.align==="right"){if(this.formatter&&b.inArray(this.formatter,K)!==-1){R=Math.max(R,parseInt(this.width,10))}else{Q=Math.max(Q,parseInt(this.width,10))}}});G=R!==0?R:Q!==0?Q:0;N=b(O).jqGrid("getInd",I);b(O.p.colModel).each(function(ab){E=this.name;D=false;if(this.editrules&&this.editrules.edithidden===true){H=false}else{H=this.hidden===true?true:false}Y=H?"style='display:none'":"";V=(typeof this.viewable!="boolean")?true:this.viewable;if(E!=="cb"&&E!=="subgrid"&&E!=="rn"&&V){if(N===false){X=""}else{if(E==O.p.ExpandColumn&&O.p.treeGrid===true){X=b("td:eq("+ab+")",O.rows[N]).text()}else{X=b("td:eq("+ab+")",O.rows[N]).html()}}D=this.align==="right"&&G!==0?true:false;var aa=b.extend({},this.editoptions||{},{id:E,name:E}),af=b.extend({},{rowabove:false,rowcontent:""},this.formoptions||{}),ac=parseInt(af.rowpos,10)||S+1,ae=parseInt((parseInt(af.colpos,10)||1)*2,10);if(af.rowabove){var ad=b("<tr><td class='contentinfo' colspan='"+(U*2)+"'>"+af.rowcontent+"</td></tr>");b(M).append(ad);ad[0].rp=ac}P=b(M).find("tr[rowpos="+ac+"]");if(P.length===0){P=b("<tr "+Y+" rowpos='"+ac+"'></tr>").addClass("FormData").attr("id","trv_"+E);b(P).append(L);b(M).append(P);P[0].rp=ac}b("td:eq("+(ae-2)+")",P[0]).html("<b>"+(typeof af.label==="undefined"?O.p.colNames[ab]:af.label)+"</b>");b("td:eq("+(ae-1)+")",P[0]).append("<span>"+X+"</span>").attr("id","v_"+E);if(D){b("td:eq("+(ae-1)+") span",P[0]).css({"text-align":"right",width:G+"px"})}W[S]=ab;S++}});if(S>0){var Z=b("<tr class='FormData' style='display:none'><td class='CaptionTD'></td><td colspan='"+(U*2-1)+"' class='DataTD'><input class='FormElement' id='id_g' type='text' name='id' value='"+I+"'/></td></tr>");Z[0].rp=S+99;b(M).append(Z)}return W}function m(H,J){var D,K,G=0,F,E,I;I=b(J).jqGrid("getInd",H,true);if(!I){return}b("td",I).each(function(L){D=J.p.colModel[L].name;if(J.p.colModel[L].editrules&&J.p.colModel[L].editrules.edithidden===true){K=false}else{K=J.p.colModel[L].hidden===true?true:false}if(D!=="cb"&&D!=="subgrid"&&D!=="rn"){if(D==J.p.ExpandColumn&&J.p.treeGrid===true){F=b(this).text()}else{F=b(this).html()}E=b.extend({},J.p.colModel[L].editoptions||{});D=b.jgrid.jqID("v_"+D);b("#"+D+" span","#"+s).html(F);if(K){b("#"+D,"#"+s).parents("tr:first").hide()}G++}});if(G>0){b("#id_g","#"+s).val(H)}}if(b("#"+j.themodal).html()!=null){b(".ui-jqdialog-title","#"+j.modalhead).html(d.caption);b("#FormError","#"+s).hide();m(c,v);if(b.isFunction(d.beforeShowForm)){d.beforeShowForm(b("#"+y))}viewModal("#"+j.themodal,{gbox:"#gbox_"+r,jqm:d.jqModal,jqM:false,modal:d.modal});k()}else{b(v.p.colModel).each(function(D){var E=this.formoptions;h=Math.max(h,E?E.colpos||0:0);f=Math.max(f,E?E.rowpos||0:0)});var w=isNaN(d.dataheight)?d.dataheight:d.dataheight+"px";var A=b("<form name='FormPost' id='"+y+"' class='FormGrid' style='width:100%;overflow:auto;position:relative;height:"+w+";'></form>"),l=b("<table id='"+s+"' class='EditTable' cellspacing='1' cellpading='2' border='0' style='table-layout:fixed'><tbody></tbody></table>");b(A).append(l);n(c,v,l,h);var x=v.p.direction=="rtl"?true:false,C=x?"nData":"pData",g=x?"pData":"nData",t="<a href='javascript:void(0)' id='"+C+"' class='fm-button ui-state-default ui-corner-left'><span class='ui-icon ui-icon-triangle-1-w'></span></div>",u="<a href='javascript:void(0)' id='"+g+"' class='fm-button ui-state-default ui-corner-right'><span class='ui-icon ui-icon-triangle-1-e'></span></div>",B="<a href='javascript:void(0)' id='cData' class='fm-button ui-state-default ui-corner-all'>"+d.bClose+"</a>";if(f>0){var e=[];b.each(b(l)[0].rows,function(D,E){e[D]=E});e.sort(function(E,D){if(E.rp>D.rp){return 1}if(E.rp<D.rp){return -1}return 0});b.each(e,function(D,E){b("tbody",l).append(E)})}d.gbox="#gbox_"+r;var q=false;if(d.closeOnEscape===true){d.closeOnEscape=false;q=true}var z=b("<span></span>").append(A).append("<table border='0' class='EditTable' id='"+s+"_2'><tbody><tr id='Act_Buttons'><td class='navButton ui-widget-content' width='"+d.labelswidth+"'>"+(x?u+t:t+u)+"</td><td class='EditButton ui-widget-content'>"+B+"</td></tr></tbody></table>");createModal(j,z,d,"#gview_"+v.p.id,b("#gview_"+v.p.id)[0]);if(x){b("#pData, #nData","#"+s+"_2").css("float","right");b(".EditButton","#"+s+"_2").css("text-align","left")}if(!d.viewPagerButtons){b("#pData, #nData","#"+s+"_2").hide()}z=null;b("#"+j.themodal).keydown(function(D){if(D.which===27){if(q){hideModal(this,{gb:d.gbox,jqm:d.jqModal,onClose:d.onClose})}return false}if(d.navkeys[0]===true){if(D.which===d.navkeys[1]){b("#pData","#"+s+"_2").trigger("click");return false}if(D.which===d.navkeys[2]){b("#nData","#"+s+"_2").trigger("click");return false}}});d.closeicon=b.extend([true,"left","ui-icon-close"],d.closeicon);if(d.closeicon[0]===true){b("#cData","#"+s+"_2").addClass(d.closeicon[1]=="right"?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+d.closeicon[2]+"'></span>")}if(b.isFunction(d.beforeShowForm)){d.beforeShowForm(b("#"+y))}viewModal("#"+j.themodal,{gbox:"#gbox_"+r,jqm:d.jqModal,modal:d.modal});b(".fm-button:not(.ui-state-disabled)","#"+s+"_2").hover(function(){b(this).addClass("ui-state-hover")},function(){b(this).removeClass("ui-state-hover")});k();b("#cData","#"+s+"_2").click(function(D){hideModal("#"+j.themodal,{gb:"#gbox_"+r,jqm:d.jqModal,onClose:d.onClose});return false});b("#nData","#"+s+"_2").click(function(D){b("#FormError","#"+s).hide();var E=i();E[0]=parseInt(E[0],10);if(E[0]!=-1&&E[1][E[0]+1]){if(b.isFunction(d.onclickPgButtons)){d.onclickPgButtons("next",b("#"+y),E[1][E[0]])}m(E[1][E[0]+1],v);b(v).jqGrid("setSelection",E[1][E[0]+1]);if(b.isFunction(d.afterclickPgButtons)){d.afterclickPgButtons("next",b("#"+y),E[1][E[0]+1])}o(E[0]+1,E[1].length-1)}k();return false});b("#pData","#"+s+"_2").click(function(E){b("#FormError","#"+s).hide();var D=i();if(D[0]!=-1&&D[1][D[0]-1]){if(b.isFunction(d.onclickPgButtons)){d.onclickPgButtons("prev",b("#"+y),D[1][D[0]])}m(D[1][D[0]-1],v);b(v).jqGrid("setSelection",D[1][D[0]-1]);if(b.isFunction(d.afterclickPgButtons)){d.afterclickPgButtons("prev",b("#"+y),D[1][D[0]-1])}o(D[0]-1,D[1].length-1)}k();return false})}function o(E,F,D){if(E===0){b("#pData","#"+s+"_2").addClass("ui-state-disabled")}else{b("#pData","#"+s+"_2").removeClass("ui-state-disabled")}if(E==F){b("#nData","#"+s+"_2").addClass("ui-state-disabled")}else{b("#nData","#"+s+"_2").removeClass("ui-state-disabled")}}function i(){var E=b(v).jqGrid("getDataIDs"),D=b("#id_g","#"+s).val(),F=b.inArray(D,E);return[F,E]}var p=i();o(p[0],p[1].length-1)})},delGridRow:function(c,d){d=b.extend({top:0,left:0,width:240,height:"auto",dataheight:"auto",modal:false,drag:true,resize:true,url:"",mtype:"POST",reloadAfterSubmit:true,beforeShowForm:null,afterShowForm:null,beforeSubmit:null,onclickSubmit:null,afterSubmit:null,jqModal:true,closeOnEscape:false,delData:{},delicon:[],cancelicon:[],onClose:null,ajaxDelOptions:{},processing:false,serializeDelData:null,useDataProxy:false},b.jgrid.del,d||{});a=d;return this.each(function(){var n=this;if(!n.grid){return}if(!c){return}var o=typeof d.beforeShowForm==="function"?true:false,g=typeof d.afterShowForm==="function"?true:false,e=n.p.id,f={},k="DelTbl_"+e,p,q,m,j,h={themodal:"delmod"+e,modalhead:"delhd"+e,modalcontent:"delcnt"+e,scrollelm:k};if(jQuery.isArray(c)){c=c.join()}if(b("#"+h.themodal).html()!=null){b("#DelData>td","#"+k).text(c);b("#DelError","#"+k).hide();if(a.processing===true){a.processing=false;b("#dData","#"+k).removeClass("ui-state-active")}if(o){d.beforeShowForm(b("#"+k))}viewModal("#"+h.themodal,{gbox:"#gbox_"+e,jqm:d.jqModal,jqM:false,modal:d.modal});if(g){d.afterShowForm(b("#"+k))}}else{var r=isNaN(d.dataheight)?d.dataheight:d.dataheight+"px";var l="<div id='"+k+"' class='formdata' style='width:100%;overflow:auto;position:relative;height:"+r+";'>";l+="<table class='DelTable'><tbody>";l+="<tr id='DelError' style='display:none'><td class='ui-state-error'></td></tr>";l+="<tr id='DelData' style='display:none'><td >"+c+"</td></tr>";l+='<tr><td class="delmsg" style="white-space:pre;">'+d.msg+"</td></tr><tr><td >&#160;</td></tr>";l+="</tbody></table></div>";var i="<a href='javascript:void(0)' id='dData' class='fm-button ui-state-default ui-corner-all'>"+d.bSubmit+"</a>",s="<a href='javascript:void(0)' id='eData' class='fm-button ui-state-default ui-corner-all'>"+d.bCancel+"</a>";l+="<table cellspacing='0' cellpadding='0' border='0' class='EditTable' id='"+k+"_2'><tbody><tr><td class='DataTD ui-widget-content'></td></tr><tr style='display:block;height:3px;'><td></td></tr><tr><td class='DelButton EditButton'>"+i+"&#160;"+s+"</td></tr></tbody></table>";d.gbox="#gbox_"+e;createModal(h,l,d,"#gview_"+n.p.id,b("#gview_"+n.p.id)[0]);b(".fm-button","#"+k+"_2").hover(function(){b(this).addClass("ui-state-hover")},function(){b(this).removeClass("ui-state-hover")});d.delicon=b.extend([true,"left","ui-icon-scissors"],d.delicon);d.cancelicon=b.extend([true,"left","ui-icon-cancel"],d.cancelicon);if(d.delicon[0]===true){b("#dData","#"+k+"_2").addClass(d.delicon[1]=="right"?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+d.delicon[2]+"'></span>")}if(d.cancelicon[0]===true){b("#eData","#"+k+"_2").addClass(d.cancelicon[1]=="right"?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+d.cancelicon[2]+"'></span>")}b("#dData","#"+k+"_2").click(function(w){var u=[true,""];f={};var v=b("#DelData>td","#"+k).text();if(typeof d.onclickSubmit==="function"){f=d.onclickSubmit(a,v)||{}}if(typeof d.beforeSubmit==="function"){u=d.beforeSubmit(v)}if(u[0]&&!a.processing){a.processing=true;b(this).addClass("ui-state-active");m=n.p.prmNames;p=b.extend({},a.delData,f);j=m.oper;p[j]=m.deloper;q=m.id;p[q]=v;var t=b.extend({url:a.url?a.url:b(n).jqGrid("getGridParam","editurl"),type:d.mtype,data:b.isFunction(d.serializeDelData)?d.serializeDelData(p):p,complete:function(A,y){if(y!="success"){u[0]=false;if(b.isFunction(a.errorTextFormat)){u[1]=a.errorTextFormat(A)}else{u[1]=y+" Status: '"+A.statusText+"'. Error code: "+A.status}}else{if(typeof a.afterSubmit==="function"){u=a.afterSubmit(A,p)}}if(u[0]===false){b("#DelError>td","#"+k).html(u[1]);b("#DelError","#"+k).show()}else{if(a.reloadAfterSubmit&&n.p.datatype!="local"){b(n).trigger("reloadGrid")}else{var x=[];x=v.split(",");if(n.p.treeGrid===true){try{b(n).jqGrid("delTreeNode",x[0])}catch(B){}}else{for(var z=0;z<x.length;z++){b(n).jqGrid("delRowData",x[z])}}n.p.selrow=null;n.p.selarrrow=[]}if(b.isFunction(a.afterComplete)){setTimeout(function(){a.afterComplete(A,v)},500)}}a.processing=false;b("#dData","#"+k+"_2").removeClass("ui-state-active");if(u[0]){hideModal("#"+h.themodal,{gb:"#gbox_"+e,jqm:d.jqModal,onClose:a.onClose})}},error:function(z,x,y){b("#DelError>td","#"+k).html(x+" : "+y);b("#DelError","#"+k).show();a.processing=false;b("#dData","#"+k+"_2").removeClass("ui-state-active")}},b.jgrid.ajaxOptions,d.ajaxDelOptions);if(!t.url&&!a.useDataProxy){if(b.isFunction(n.p.dataProxy)){a.useDataProxy=true}else{u[0]=false;u[1]+=" "+b.jgrid.errors.nourl}}if(u[0]){if(a.useDataProxy){n.p.dataProxy.call(n,t,"del_"+n.p.id)}else{b.ajax(t)}}}if(u[0]===false){b("#DelError>td","#"+k).html(u[1]);b("#DelError","#"+k).show()}return false});b("#eData","#"+k+"_2").click(function(t){hideModal("#"+h.themodal,{gb:"#gbox_"+e,jqm:d.jqModal,onClose:a.onClose});return false});if(o){d.beforeShowForm(b("#"+k))}viewModal("#"+h.themodal,{gbox:"#gbox_"+e,jqm:d.jqModal,modal:d.modal});if(g){d.afterShowForm(b("#"+k))}}if(d.closeOnEscape===true){setTimeout(function(){b(".ui-jqdialog-titlebar-close","#"+h.modalhead).focus()},0)}})},navGrid:function(f,h,e,g,d,c,i){h=b.extend({edit:true,editicon:"ui-icon-pencil",add:true,addicon:"ui-icon-plus",del:true,delicon:"ui-icon-trash",search:true,searchicon:"ui-icon-search",refresh:true,refreshicon:"ui-icon-refresh",refreshstate:"firstpage",view:false,viewicon:"ui-icon-document",position:"left",closeOnEscape:true,beforeRefresh:null,afterRefresh:null,cloneToTop:false},b.jgrid.nav,h||{});return this.each(function(){var j={themodal:"alertmod",modalhead:"alerthd",modalcontent:"alertcnt"},n=this,m,v,p,k;if(!n.grid||typeof f!="string"){return}if(b("#"+j.themodal).html()===null){if(typeof window.innerWidth!="undefined"){m=window.innerWidth;v=window.innerHeight}else{if(typeof document.documentElement!="undefined"&&typeof document.documentElement.clientWidth!="undefined"&&document.documentElement.clientWidth!==0){m=document.documentElement.clientWidth;v=document.documentElement.clientHeight}else{m=1024;v=768}}createModal(j,"<div>"+h.alerttext+"</div><span tabindex='0'><span tabindex='-1' id='jqg_alrt'></span></span>",{gbox:"#gbox_"+n.p.id,jqModal:true,drag:true,resize:true,caption:h.alertcap,top:v/2-25,left:m/2-100,width:200,height:"auto",closeOnEscape:h.closeOnEscape},"","",true)}var q=1;if(h.cloneToTop&&n.p.toppager){q=2}for(var o=0;o<q;o++){var r,t=b("<table cellspacing='0' cellpadding='0' border='0' class='ui-pg-table navtable' style='float:left;table-layout:auto;'><tbody><tr></tr></tbody></table>"),u="<td class='ui-pg-button ui-state-disabled' style='width:4px;'><span class='ui-separator'></span></td>",l,s;if(o===0){l=f;s=n.p.id;if(l==n.p.toppager){s+="_top";q=1}}else{l=n.p.toppager;s=n.p.id+"_top"}if(n.p.direction=="rtl"){b(t).attr("dir","rtl").css("float","right")}if(h.add){g=g||{};r=b("<td class='ui-pg-button ui-corner-all'></td>");b(r).append("<div class='ui-pg-div'><span class='ui-icon "+h.addicon+"'></span>"+h.addtext+"</div>");b("tr",t).append(r);b(r,t).attr({title:h.addtitle||"",id:g.id||"add_"+s}).click(function(){if(!b(this).hasClass("ui-state-disabled")){if(typeof h.addfunc=="function"){h.addfunc()}else{b(n).jqGrid("editGridRow","new",g)}}return false}).hover(function(){if(!b(this).hasClass("ui-state-disabled")){b(this).addClass("ui-state-hover")}},function(){b(this).removeClass("ui-state-hover")});r=null}if(h.edit){r=b("<td class='ui-pg-button ui-corner-all'></td>");e=e||{};b(r).append("<div class='ui-pg-div'><span class='ui-icon "+h.editicon+"'></span>"+h.edittext+"</div>");b("tr",t).append(r);b(r,t).attr({title:h.edittitle||"",id:e.id||"edit_"+s}).click(function(){if(!b(this).hasClass("ui-state-disabled")){var w=n.p.selrow;if(w){if(typeof h.editfunc=="function"){h.editfunc(w)}else{b(n).jqGrid("editGridRow",w,e)}}else{viewModal("#"+j.themodal,{gbox:"#gbox_"+n.p.id,jqm:true});b("#jqg_alrt").focus()}}return false}).hover(function(){if(!b(this).hasClass("ui-state-disabled")){b(this).addClass("ui-state-hover")}},function(){b(this).removeClass("ui-state-hover")});r=null}if(h.view){r=b("<td class='ui-pg-button ui-corner-all'></td>");i=i||{};b(r).append("<div class='ui-pg-div'><span class='ui-icon "+h.viewicon+"'></span>"+h.viewtext+"</div>");b("tr",t).append(r);b(r,t).attr({title:h.viewtitle||"",id:i.id||"view_"+s}).click(function(){if(!b(this).hasClass("ui-state-disabled")){var w=n.p.selrow;if(w){b(n).jqGrid("viewGridRow",w,i)}else{viewModal("#"+j.themodal,{gbox:"#gbox_"+n.p.id,jqm:true});b("#jqg_alrt").focus()}}return false}).hover(function(){if(!b(this).hasClass("ui-state-disabled")){b(this).addClass("ui-state-hover")}},function(){b(this).removeClass("ui-state-hover")});r=null}if(h.del){r=b("<td class='ui-pg-button ui-corner-all'></td>");d=d||{};b(r).append("<div class='ui-pg-div'><span class='ui-icon "+h.delicon+"'></span>"+h.deltext+"</div>");b("tr",t).append(r);b(r,t).attr({title:h.deltitle||"",id:d.id||"del_"+s}).click(function(){if(!b(this).hasClass("ui-state-disabled")){var w;if(n.p.multiselect){w=n.p.selarrrow;if(w.length===0){w=null}}else{w=n.p.selrow}if(w){if("function"==typeof h.delfunc){h.delfunc(w)}else{b(n).jqGrid("delGridRow",w,d)}}else{viewModal("#"+j.themodal,{gbox:"#gbox_"+n.p.id,jqm:true});b("#jqg_alrt").focus()}}return false}).hover(function(){if(!b(this).hasClass("ui-state-disabled")){b(this).addClass("ui-state-hover")}},function(){b(this).removeClass("ui-state-hover")});r=null}if(h.add||h.edit||h.del||h.view){b("tr",t).append(u)}if(h.search){r=b("<td class='ui-pg-button ui-corner-all'></td>");c=c||{};b(r).append("<div class='ui-pg-div'><span class='ui-icon "+h.searchicon+"'></span>"+h.searchtext+"</div>");b("tr",t).append(r);b(r,t).attr({title:h.searchtitle||"",id:c.id||"search_"+s}).click(function(){if(!b(this).hasClass("ui-state-disabled")){b(n).jqGrid("searchGrid",c)}return false}).hover(function(){if(!b(this).hasClass("ui-state-disabled")){b(this).addClass("ui-state-hover")}},function(){b(this).removeClass("ui-state-hover")});r=null}if(h.refresh){r=b("<td class='ui-pg-button ui-corner-all'></td>");b(r).append("<div class='ui-pg-div'><span class='ui-icon "+h.refreshicon+"'></span>"+h.refreshtext+"</div>");b("tr",t).append(r);b(r,t).attr({title:h.refreshtitle||"",id:"refresh_"+s}).click(function(){if(!b(this).hasClass("ui-state-disabled")){if(b.isFunction(h.beforeRefresh)){h.beforeRefresh()}n.p.search=false;try{var w=n.p.id;b("#fbox_"+w).searchFilter().reset({reload:false});if(b.isFunction(n.clearToolbar)){n.clearToolbar(false)}}catch(x){}switch(h.refreshstate){case"firstpage":b(n).trigger("reloadGrid",[{page:1}]);break;case"current":b(n).trigger("reloadGrid",[{current:true}]);break}if(b.isFunction(h.afterRefresh)){h.afterRefresh()}}return false}).hover(function(){if(!b(this).hasClass("ui-state-disabled")){b(this).addClass("ui-state-hover")}},function(){b(this).removeClass("ui-state-hover")});r=null}k=b(".ui-jqgrid").css("font-size")||"11px";b("body").append("<div id='testpg2' class='ui-jqgrid ui-widget ui-widget-content' style='font-size:"+k+";visibility:hidden;' ></div>");p=b(t).clone().appendTo("#testpg2").width();b("#testpg2").remove();b(l+"_"+h.position,l).append(t);if(n.p._nvtd){if(p>n.p._nvtd[0]){b(l+"_"+h.position,l).width(p);n.p._nvtd[0]=p}n.p._nvtd[1]=p}k=null;p=null;t=null}})},navButtonAdd:function(c,d){d=b.extend({caption:"newButton",title:"",buttonicon:"ui-icon-newwin",onClickButton:null,position:"last",cursor:"pointer"},d||{});return this.each(function(){if(!this.grid){return}if(c.indexOf("#")!==0){c="#"+c}var e=b(".navtable",c)[0],g=this;if(e){var f=b("<td></td>");if(d.buttonicon.toString().toUpperCase()=="NONE"){b(f).addClass("ui-pg-button ui-corner-all").append("<div class='ui-pg-div'>"+d.caption+"</div>")}else{b(f).addClass("ui-pg-button ui-corner-all").append("<div class='ui-pg-div'><span class='ui-icon "+d.buttonicon+"'></span>"+d.caption+"</div>")}if(d.id){b(f).attr("id",d.id)}if(d.position=="first"){if(e.rows[0].cells.length===0){b("tr",e).append(f)}else{b("tr td:eq(0)",e).before(f)}}else{b("tr",e).append(f)}b(f,e).attr("title",d.title||"").click(function(h){if(!b(this).hasClass("ui-state-disabled")){if(b.isFunction(d.onClickButton)){d.onClickButton.call(g,h)}}return false}).hover(function(){if(!b(this).hasClass("ui-state-disabled")){b(this).addClass("ui-state-hover")}},function(){b(this).removeClass("ui-state-hover")})}})},navSeparatorAdd:function(c,d){d=b.extend({sepclass:"ui-separator",sepcontent:""},d||{});return this.each(function(){if(!this.grid){return}if(c.indexOf("#")!==0){c="#"+c}var f=b(".navtable",c)[0];if(f){var e="<td class='ui-pg-button ui-state-disabled' style='width:4px;'><span class='"+d.sepclass+"'></span>"+d.sepcontent+"</td>";b("tr",f).append(e)}})},GridToForm:function(c,d){return this.each(function(){var g=this;if(!g.grid){return}var f=b(g).jqGrid("getRowData",c);if(f){for(var e in f){if(b("[name="+e+"]",d).is("input:radio")||b("[name="+e+"]",d).is("input:checkbox")){b("[name="+e+"]",d).each(function(){if(b(this).val()==f[e]){b(this).attr("checked","checked")}else{b(this).attr("checked","")}})}else{b("[name="+e+"]",d).val(f[e])}}}})},FormToGrid:function(d,e,f,c){return this.each(function(){var i=this;if(!i.grid){return}if(!f){f="set"}if(!c){c="first"}var g=b(e).serializeArray();var h={};b.each(g,function(j,k){h[k.name]=k.value});if(f=="add"){b(i).jqGrid("addRowData",d,h,c)}else{if(f=="set"){b(i).jqGrid("setRowData",d,h)}}})}})})(jQuery);