/**
 * jqGrid extension for form editing Grid Data
 * Tony Tomov tony@trirand.com
 * http://trirand.com/blog/
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl-2.0.html
**/
(function(b){var a={};b.jgrid.extend({searchGrid:function(c){c=b.extend({recreateFilter:false,drag:true,sField:"searchField",sValue:"searchString",sOper:"searchOper",sFilter:"filters",loadDefaults:true,beforeShowSearch:null,afterShowSearch:null,onInitializeSearch:null,afterRedraw:null,closeAfterSearch:false,closeAfterReset:false,closeOnEscape:false,multipleSearch:false,multipleGroup:false,top:0,left:0,jqModal:true,modal:false,resize:true,width:450,height:"auto",dataheight:"auto",showQuery:false,errorcheck:true,sopt:null,stringResult:undefined,onClose:null,onSearch:null,onReset:null,toTop:true,overlay:30,columns:[],tmplNames:null,tmplFilters:null,tmplLabel:" Template: ",showOnLoad:false,layer:null},b.jgrid.search,c||{});return this.each(function(){var s=this;if(!s.grid){return}var d="fbox_"+s.p.id,i=true,f={themodal:"searchmod"+d,modalhead:"searchhd"+d,modalcontent:"searchcnt"+d,scrollelm:d},g=s.p.postData[c.sFilter];if(typeof(g)==="string"){g=b.jgrid.parse(g)}if(c.recreateFilter===true){b("#"+f.themodal).remove()}function h(){if(b.isFunction(c.beforeShowSearch)){i=c.beforeShowSearch(b("#"+d));if(typeof(i)==="undefined"){i=true}}if(i){b.jgrid.viewModal("#"+f.themodal,{gbox:"#gbox_"+d,jqm:c.jqModal,modal:c.modal,overlay:c.overlay,toTop:c.toTop});if(b.isFunction(c.afterShowSearch)){c.afterShowSearch(b("#"+d))}}}if(b("#"+f.themodal).html()!==null){h()}else{var t=b("<div><div id='"+d+"' class='searchFilter' style='overflow:auto'></div></div>").insertBefore("#gview_"+s.p.id),r="left",j="";if(s.p.direction=="rtl"){r="right";j=" style='text-align:left'";t.attr("dir","rtl")}var e=b.extend([],s.p.colModel),o="<a href='javascript:void(0)' id='"+d+"_search' class='fm-button ui-state-default ui-corner-all fm-button-icon-right ui-reset'><span class='ui-icon ui-icon-search'></span>"+c.Find+"</a>",v="<a href='javascript:void(0)' id='"+d+"_reset' class='fm-button ui-state-default ui-corner-all fm-button-icon-left ui-search'><span class='ui-icon ui-icon-arrowreturnthick-1-w'></span>"+c.Reset+"</a>",q="",k="",m,n=false,u,p=-1;if(c.showQuery){q="<a href='javascript:void(0)' id='"+d+"_query' class='fm-button ui-state-default ui-corner-all fm-button-icon-left'><span class='ui-icon ui-icon-comment'></span>Query</a>"}if(!c.columns.length){b.each(e,function(x,A){if(!A.label){A.label=s.p.colNames[x]}if(!n){var w=(typeof A.search==="undefined")?true:A.search,z=(A.hidden===true),y=(A.searchoptions&&A.searchoptions.searchhidden===true);if((y&&w)||(w&&!z)){n=true;m=A.index||A.name;p=x}}})}else{e=c.columns}if((!g&&m)||c.multipleSearch===false){var l="eq";if(p>=0&&e[p].searchoptions&&e[p].searchoptions.sopt){l=e[p].searchoptions.sopt[0]}else{if(c.sopt&&c.sopt.length){l=c.sopt[0]}}g={groupOp:"AND",rules:[{field:m,op:l,data:""}]}}n=false;if(c.tmplNames&&c.tmplNames.length){n=true;k=c.tmplLabel;k+="<select class='ui-template'>";k+="<option value='default'>Default</option>";b.each(c.tmplNames,function(w,x){k+="<option value='"+w+"'>"+x+"</option>"});k+="</select>"}u="<table class='EditTable' style='border:0px none;margin-top:5px' id='"+d+"_2'><tbody><tr><td colspan='2'><hr class='ui-widget-content' style='margin:1px'/></td></tr><tr><td class='EditButton' style='text-align:"+r+"'>"+v+k+"</td><td class='EditButton' "+j+">"+q+o+"</td></tr></tbody></table>";b("#"+d).jqFilter({columns:e,filter:c.loadDefaults?g:null,showQuery:c.showQuery,errorcheck:c.errorcheck,sopt:c.sopt,groupButton:c.multipleGroup,ruleButtons:c.multipleSearch,afterRedraw:c.afterRedraw,_gridsopt:b.jgrid.search.odata,ajaxSelectOptions:s.p.ajaxSelectOptions,onChange:function(w){if(this.p.showQuery){b(".query",this).html(this.toUserFriendlyString())}},direction:s.p.direction});t.append(u);if(n&&c.tmplFilters&&c.tmplFilters.length){b(".ui-template",t).bind("change",function(x){var w=b(this).val();if(w=="default"){b("#"+d).jqFilter("addFilter",g)}else{b("#"+d).jqFilter("addFilter",c.tmplFilters[parseInt(w,10)])}return false})}if(c.multipleGroup===true){c.multipleSearch=true}if(b.isFunction(c.onInitializeSearch)){c.onInitializeSearch(b("#"+d))}c.gbox="#gbox_"+d;if(c.layer){b.jgrid.createModal(f,t,c,"#gview_"+s.p.id,b("#gbox_"+s.p.id)[0],"#"+c.layer,{position:"relative"})}else{b.jgrid.createModal(f,t,c,"#gview_"+s.p.id,b("#gbox_"+s.p.id)[0])}if(q){b("#"+d+"_query").bind("click",function(w){b(".queryresult",t).toggle();return false})}if(c.stringResult===undefined){c.stringResult=c.multipleSearch}b("#"+d+"_search").bind("click",function(){var z=b("#"+d),x={},w,y=z.jqFilter("filterData");if(c.errorcheck){z[0].hideError();if(!c.showQuery){z.jqFilter("toSQLString")}if(z[0].p.error){z[0].showError();return false}}if(c.stringResult){try{w=xmlJsonClass.toJson(y,"","",false)}catch(B){try{w=JSON.stringify(y)}catch(A){}}if(typeof(w)==="string"){x[c.sFilter]=w;b.each([c.sField,c.sValue,c.sOper],function(){x[this]=""})}}else{if(c.multipleSearch){x[c.sFilter]=y;b.each([c.sField,c.sValue,c.sOper],function(){x[this]=""})}else{x[c.sField]=y.rules[0].field;x[c.sValue]=y.rules[0].data;x[c.sOper]=y.rules[0].op;x[c.sFilter]=""}}s.p.search=true;b.extend(s.p.postData,x);if(b.isFunction(c.onSearch)){c.onSearch()}b(s).trigger("reloadGrid",[{page:1}]);if(c.closeAfterSearch){b.jgrid.hideModal("#"+f.themodal,{gb:"#gbox_"+s.p.id,jqm:c.jqModal,onClose:c.onClose})}return false});b("#"+d+"_reset").bind("click",function(){var w={},x=b("#"+d);s.p.search=false;if(c.multipleSearch===false){w[c.sField]=w[c.sValue]=w[c.sOper]=""}else{w[c.sFilter]=""}x[0].resetFilter();if(n){b(".ui-template",t).val("default")}b.extend(s.p.postData,w);if(b.isFunction(c.onReset)){c.onReset()}b(s).trigger("reloadGrid",[{page:1}]);return false});h();b(".fm-button:not(.ui-state-disabled)",t).hover(function(){b(this).addClass("ui-state-hover")},function(){b(this).removeClass("ui-state-hover")})}})},editGridRow:function(c,d){d=b.extend({top:0,left:0,width:300,height:"auto",dataheight:"auto",modal:false,overlay:30,drag:true,resize:true,url:null,mtype:"POST",clearAfterAdd:true,closeAfterEdit:false,reloadAfterSubmit:true,onInitializeForm:null,beforeInitData:null,beforeShowForm:null,afterShowForm:null,beforeSubmit:null,afterSubmit:null,onclickSubmit:null,afterComplete:null,onclickPgButtons:null,afterclickPgButtons:null,editData:{},recreateForm:false,jqModal:true,closeOnEscape:false,addedrow:"first",topinfo:"",bottominfo:"",saveicon:[],closeicon:[],savekey:[false,13],navkeys:[false,38,40],checkOnSubmit:false,checkOnUpdate:false,_savedData:{},processing:false,onClose:null,ajaxEditOptions:{},serializeEditData:null,viewPagerButtons:true},b.jgrid.edit,d||{});a[b(this)[0].p.id]=d;return this.each(function(){var e=this;if(!e.grid||!c){return}var A=e.p.id,x="FrmGrid_"+A,u="TblGrid_"+A,i={themodal:"editmod"+A,modalhead:"edithd"+A,modalcontent:"editcnt"+A,scrollelm:x},B=b.isFunction(a[e.p.id].beforeShowForm)?a[e.p.id].beforeShowForm:false,L=b.isFunction(a[e.p.id].afterShowForm)?a[e.p.id].afterShowForm:false,K=b.isFunction(a[e.p.id].beforeInitData)?a[e.p.id].beforeInitData:false,o=b.isFunction(a[e.p.id].onInitializeForm)?a[e.p.id].onInitializeForm:false,F=null,W=true,G=1,q=0,C,O,E,z;if(c==="new"){c="_empty";d.caption=a[e.p.id].addCaption}else{d.caption=a[e.p.id].editCaption}if(d.recreateForm===true&&b("#"+i.themodal).html()!==null){b("#"+i.themodal).remove()}var l=true;if(d.checkOnUpdate&&d.jqModal&&!d.modal){l=false}function V(){b("#"+u+" > tbody > tr > td > .FormElement").each(function(aa){var ad=b(".customelement",this);if(ad.length){var ab=ad[0],Y=b(ab).attr("name");b.each(e.p.colModel,function(ae,ag){if(this.name===Y&&this.editoptions&&b.isFunction(this.editoptions.custom_value)){try{C[Y]=this.editoptions.custom_value(b("#"+b.jgrid.jqID(Y),"#"+u),"get");if(C[Y]===undefined){throw"e1"}}catch(af){if(af==="e1"){b.jgrid.info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+b.jgrid.edit.msg.novalue,jQuery.jgrid.edit.bClose)}else{b.jgrid.info_dialog(jQuery.jgrid.errors.errcap,af.message,jQuery.jgrid.edit.bClose)}}return true}})}else{switch(b(this).get(0).type){case"checkbox":if(b(this).is(":checked")){C[this.name]=b(this).val()}else{var Z=b(this).attr("offval");C[this.name]=Z}break;case"select-one":C[this.name]=b("option:selected",this).val();O[this.name]=b("option:selected",this).text();break;case"select-multiple":C[this.name]=b(this).val();if(C[this.name]){C[this.name]=C[this.name].join(",")}else{C[this.name]=""}var ac=[];b("option:selected",this).each(function(ae,af){ac[ae]=b(af).text()});O[this.name]=ac.join(",");break;case"password":case"text":case"textarea":case"button":C[this.name]=b(this).val();break}if(e.p.autoencode){C[this.name]=b.jgrid.htmlEncode(C[this.name])}}});return true}function s(aa,ah,ae,ac){var ao,ai,Z,ad=0,ag,an,Y,ak=[],ab=false,aj="<td class='CaptionTD'>&#160;</td><td class='DataTD'>&#160;</td>",am="",af;for(af=1;af<=ac;af++){am+=aj}if(aa!="_empty"){ab=b(ah).jqGrid("getInd",aa)}b(ah.p.colModel).each(function(ar){ao=this.name;if(this.editrules&&this.editrules.edithidden===true){ai=false}else{ai=this.hidden===true?true:false}an=ai?"style='display:none'":"";if(ao!=="cb"&&ao!=="subgrid"&&this.editable===true&&ao!=="rn"){if(ab===false){ag=""}else{if(ao==ah.p.ExpandColumn&&ah.p.treeGrid===true){ag=b("td:eq("+ar+")",ah.rows[ab]).text()}else{try{ag=b.unformat(b("td:eq("+ar+")",ah.rows[ab]),{rowId:aa,colModel:this},ar)}catch(ap){ag=(this.edittype&&this.edittype=="textarea")?b("td:eq("+ar+")",ah.rows[ab]).text():b("td:eq("+ar+")",ah.rows[ab]).html()}if(!ag||ag=="&nbsp;"||ag=="&#160;"||(ag.length==1&&ag.charCodeAt(0)==160)){ag=""}}}var aq=b.extend({},this.editoptions||{},{id:ao,name:ao}),aw=b.extend({},{elmprefix:"",elmsuffix:"",rowabove:false,rowcontent:""},this.formoptions||{}),at=parseInt(aw.rowpos,10)||ad+1,av=parseInt((parseInt(aw.colpos,10)||1)*2,10);if(aa=="_empty"&&aq.defaultValue){ag=b.isFunction(aq.defaultValue)?aq.defaultValue():aq.defaultValue}if(!this.edittype){this.edittype="text"}if(e.p.autoencode){ag=b.jgrid.htmlDecode(ag)}Y=b.jgrid.createEl(this.edittype,aq,ag,false,b.extend({},b.jgrid.ajaxOptions,ah.p.ajaxSelectOptions||{}));if(ag===""&&this.edittype=="checkbox"){ag=b(Y).attr("offval")}if(ag===""&&this.edittype=="select"){ag=b("option:eq(0)",Y).text()}if(a[e.p.id].checkOnSubmit||a[e.p.id].checkOnUpdate){a[e.p.id]._savedData[ao]=ag}b(Y).addClass("FormElement");if(this.edittype=="text"||this.edittype=="textarea"){b(Y).addClass("ui-widget-content ui-corner-all")}Z=b(ae).find("tr[rowpos="+at+"]");if(aw.rowabove){var au=b("<tr><td class='contentinfo' colspan='"+(ac*2)+"'>"+aw.rowcontent+"</td></tr>");b(ae).append(au);au[0].rp=at}if(Z.length===0){Z=b("<tr "+an+" rowpos='"+at+"'></tr>").addClass("FormData").attr("id","tr_"+ao);b(Z).append(am);b(ae).append(Z);Z[0].rp=at}b("td:eq("+(av-2)+")",Z[0]).html(typeof aw.label==="undefined"?ah.p.colNames[ar]:aw.label);b("td:eq("+(av-1)+")",Z[0]).append(aw.elmprefix).append(Y).append(aw.elmsuffix);ak[ad]=ar;ad++}});if(ad>0){var al=b("<tr class='FormData' style='display:none'><td class='CaptionTD'></td><td colspan='"+(ac*2-1)+"' class='DataTD'><input class='FormElement' id='id_g' type='text' name='"+ah.p.id+"_id' value='"+aa+"'/></td></tr>");al[0].rp=ad+999;b(ae).append(al);if(a[e.p.id].checkOnSubmit||a[e.p.id].checkOnUpdate){a[e.p.id]._savedData[ah.p.id+"_id"]=aa}}return ak}function p(Y,af,ab){var aj,ac=0,ag,ae,Z,ad,ah;if(a[e.p.id].checkOnSubmit||a[e.p.id].checkOnUpdate){a[e.p.id]._savedData={};a[e.p.id]._savedData[af.p.id+"_id"]=Y}var ai=af.p.colModel;if(Y=="_empty"){b(ai).each(function(ak){aj=this.name;Z=b.extend({},this.editoptions||{});ae=b("#"+b.jgrid.jqID(aj),"#"+ab);if(ae&&ae.length&&ae[0]!==null){ad="";if(Z.defaultValue){ad=b.isFunction(Z.defaultValue)?Z.defaultValue():Z.defaultValue;if(ae[0].type=="checkbox"){ah=ad.toLowerCase();if(ah.search(/(false|0|no|off|undefined)/i)<0&&ah!==""){ae[0].checked=true;ae[0].defaultChecked=true;ae[0].value=ad}else{ae[0].checked=false;ae[0].defaultChecked=false}}else{ae.val(ad)}}else{if(ae[0].type=="checkbox"){ae[0].checked=false;ae[0].defaultChecked=false;ad=b(ae).attr("offval")}else{if(ae[0].type&&ae[0].type.substr(0,6)=="select"){ae[0].selectedIndex=0}else{ae.val(ad)}}}if(a[e.p.id].checkOnSubmit===true||a[e.p.id].checkOnUpdate){a[e.p.id]._savedData[aj]=ad}}});b("#id_g","#"+ab).val(Y);return}var aa=b(af).jqGrid("getInd",Y,true);if(!aa){return}b('td[role="gridcell"]',aa).each(function(an){aj=ai[an].name;if(aj!=="cb"&&aj!=="subgrid"&&aj!=="rn"&&ai[an].editable===true){if(aj==af.p.ExpandColumn&&af.p.treeGrid===true){ag=b(this).text()}else{try{ag=b.unformat(b(this),{rowId:Y,colModel:ai[an]},an)}catch(am){ag=ai[an].edittype=="textarea"?b(this).text():b(this).html()}}if(e.p.autoencode){ag=b.jgrid.htmlDecode(ag)}if(a[e.p.id].checkOnSubmit===true||a[e.p.id].checkOnUpdate){a[e.p.id]._savedData[aj]=ag}aj=b.jgrid.jqID(aj);switch(ai[an].edittype){case"password":case"text":case"button":case"image":case"textarea":if(ag=="&nbsp;"||ag=="&#160;"||(ag.length==1&&ag.charCodeAt(0)==160)){ag=""}b("#"+aj,"#"+ab).val(ag);break;case"select":var al=ag.split(",");al=b.map(al,function(ap){return b.trim(ap)});b("#"+aj+" option","#"+ab).each(function(ap){if(!ai[an].editoptions.multiple&&(b.trim(ag)==b.trim(b(this).text())||al[0]==b.trim(b(this).text())||al[0]==b.trim(b(this).val()))){this.selected=true}else{if(ai[an].editoptions.multiple){if(b.inArray(b.trim(b(this).text()),al)>-1||b.inArray(b.trim(b(this).val()),al)>-1){this.selected=true}else{this.selected=false}}else{this.selected=false}}});break;case"checkbox":ag=ag+"";if(ai[an].editoptions&&ai[an].editoptions.value){var ak=ai[an].editoptions.value.split(":");if(ak[0]==ag){b("#"+aj,"#"+ab)[e.p.useProp?"prop":"attr"]("checked",true);b("#"+aj,"#"+ab)[e.p.useProp?"prop":"attr"]("defaultChecked",true)}else{b("#"+aj,"#"+ab)[e.p.useProp?"prop":"attr"]("checked",false);b("#"+aj,"#"+ab)[e.p.useProp?"prop":"attr"]("defaultChecked",false)}}else{ag=ag.toLowerCase();if(ag.search(/(false|0|no|off|undefined)/i)<0&&ag!==""){b("#"+aj,"#"+ab)[e.p.useProp?"prop":"attr"]("checked",true);b("#"+aj,"#"+ab)[e.p.useProp?"prop":"attr"]("defaultChecked",true)}else{b("#"+aj,"#"+ab)[e.p.useProp?"prop":"attr"]("checked",false);b("#"+aj,"#"+ab)[e.p.useProp?"prop":"attr"]("defaultChecked",false)}}break;case"custom":try{if(ai[an].editoptions&&b.isFunction(ai[an].editoptions.custom_value)){ai[an].editoptions.custom_value(b("#"+aj,"#"+ab),"set",ag)}else{throw"e1"}}catch(ao){if(ao=="e1"){b.jgrid.info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+b.jgrid.edit.msg.nodefined,jQuery.jgrid.edit.bClose)}else{b.jgrid.info_dialog(jQuery.jgrid.errors.errcap,ao.message,jQuery.jgrid.edit.bClose)}}break}ac++}});if(ac>0){b("#id_g","#"+u).val(Y)}}function S(){b.each(e.p.colModel,function(Y,Z){if(Z.editoptions&&Z.editoptions.NullIfEmpty===true){if(C.hasOwnProperty(Z.name)&&C[Z.name]===""){C[Z.name]="null"}}})}function j(){var ai,ah=[true,"",""],Y={},ad=e.p.prmNames,ag,ab,al,ae,ac;if(b.isFunction(a[e.p.id].beforeCheckValues)){var af=a[e.p.id].beforeCheckValues(C,b("#"+x),C[e.p.id+"_id"]=="_empty"?ad.addoper:ad.editoper);if(af&&typeof(af)==="object"){C=af}}for(al in C){if(C.hasOwnProperty(al)){ah=b.jgrid.checkValues(C[al],al,e);if(ah[0]===false){break}}}S();if(ah[0]){if(b.isFunction(a[e.p.id].onclickSubmit)){Y=a[e.p.id].onclickSubmit(a[e.p.id],C)||{}}if(b.isFunction(a[e.p.id].beforeSubmit)){ah=a[e.p.id].beforeSubmit(C,b("#"+x))}}if(ah[0]&&!a[e.p.id].processing){a[e.p.id].processing=true;b("#sData","#"+u+"_2").addClass("ui-state-active");ab=ad.oper;ag=ad.id;C[ab]=(b.trim(C[e.p.id+"_id"])=="_empty")?ad.addoper:ad.editoper;if(C[ab]!=ad.addoper){C[ag]=C[e.p.id+"_id"]}else{if(C[ag]===undefined){C[ag]=C[e.p.id+"_id"]}}delete C[e.p.id+"_id"];C=b.extend(C,a[e.p.id].editData,Y);if(e.p.treeGrid===true){if(C[ab]==ad.addoper){ae=b(e).jqGrid("getGridParam","selrow");var Z=e.p.treeGridModel=="adjacency"?e.p.treeReader.parent_id_field:"parent_id";C[Z]=ae}for(ac in e.p.treeReader){if(e.p.treeReader.hasOwnProperty(ac)){var ak=e.p.treeReader[ac];if(C.hasOwnProperty(ak)){if(C[ab]==ad.addoper&&ac==="parent_id_field"){continue}delete C[ak]}}}}C[ag]=b.jgrid.stripPref(e.p.idPrefix,C[ag]);var aa=b.extend({url:a[e.p.id].url?a[e.p.id].url:b(e).jqGrid("getGridParam","editurl"),type:a[e.p.id].mtype,data:b.isFunction(a[e.p.id].serializeEditData)?a[e.p.id].serializeEditData(C):C,complete:function(ao,am){C[ag]=e.p.idPrefix+C[ag];if(am!="success"){ah[0]=false;if(b.isFunction(a[e.p.id].errorTextFormat)){ah[1]=a[e.p.id].errorTextFormat(ao)}else{ah[1]=am+" Status: '"+ao.statusText+"'. Error code: "+ao.status}}else{if(b.isFunction(a[e.p.id].afterSubmit)){ah=a[e.p.id].afterSubmit(ao,C)}}if(ah[0]===false){b("#FormError>td","#"+u).html(ah[1]);b("#FormError","#"+u).show()}else{b.each(e.p.colModel,function(aq,at){if(O[this.name]&&this.formatter&&this.formatter=="select"){try{delete O[this.name]}catch(ar){}}});C=b.extend(C,O);if(e.p.autoencode){b.each(C,function(ar,aq){C[ar]=b.jgrid.htmlDecode(aq)})}if(C[ab]==ad.addoper){if(!ah[2]){ah[2]=b.jgrid.randId()}C[ag]=ah[2];if(a[e.p.id].closeAfterAdd){if(a[e.p.id].reloadAfterSubmit){b(e).trigger("reloadGrid")}else{if(e.p.treeGrid===true){b(e).jqGrid("addChildNode",ah[2],ae,C)}else{b(e).jqGrid("addRowData",ah[2],C,d.addedrow);b(e).jqGrid("setSelection",ah[2])}}b.jgrid.hideModal("#"+i.themodal,{gb:"#gbox_"+A,jqm:d.jqModal,onClose:a[e.p.id].onClose})}else{if(a[e.p.id].clearAfterAdd){if(a[e.p.id].reloadAfterSubmit){b(e).trigger("reloadGrid")}else{if(e.p.treeGrid===true){b(e).jqGrid("addChildNode",ah[2],ae,C)}else{b(e).jqGrid("addRowData",ah[2],C,d.addedrow)}}p("_empty",e,x)}else{if(a[e.p.id].reloadAfterSubmit){b(e).trigger("reloadGrid")}else{if(e.p.treeGrid===true){b(e).jqGrid("addChildNode",ah[2],ae,C)}else{b(e).jqGrid("addRowData",ah[2],C,d.addedrow)}}}}}else{if(a[e.p.id].reloadAfterSubmit){b(e).trigger("reloadGrid");if(!a[e.p.id].closeAfterEdit){setTimeout(function(){b(e).jqGrid("setSelection",C[ag])},1000)}}else{if(e.p.treeGrid===true){b(e).jqGrid("setTreeRow",C[ag],C)}else{b(e).jqGrid("setRowData",C[ag],C)}}if(a[e.p.id].closeAfterEdit){b.jgrid.hideModal("#"+i.themodal,{gb:"#gbox_"+A,jqm:d.jqModal,onClose:a[e.p.id].onClose})}}if(b.isFunction(a[e.p.id].afterComplete)){ai=ao;setTimeout(function(){a[e.p.id].afterComplete(ai,C,b("#"+x));ai=null},500)}if(a[e.p.id].checkOnSubmit||a[e.p.id].checkOnUpdate){b("#"+x).data("disabled",false);if(a[e.p.id]._savedData[e.p.id+"_id"]!="_empty"){for(var an in a[e.p.id]._savedData){if(C[an]){a[e.p.id]._savedData[an]=C[an]}}}}}a[e.p.id].processing=false;b("#sData","#"+u+"_2").removeClass("ui-state-active");try{b(":input:visible","#"+x)[0].focus()}catch(ap){}}},b.jgrid.ajaxOptions,a[e.p.id].ajaxEditOptions);if(!aa.url&&!a[e.p.id].useDataProxy){if(b.isFunction(e.p.dataProxy)){a[e.p.id].useDataProxy=true}else{ah[0]=false;ah[1]+=" "+b.jgrid.errors.nourl}}if(ah[0]){if(a[e.p.id].useDataProxy){var aj=e.p.dataProxy.call(e,aa,"set_"+e.p.id);if(typeof(aj)=="undefined"){aj=[true,""]}if(aj[0]===false){ah[0]=false;ah[1]=aj[1]||"Error deleting the selected row!"}else{if(aa.data.oper==ad.addoper&&a[e.p.id].closeAfterAdd){b.jgrid.hideModal("#"+i.themodal,{gb:"#gbox_"+A,jqm:d.jqModal,onClose:a[e.p.id].onClose})}if(aa.data.oper==ad.editoper&&a[e.p.id].closeAfterEdit){b.jgrid.hideModal("#"+i.themodal,{gb:"#gbox_"+A,jqm:d.jqModal,onClose:a[e.p.id].onClose})}}}else{b.ajax(aa)}}}if(ah[0]===false){b("#FormError>td","#"+u).html(ah[1]);b("#FormError","#"+u).show()}}function I(ab,Y){var Z=false,aa;for(aa in ab){if(ab[aa]!=Y[aa]){Z=true;break}}return Z}function g(){var Y=true;b("#FormError","#"+u).hide();if(a[e.p.id].checkOnUpdate){C={};O={};V();E=b.extend({},C,O);z=I(E,a[e.p.id]._savedData);if(z){b("#"+x).data("disabled",true);b(".confirm","#"+i.themodal).show();Y=false}}return Y}function U(){if(c!=="_empty"&&typeof(e.p.savedRow)!=="undefined"&&e.p.savedRow.length>0&&b.isFunction(b.fn.jqGrid.restoreRow)){for(var Y=0;Y<e.p.savedRow.length;Y++){if(e.p.savedRow[Y].id==c){b(e).jqGrid("restoreRow",c);break}}}}function H(Y,Z){if(Y===0){b("#pData","#"+u+"_2").addClass("ui-state-disabled")}else{b("#pData","#"+u+"_2").removeClass("ui-state-disabled")}if(Y==Z){b("#nData","#"+u+"_2").addClass("ui-state-disabled")}else{b("#nData","#"+u+"_2").removeClass("ui-state-disabled")}}function X(){var Z=b(e).jqGrid("getDataIDs"),Y=b("#id_g","#"+u).val(),aa=b.inArray(Y,Z);return[aa,Z]}if(b("#"+i.themodal).html()!==null){if(K){W=K(b("#"+x));if(typeof(W)=="undefined"){W=true}}if(W===false){return}U();b(".ui-jqdialog-title","#"+i.modalhead).html(d.caption);b("#FormError","#"+u).hide();if(a[e.p.id].topinfo){b(".topinfo","#"+u).html(a[e.p.id].topinfo);b(".tinfo","#"+u).show()}else{b(".tinfo","#"+u).hide()}if(a[e.p.id].bottominfo){b(".bottominfo","#"+u+"_2").html(a[e.p.id].bottominfo);b(".binfo","#"+u+"_2").show()}else{b(".binfo","#"+u+"_2").hide()}p(c,e,x);if(c=="_empty"||!a[e.p.id].viewPagerButtons){b("#pData, #nData","#"+u+"_2").hide()}else{b("#pData, #nData","#"+u+"_2").show()}if(a[e.p.id].processing===true){a[e.p.id].processing=false;b("#sData","#"+u+"_2").removeClass("ui-state-active")}if(b("#"+x).data("disabled")===true){b(".confirm","#"+i.themodal).hide();b("#"+x).data("disabled",false)}if(B){B(b("#"+x))}b("#"+i.themodal).data("onClose",a[e.p.id].onClose);b.jgrid.viewModal("#"+i.themodal,{gbox:"#gbox_"+A,jqm:d.jqModal,jqM:false,overlay:d.overlay,modal:d.modal});if(!l){b(".jqmOverlay").click(function(){if(!g()){return false}b.jgrid.hideModal("#"+i.themodal,{gb:"#gbox_"+A,jqm:d.jqModal,onClose:a[e.p.id].onClose});return false})}if(L){L(b("#"+x))}}else{var r=isNaN(d.dataheight)?d.dataheight:d.dataheight+"px",R=b("<form name='FormPost' id='"+x+"' class='FormGrid' onSubmit='return false;' style='width:100%;overflow:auto;position:relative;height:"+r+";'></form>").data("disabled",false),y=b("<table id='"+u+"' class='EditTable' cellspacing='0' cellpadding='0' border='0'><tbody></tbody></table>");if(K){W=K(b("#"+x));if(typeof(W)=="undefined"){W=true}}if(W===false){return}U();b(e.p.colModel).each(function(Y){var Z=this.formoptions;G=Math.max(G,Z?Z.colpos||0:0);q=Math.max(q,Z?Z.rowpos||0:0)});b(R).append(y);var J=b("<tr id='FormError' style='display:none'><td class='ui-state-error' colspan='"+(G*2)+"'></td></tr>");J[0].rp=0;b(y).append(J);J=b("<tr style='display:none' class='tinfo'><td class='topinfo' colspan='"+(G*2)+"'>"+a[e.p.id].topinfo+"</td></tr>");J[0].rp=0;b(y).append(J);var f=e.p.direction=="rtl"?true:false,Q=f?"nData":"pData",T=f?"pData":"nData";s(c,e,y,G);var k="<a href='javascript:void(0)' id='"+Q+"' class='fm-button ui-state-default ui-corner-left'><span class='ui-icon ui-icon-triangle-1-w'></span></a>",m="<a href='javascript:void(0)' id='"+T+"' class='fm-button ui-state-default ui-corner-right'><span class='ui-icon ui-icon-triangle-1-e'></span></a>",h="<a href='javascript:void(0)' id='sData' class='fm-button ui-state-default ui-corner-all'>"+d.bSubmit+"</a>",t="<a href='javascript:void(0)' id='cData' class='fm-button ui-state-default ui-corner-all'>"+d.bCancel+"</a>";var N="<table border='0' cellspacing='0' cellpadding='0' class='EditTable' id='"+u+"_2'><tbody><tr><td colspan='2'><hr class='ui-widget-content' style='margin:1px'/></td></tr><tr id='Act_Buttons'><td class='navButton'>"+(f?m+k:k+m)+"</td><td class='EditButton'>"+h+t+"</td></tr>";N+="<tr style='display:none' class='binfo'><td class='bottominfo' colspan='2'>"+a[e.p.id].bottominfo+"</td></tr>";N+="</tbody></table>";if(q>0){var w=[];b.each(b(y)[0].rows,function(Y,Z){w[Y]=Z});w.sort(function(Z,Y){if(Z.rp>Y.rp){return 1}if(Z.rp<Y.rp){return -1}return 0});b.each(w,function(Y,Z){b("tbody",y).append(Z)})}d.gbox="#gbox_"+A;var n=false;if(d.closeOnEscape===true){d.closeOnEscape=false;n=true}var M=b("<span></span>").append(R).append(N);b.jgrid.createModal(i,M,d,"#gview_"+e.p.id,b("#gbox_"+e.p.id)[0]);if(f){b("#pData, #nData","#"+u+"_2").css("float","right");b(".EditButton","#"+u+"_2").css("text-align","left")}if(a[e.p.id].topinfo){b(".tinfo","#"+u).show()}if(a[e.p.id].bottominfo){b(".binfo","#"+u+"_2").show()}M=null;N=null;b("#"+i.themodal).keydown(function(Y){var Z=Y.target;if(b("#"+x).data("disabled")===true){return false}if(a[e.p.id].savekey[0]===true&&Y.which==a[e.p.id].savekey[1]){if(Z.tagName!="TEXTAREA"){b("#sData","#"+u+"_2").trigger("click");return false}}if(Y.which===27){if(!g()){return false}if(n){b.jgrid.hideModal(this,{gb:d.gbox,jqm:d.jqModal,onClose:a[e.p.id].onClose})}return false}if(a[e.p.id].navkeys[0]===true){if(b("#id_g","#"+u).val()=="_empty"){return true}if(Y.which==a[e.p.id].navkeys[1]){b("#pData","#"+u+"_2").trigger("click");return false}if(Y.which==a[e.p.id].navkeys[2]){b("#nData","#"+u+"_2").trigger("click");return false}}});if(d.checkOnUpdate){b("a.ui-jqdialog-titlebar-close span","#"+i.themodal).removeClass("jqmClose");b("a.ui-jqdialog-titlebar-close","#"+i.themodal).unbind("click").click(function(){if(!g()){return false}b.jgrid.hideModal("#"+i.themodal,{gb:"#gbox_"+A,jqm:d.jqModal,onClose:a[e.p.id].onClose});return false})}d.saveicon=b.extend([true,"left","ui-icon-disk"],d.saveicon);d.closeicon=b.extend([true,"left","ui-icon-close"],d.closeicon);if(d.saveicon[0]===true){b("#sData","#"+u+"_2").addClass(d.saveicon[1]=="right"?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+d.saveicon[2]+"'></span>")}if(d.closeicon[0]===true){b("#cData","#"+u+"_2").addClass(d.closeicon[1]=="right"?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+d.closeicon[2]+"'></span>")}if(a[e.p.id].checkOnSubmit||a[e.p.id].checkOnUpdate){h="<a href='javascript:void(0)' id='sNew' class='fm-button ui-state-default ui-corner-all' style='z-index:1002'>"+d.bYes+"</a>";m="<a href='javascript:void(0)' id='nNew' class='fm-button ui-state-default ui-corner-all' style='z-index:1002'>"+d.bNo+"</a>";t="<a href='javascript:void(0)' id='cNew' class='fm-button ui-state-default ui-corner-all' style='z-index:1002'>"+d.bExit+"</a>";var D,v=d.zIndex||999;v++;if(b.browser.msie&&b.browser.version==6){D='<iframe style="display:block;position:absolute;z-index:-1;filter:Alpha(Opacity=\'0\');" src="javascript:false;"></iframe>'}else{D=""}b("<div class='ui-widget-overlay jqgrid-overlay confirm' style='z-index:"+v+";display:none;'>&#160;"+D+"</div><div class='confirm ui-widget-content ui-jqconfirm' style='z-index:"+(v+1)+"'>"+d.saveData+"<br/><br/>"+h+m+t+"</div>").insertAfter("#"+x);b("#sNew","#"+i.themodal).click(function(){j();b("#"+x).data("disabled",false);b(".confirm","#"+i.themodal).hide();return false});b("#nNew","#"+i.themodal).click(function(){b(".confirm","#"+i.themodal).hide();b("#"+x).data("disabled",false);setTimeout(function(){b(":input","#"+x)[0].focus()},0);return false});b("#cNew","#"+i.themodal).click(function(){b(".confirm","#"+i.themodal).hide();b("#"+x).data("disabled",false);b.jgrid.hideModal("#"+i.themodal,{gb:"#gbox_"+A,jqm:d.jqModal,onClose:a[e.p.id].onClose});return false})}if(o){o(b("#"+x))}if(c=="_empty"||!a[e.p.id].viewPagerButtons){b("#pData,#nData","#"+u+"_2").hide()}else{b("#pData,#nData","#"+u+"_2").show()}if(B){B(b("#"+x))}b("#"+i.themodal).data("onClose",a[e.p.id].onClose);b.jgrid.viewModal("#"+i.themodal,{gbox:"#gbox_"+A,jqm:d.jqModal,overlay:d.overlay,modal:d.modal});if(!l){b(".jqmOverlay").click(function(){if(!g()){return false}b.jgrid.hideModal("#"+i.themodal,{gb:"#gbox_"+A,jqm:d.jqModal,onClose:a[e.p.id].onClose});return false})}if(L){L(b("#"+x))}b(".fm-button","#"+i.themodal).hover(function(){b(this).addClass("ui-state-hover")},function(){b(this).removeClass("ui-state-hover")});b("#sData","#"+u+"_2").click(function(Y){C={};O={};b("#FormError","#"+u).hide();V();if(C[e.p.id+"_id"]=="_empty"){j()}else{if(d.checkOnSubmit===true){E=b.extend({},C,O);z=I(E,a[e.p.id]._savedData);if(z){b("#"+x).data("disabled",true);b(".confirm","#"+i.themodal).show()}else{j()}}else{j()}}return false});b("#cData","#"+u+"_2").click(function(Y){if(!g()){return false}b.jgrid.hideModal("#"+i.themodal,{gb:"#gbox_"+A,jqm:d.jqModal,onClose:a[e.p.id].onClose});return false});b("#nData","#"+u+"_2").click(function(Y){if(!g()){return false}b("#FormError","#"+u).hide();var Z=X();Z[0]=parseInt(Z[0],10);if(Z[0]!=-1&&Z[1][Z[0]+1]){if(b.isFunction(d.onclickPgButtons)){d.onclickPgButtons("next",b("#"+x),Z[1][Z[0]])}p(Z[1][Z[0]+1],e,x);b(e).jqGrid("setSelection",Z[1][Z[0]+1]);if(b.isFunction(d.afterclickPgButtons)){d.afterclickPgButtons("next",b("#"+x),Z[1][Z[0]+1])}H(Z[0]+1,Z[1].length-1)}return false});b("#pData","#"+u+"_2").click(function(Z){if(!g()){return false}b("#FormError","#"+u).hide();var Y=X();if(Y[0]!=-1&&Y[1][Y[0]-1]){if(b.isFunction(d.onclickPgButtons)){d.onclickPgButtons("prev",b("#"+x),Y[1][Y[0]])}p(Y[1][Y[0]-1],e,x);b(e).jqGrid("setSelection",Y[1][Y[0]-1]);if(b.isFunction(d.afterclickPgButtons)){d.afterclickPgButtons("prev",b("#"+x),Y[1][Y[0]-1])}H(Y[0]-1,Y[1].length-1)}return false})}var P=X();H(P[0],P[1].length-1)})},viewGridRow:function(c,d){d=b.extend({top:0,left:0,width:0,height:"auto",dataheight:"auto",modal:false,overlay:30,drag:true,resize:true,jqModal:true,closeOnEscape:false,labelswidth:"30%",closeicon:[],navkeys:[false,38,40],onClose:null,beforeShowForm:null,beforeInitData:null,viewPagerButtons:true},b.jgrid.view,d||{});return this.each(function(){var w=this;if(!w.grid||!c){return}var s=w.p.id,A="ViewGrid_"+s,t="ViewTbl_"+s,j={themodal:"viewmod"+s,modalhead:"viewhd"+s,modalcontent:"viewcnt"+s,scrollelm:A},z=b.isFunction(d.beforeInitData)?d.beforeInitData:false,m=true,h=1,g=0;function k(){if(d.closeOnEscape===true||d.navkeys[0]===true){setTimeout(function(){b(".ui-jqdialog-titlebar-close","#"+j.modalhead).focus()},0)}}function o(K,Q,O,W){var G,J,R,U=0,Z,aa,Y=[],P=false,L="<td class='CaptionTD form-view-label ui-widget-content' width='"+d.labelswidth+"'>&#160;</td><td class='DataTD form-view-data ui-helper-reset ui-widget-content'>&#160;</td>",N="",H="<td class='CaptionTD form-view-label ui-widget-content'>&#160;</td><td class='DataTD form-view-data ui-widget-content'>&#160;</td>",M=["integer","number","currency"],T=0,S=0,I,F,X;for(var V=1;V<=W;V++){N+=V==1?L:H}b(Q.p.colModel).each(function(ac){if(this.editrules&&this.editrules.edithidden===true){J=false}else{J=this.hidden===true?true:false}if(!J&&this.align==="right"){if(this.formatter&&b.inArray(this.formatter,M)!==-1){T=Math.max(T,parseInt(this.width,10))}else{S=Math.max(S,parseInt(this.width,10))}}});I=T!==0?T:S!==0?S:0;P=b(Q).jqGrid("getInd",K);b(Q.p.colModel).each(function(ad){G=this.name;F=false;if(this.editrules&&this.editrules.edithidden===true){J=false}else{J=this.hidden===true?true:false}aa=J?"style='display:none'":"";X=(typeof this.viewable!="boolean")?true:this.viewable;if(G!=="cb"&&G!=="subgrid"&&G!=="rn"&&X){if(P===false){Z=""}else{if(G==Q.p.ExpandColumn&&Q.p.treeGrid===true){Z=b("td:eq("+ad+")",Q.rows[P]).text()}else{Z=b("td:eq("+ad+")",Q.rows[P]).html()}}F=this.align==="right"&&I!==0?true:false;var ac=b.extend({},this.editoptions||{},{id:G,name:G}),ah=b.extend({},{rowabove:false,rowcontent:""},this.formoptions||{}),ae=parseInt(ah.rowpos,10)||U+1,ag=parseInt((parseInt(ah.colpos,10)||1)*2,10);if(ah.rowabove){var af=b("<tr><td class='contentinfo' colspan='"+(W*2)+"'>"+ah.rowcontent+"</td></tr>");b(O).append(af);af[0].rp=ae}R=b(O).find("tr[rowpos="+ae+"]");if(R.length===0){R=b("<tr "+aa+" rowpos='"+ae+"'></tr>").addClass("FormData").attr("id","trv_"+G);b(R).append(N);b(O).append(R);R[0].rp=ae}b("td:eq("+(ag-2)+")",R[0]).html("<b>"+(typeof ah.label==="undefined"?Q.p.colNames[ad]:ah.label)+"</b>");b("td:eq("+(ag-1)+")",R[0]).append("<span>"+Z+"</span>").attr("id","v_"+G);if(F){b("td:eq("+(ag-1)+") span",R[0]).css({"text-align":"right",width:I+"px"})}Y[U]=ad;U++}});if(U>0){var ab=b("<tr class='FormData' style='display:none'><td class='CaptionTD'></td><td colspan='"+(W*2-1)+"' class='DataTD'><input class='FormElement' id='id_g' type='text' name='id' value='"+K+"'/></td></tr>");ab[0].rp=U+99;b(O).append(ab)}return Y}function n(J,L){var F,M,I=0,H,G,K;K=b(L).jqGrid("getInd",J,true);if(!K){return}b("td",K).each(function(N){F=L.p.colModel[N].name;if(L.p.colModel[N].editrules&&L.p.colModel[N].editrules.edithidden===true){M=false}else{M=L.p.colModel[N].hidden===true?true:false}if(F!=="cb"&&F!=="subgrid"&&F!=="rn"){if(F==L.p.ExpandColumn&&L.p.treeGrid===true){H=b(this).text()}else{H=b(this).html()}G=b.extend({},L.p.colModel[N].editoptions||{});F=b.jgrid.jqID("v_"+F);b("#"+F+" span","#"+t).html(H);if(M){b("#"+F,"#"+t).parents("tr:first").hide()}I++}});if(I>0){b("#id_g","#"+t).val(J)}}function p(F,G){if(F===0){b("#pData","#"+t+"_2").addClass("ui-state-disabled")}else{b("#pData","#"+t+"_2").removeClass("ui-state-disabled")}if(F==G){b("#nData","#"+t+"_2").addClass("ui-state-disabled")}else{b("#nData","#"+t+"_2").removeClass("ui-state-disabled")}}function i(){var G=b(w).jqGrid("getDataIDs"),F=b("#id_g","#"+t).val(),H=b.inArray(F,G);return[H,G]}if(b("#"+j.themodal).html()!==null){if(z){m=z(b("#"+A));if(typeof(m)=="undefined"){m=true}}if(m===false){return}b(".ui-jqdialog-title","#"+j.modalhead).html(d.caption);b("#FormError","#"+t).hide();n(c,w);if(b.isFunction(d.beforeShowForm)){d.beforeShowForm(b("#"+A))}b.jgrid.viewModal("#"+j.themodal,{gbox:"#gbox_"+s,jqm:d.jqModal,jqM:false,overlay:d.overlay,modal:d.modal});k()}else{var y=isNaN(d.dataheight)?d.dataheight:d.dataheight+"px";var C=b("<form name='FormPost' id='"+A+"' class='FormGrid' style='width:100%;overflow:auto;position:relative;height:"+y+";'></form>"),l=b("<table id='"+t+"' class='EditTable' cellspacing='1' cellpadding='2' border='0' style='table-layout:fixed'><tbody></tbody></table>");if(z){m=z(b("#"+A));if(typeof(m)=="undefined"){m=true}}if(m===false){return}b(w.p.colModel).each(function(F){var G=this.formoptions;h=Math.max(h,G?G.colpos||0:0);g=Math.max(g,G?G.rowpos||0:0)});b(C).append(l);o(c,w,l,h);var x=w.p.direction=="rtl"?true:false,E=x?"nData":"pData",f=x?"pData":"nData",u="<a href='javascript:void(0)' id='"+E+"' class='fm-button ui-state-default ui-corner-left'><span class='ui-icon ui-icon-triangle-1-w'></span></a>",v="<a href='javascript:void(0)' id='"+f+"' class='fm-button ui-state-default ui-corner-right'><span class='ui-icon ui-icon-triangle-1-e'></span></a>",D="<a href='javascript:void(0)' id='cData' class='fm-button ui-state-default ui-corner-all'>"+d.bClose+"</a>";if(g>0){var e=[];b.each(b(l)[0].rows,function(F,G){e[F]=G});e.sort(function(G,F){if(G.rp>F.rp){return 1}if(G.rp<F.rp){return -1}return 0});b.each(e,function(F,G){b("tbody",l).append(G)})}d.gbox="#gbox_"+s;var r=false;if(d.closeOnEscape===true){d.closeOnEscape=false;r=true}var B=b("<span></span>").append(C).append("<table border='0' class='EditTable' id='"+t+"_2'><tbody><tr id='Act_Buttons'><td class='navButton' width='"+d.labelswidth+"'>"+(x?v+u:u+v)+"</td><td class='EditButton'>"+D+"</td></tr></tbody></table>");b.jgrid.createModal(j,B,d,"#gview_"+w.p.id,b("#gview_"+w.p.id)[0]);if(x){b("#pData, #nData","#"+t+"_2").css("float","right");b(".EditButton","#"+t+"_2").css("text-align","left")}if(!d.viewPagerButtons){b("#pData, #nData","#"+t+"_2").hide()}B=null;b("#"+j.themodal).keydown(function(F){if(F.which===27){if(r){b.jgrid.hideModal(this,{gb:d.gbox,jqm:d.jqModal,onClose:d.onClose})}return false}if(d.navkeys[0]===true){if(F.which===d.navkeys[1]){b("#pData","#"+t+"_2").trigger("click");return false}if(F.which===d.navkeys[2]){b("#nData","#"+t+"_2").trigger("click");return false}}});d.closeicon=b.extend([true,"left","ui-icon-close"],d.closeicon);if(d.closeicon[0]===true){b("#cData","#"+t+"_2").addClass(d.closeicon[1]=="right"?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+d.closeicon[2]+"'></span>")}if(b.isFunction(d.beforeShowForm)){d.beforeShowForm(b("#"+A))}b.jgrid.viewModal("#"+j.themodal,{gbox:"#gbox_"+s,jqm:d.jqModal,modal:d.modal});b(".fm-button:not(.ui-state-disabled)","#"+t+"_2").hover(function(){b(this).addClass("ui-state-hover")},function(){b(this).removeClass("ui-state-hover")});k();b("#cData","#"+t+"_2").click(function(F){b.jgrid.hideModal("#"+j.themodal,{gb:"#gbox_"+s,jqm:d.jqModal,onClose:d.onClose});return false});b("#nData","#"+t+"_2").click(function(F){b("#FormError","#"+t).hide();var G=i();G[0]=parseInt(G[0],10);if(G[0]!=-1&&G[1][G[0]+1]){if(b.isFunction(d.onclickPgButtons)){d.onclickPgButtons("next",b("#"+A),G[1][G[0]])}n(G[1][G[0]+1],w);b(w).jqGrid("setSelection",G[1][G[0]+1]);if(b.isFunction(d.afterclickPgButtons)){d.afterclickPgButtons("next",b("#"+A),G[1][G[0]+1])}p(G[0]+1,G[1].length-1)}k();return false});b("#pData","#"+t+"_2").click(function(G){b("#FormError","#"+t).hide();var F=i();if(F[0]!=-1&&F[1][F[0]-1]){if(b.isFunction(d.onclickPgButtons)){d.onclickPgButtons("prev",b("#"+A),F[1][F[0]])}n(F[1][F[0]-1],w);b(w).jqGrid("setSelection",F[1][F[0]-1]);if(b.isFunction(d.afterclickPgButtons)){d.afterclickPgButtons("prev",b("#"+A),F[1][F[0]-1])}p(F[0]-1,F[1].length-1)}k();return false})}var q=i();p(q[0],q[1].length-1)})},delGridRow:function(c,d){d=b.extend({top:0,left:0,width:240,height:"auto",dataheight:"auto",modal:false,overlay:30,drag:true,resize:true,url:"",mtype:"POST",reloadAfterSubmit:true,beforeShowForm:null,beforeInitData:null,afterShowForm:null,beforeSubmit:null,onclickSubmit:null,afterSubmit:null,jqModal:true,closeOnEscape:false,delData:{},delicon:[],cancelicon:[],onClose:null,ajaxDelOptions:{},processing:false,serializeDelData:null,useDataProxy:false},b.jgrid.del,d||{});a[b(this)[0].p.id]=d;return this.each(function(){var o=this;if(!o.grid){return}if(!c){return}var p=b.isFunction(a[o.p.id].beforeShowForm),g=b.isFunction(a[o.p.id].afterShowForm),s=b.isFunction(a[o.p.id].beforeInitData)?a[o.p.id].beforeInitData:false,e=o.p.id,f={},k=true,l="DelTbl_"+e,r,q,n,j,h={themodal:"delmod"+e,modalhead:"delhd"+e,modalcontent:"delcnt"+e,scrollelm:l};if(jQuery.isArray(c)){c=c.join()}if(b("#"+h.themodal).html()!==null){if(s){k=s(b("#"+l));if(typeof(k)=="undefined"){k=true}}if(k===false){return}b("#DelData>td","#"+l).text(c);b("#DelError","#"+l).hide();if(a[o.p.id].processing===true){a[o.p.id].processing=false;b("#dData","#"+l).removeClass("ui-state-active")}if(p){a[o.p.id].beforeShowForm(b("#"+l))}b.jgrid.viewModal("#"+h.themodal,{gbox:"#gbox_"+e,jqm:a[o.p.id].jqModal,jqM:false,overlay:a[o.p.id].overlay,modal:a[o.p.id].modal});if(g){a[o.p.id].afterShowForm(b("#"+l))}}else{var t=isNaN(a[o.p.id].dataheight)?a[o.p.id].dataheight:a[o.p.id].dataheight+"px";var m="<div id='"+l+"' class='formdata' style='width:100%;overflow:auto;position:relative;height:"+t+";'>";m+="<table class='DelTable'><tbody>";m+="<tr id='DelError' style='display:none'><td class='ui-state-error'></td></tr>";m+="<tr id='DelData' style='display:none'><td >"+c+"</td></tr>";m+='<tr><td class="delmsg" style="white-space:pre;">'+a[o.p.id].msg+"</td></tr><tr><td >&#160;</td></tr>";m+="</tbody></table></div>";var i="<a href='javascript:void(0)' id='dData' class='fm-button ui-state-default ui-corner-all'>"+d.bSubmit+"</a>",u="<a href='javascript:void(0)' id='eData' class='fm-button ui-state-default ui-corner-all'>"+d.bCancel+"</a>";m+="<table cellspacing='0' cellpadding='0' border='0' class='EditTable' id='"+l+"_2'><tbody><tr><td><hr class='ui-widget-content' style='margin:1px'/></td></tr><tr><td class='DelButton EditButton'>"+i+"&#160;"+u+"</td></tr></tbody></table>";d.gbox="#gbox_"+e;b.jgrid.createModal(h,m,d,"#gview_"+o.p.id,b("#gview_"+o.p.id)[0]);if(s){k=s(b("#"+l));if(typeof(k)=="undefined"){k=true}}if(k===false){return}b(".fm-button","#"+l+"_2").hover(function(){b(this).addClass("ui-state-hover")},function(){b(this).removeClass("ui-state-hover")});d.delicon=b.extend([true,"left","ui-icon-scissors"],a[o.p.id].delicon);d.cancelicon=b.extend([true,"left","ui-icon-cancel"],a[o.p.id].cancelicon);if(d.delicon[0]===true){b("#dData","#"+l+"_2").addClass(d.delicon[1]=="right"?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+d.delicon[2]+"'></span>")}if(d.cancelicon[0]===true){b("#eData","#"+l+"_2").addClass(d.cancelicon[1]=="right"?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+d.cancelicon[2]+"'></span>")}b("#dData","#"+l+"_2").click(function(A){var x=[true,""];f={};var y=b("#DelData>td","#"+l).text();if(b.isFunction(a[o.p.id].onclickSubmit)){f=a[o.p.id].onclickSubmit(a[o.p.id],y)||{}}if(b.isFunction(a[o.p.id].beforeSubmit)){x=a[o.p.id].beforeSubmit(y)}if(x[0]&&!a[o.p.id].processing){a[o.p.id].processing=true;b(this).addClass("ui-state-active");n=o.p.prmNames;r=b.extend({},a[o.p.id].delData,f);j=n.oper;r[j]=n.deloper;q=n.id;y=y.split(",");for(var z in y){if(y.hasOwnProperty(z)){y[z]=b.jgrid.stripPref(o.p.idPrefix,y[z])}}r[q]=y.join();var v=b.extend({url:a[o.p.id].url?a[o.p.id].url:b(o).jqGrid("getGridParam","editurl"),type:a[o.p.id].mtype,data:b.isFunction(a[o.p.id].serializeDelData)?a[o.p.id].serializeDelData(r):r,complete:function(E,C){if(C!="success"){x[0]=false;if(b.isFunction(a[o.p.id].errorTextFormat)){x[1]=a[o.p.id].errorTextFormat(E)}else{x[1]=C+" Status: '"+E.statusText+"'. Error code: "+E.status}}else{if(b.isFunction(a[o.p.id].afterSubmit)){x=a[o.p.id].afterSubmit(E,r)}}if(x[0]===false){b("#DelError>td","#"+l).html(x[1]);b("#DelError","#"+l).show()}else{if(a[o.p.id].reloadAfterSubmit&&o.p.datatype!="local"){b(o).trigger("reloadGrid")}else{var B=[];B=y.split(",");if(o.p.treeGrid===true){try{b(o).jqGrid("delTreeNode",o.p.idPrefix+B[0])}catch(F){}}else{for(var D=0;D<B.length;D++){b(o).jqGrid("delRowData",o.p.idPrefix+B[D])}}o.p.selrow=null;o.p.selarrrow=[]}if(b.isFunction(a[o.p.id].afterComplete)){setTimeout(function(){a[o.p.id].afterComplete(E,y)},500)}}a[o.p.id].processing=false;b("#dData","#"+l+"_2").removeClass("ui-state-active");if(x[0]){b.jgrid.hideModal("#"+h.themodal,{gb:"#gbox_"+e,jqm:d.jqModal,onClose:a[o.p.id].onClose})}}},b.jgrid.ajaxOptions,a[o.p.id].ajaxDelOptions);if(!v.url&&!a[o.p.id].useDataProxy){if(b.isFunction(o.p.dataProxy)){a[o.p.id].useDataProxy=true}else{x[0]=false;x[1]+=" "+b.jgrid.errors.nourl}}if(x[0]){if(a[o.p.id].useDataProxy){var w=o.p.dataProxy.call(o,v,"del_"+o.p.id);if(typeof(w)=="undefined"){w=[true,""]}if(w[0]===false){x[0]=false;x[1]=w[1]||"Error deleting the selected row!"}else{b.jgrid.hideModal("#"+h.themodal,{gb:"#gbox_"+e,jqm:d.jqModal,onClose:a[o.p.id].onClose})}}else{b.ajax(v)}}}if(x[0]===false){b("#DelError>td","#"+l).html(x[1]);b("#DelError","#"+l).show()}return false});b("#eData","#"+l+"_2").click(function(v){b.jgrid.hideModal("#"+h.themodal,{gb:"#gbox_"+e,jqm:a[o.p.id].jqModal,onClose:a[o.p.id].onClose});return false});if(p){a[o.p.id].beforeShowForm(b("#"+l))}b.jgrid.viewModal("#"+h.themodal,{gbox:"#gbox_"+e,jqm:a[o.p.id].jqModal,overlay:a[o.p.id].overlay,modal:a[o.p.id].modal});if(g){a[o.p.id].afterShowForm(b("#"+l))}}if(a[o.p.id].closeOnEscape===true){setTimeout(function(){b(".ui-jqdialog-titlebar-close","#"+h.modalhead).focus()},0)}})},navGrid:function(f,h,e,g,d,c,i){h=b.extend({edit:true,editicon:"ui-icon-pencil",add:true,addicon:"ui-icon-plus",del:true,delicon:"ui-icon-trash",search:true,searchicon:"ui-icon-search",refresh:true,refreshicon:"ui-icon-refresh",refreshstate:"firstpage",view:false,viewicon:"ui-icon-document",position:"left",closeOnEscape:true,beforeRefresh:null,afterRefresh:null,cloneToTop:false,alertwidth:200,alertheight:"auto",alerttop:null,alertleft:null,alertzIndex:null},b.jgrid.nav,h||{});return this.each(function(){if(this.nav){return}var j={themodal:"alertmod",modalhead:"alerthd",modalcontent:"alertcnt"},m=this,o,k;if(!m.grid||typeof f!="string"){return}if(b("#"+j.themodal).html()===null){if(!h.alerttop&&!h.alertleft){if(typeof window.innerWidth!="undefined"){h.alertleft=window.innerWidth;h.alerttop=window.innerHeight}else{if(typeof document.documentElement!="undefined"&&typeof document.documentElement.clientWidth!="undefined"&&document.documentElement.clientWidth!==0){h.alertleft=document.documentElement.clientWidth;h.alerttop=document.documentElement.clientHeight}else{h.alertleft=1024;h.alerttop=768}}h.alertleft=h.alertleft/2-parseInt(h.alertwidth,10)/2;h.alerttop=h.alerttop/2-25}b.jgrid.createModal(j,"<div>"+h.alerttext+"</div><span tabindex='0'><span tabindex='-1' id='jqg_alrt'></span></span>",{gbox:"#gbox_"+m.p.id,jqModal:true,drag:true,resize:true,caption:h.alertcap,top:h.alerttop,left:h.alertleft,width:h.alertwidth,height:h.alertheight,closeOnEscape:h.closeOnEscape,zIndex:h.alertzIndex},"","",true)}var p=1;if(h.cloneToTop&&m.p.toppager){p=2}for(var n=0;n<p;n++){var q,s=b("<table cellspacing='0' cellpadding='0' border='0' class='ui-pg-table navtable' style='float:left;table-layout:auto;'><tbody><tr></tr></tbody></table>"),t="<td class='ui-pg-button ui-state-disabled' style='width:4px;'><span class='ui-separator'></span></td>",l,r;if(n===0){l=f;r=m.p.id;if(l==m.p.toppager){r+="_top";p=1}}else{l=m.p.toppager;r=m.p.id+"_top"}if(m.p.direction=="rtl"){b(s).attr("dir","rtl").css("float","right")}if(h.add){g=g||{};q=b("<td class='ui-pg-button ui-corner-all'></td>");b(q).append("<div class='ui-pg-div'><span class='ui-icon "+h.addicon+"'></span>"+h.addtext+"</div>");b("tr",s).append(q);b(q,s).attr({title:h.addtitle||"",id:g.id||"add_"+r}).click(function(){if(!b(this).hasClass("ui-state-disabled")){if(b.isFunction(h.addfunc)){h.addfunc()}else{b(m).jqGrid("editGridRow","new",g)}}return false}).hover(function(){if(!b(this).hasClass("ui-state-disabled")){b(this).addClass("ui-state-hover")}},function(){b(this).removeClass("ui-state-hover")});q=null}if(h.edit){q=b("<td class='ui-pg-button ui-corner-all'></td>");e=e||{};b(q).append("<div class='ui-pg-div'><span class='ui-icon "+h.editicon+"'></span>"+h.edittext+"</div>");b("tr",s).append(q);b(q,s).attr({title:h.edittitle||"",id:e.id||"edit_"+r}).click(function(){if(!b(this).hasClass("ui-state-disabled")){var u=m.p.selrow;if(u){if(b.isFunction(h.editfunc)){h.editfunc(u)}else{b(m).jqGrid("editGridRow",u,e)}}else{b.jgrid.viewModal("#"+j.themodal,{gbox:"#gbox_"+m.p.id,jqm:true});b("#jqg_alrt").focus()}}return false}).hover(function(){if(!b(this).hasClass("ui-state-disabled")){b(this).addClass("ui-state-hover")}},function(){b(this).removeClass("ui-state-hover")});q=null}if(h.view){q=b("<td class='ui-pg-button ui-corner-all'></td>");i=i||{};b(q).append("<div class='ui-pg-div'><span class='ui-icon "+h.viewicon+"'></span>"+h.viewtext+"</div>");b("tr",s).append(q);b(q,s).attr({title:h.viewtitle||"",id:i.id||"view_"+r}).click(function(){if(!b(this).hasClass("ui-state-disabled")){var u=m.p.selrow;if(u){if(b.isFunction(h.viewfunc)){h.viewfunc(u)}else{b(m).jqGrid("viewGridRow",u,i)}}else{b.jgrid.viewModal("#"+j.themodal,{gbox:"#gbox_"+m.p.id,jqm:true});b("#jqg_alrt").focus()}}return false}).hover(function(){if(!b(this).hasClass("ui-state-disabled")){b(this).addClass("ui-state-hover")}},function(){b(this).removeClass("ui-state-hover")});q=null}if(h.del){q=b("<td class='ui-pg-button ui-corner-all'></td>");d=d||{};b(q).append("<div class='ui-pg-div'><span class='ui-icon "+h.delicon+"'></span>"+h.deltext+"</div>");b("tr",s).append(q);b(q,s).attr({title:h.deltitle||"",id:d.id||"del_"+r}).click(function(){if(!b(this).hasClass("ui-state-disabled")){var u;if(m.p.multiselect){u=m.p.selarrrow;if(u.length===0){u=null}}else{u=m.p.selrow}if(u){if("function"==typeof h.delfunc){h.delfunc(u)}else{b(m).jqGrid("delGridRow",u,d)}}else{b.jgrid.viewModal("#"+j.themodal,{gbox:"#gbox_"+m.p.id,jqm:true});b("#jqg_alrt").focus()}}return false}).hover(function(){if(!b(this).hasClass("ui-state-disabled")){b(this).addClass("ui-state-hover")}},function(){b(this).removeClass("ui-state-hover")});q=null}if(h.add||h.edit||h.del||h.view){b("tr",s).append(t)}if(h.search){q=b("<td class='ui-pg-button ui-corner-all'></td>");c=c||{};b(q).append("<div class='ui-pg-div'><span class='ui-icon "+h.searchicon+"'></span>"+h.searchtext+"</div>");b("tr",s).append(q);b(q,s).attr({title:h.searchtitle||"",id:c.id||"search_"+r}).click(function(){if(!b(this).hasClass("ui-state-disabled")){b(m).jqGrid("searchGrid",c)}return false}).hover(function(){if(!b(this).hasClass("ui-state-disabled")){b(this).addClass("ui-state-hover")}},function(){b(this).removeClass("ui-state-hover")});if(c.showOnLoad&&c.showOnLoad===true){b(q,s).click()}q=null}if(h.refresh){q=b("<td class='ui-pg-button ui-corner-all'></td>");b(q).append("<div class='ui-pg-div'><span class='ui-icon "+h.refreshicon+"'></span>"+h.refreshtext+"</div>");b("tr",s).append(q);b(q,s).attr({title:h.refreshtitle||"",id:"refresh_"+r}).click(function(){if(!b(this).hasClass("ui-state-disabled")){if(b.isFunction(h.beforeRefresh)){h.beforeRefresh()}m.p.search=false;try{var u=m.p.id;m.p.postData.filters="";b("#fbox_"+u).jqFilter("resetFilter");if(b.isFunction(m.clearToolbar)){m.clearToolbar(false)}}catch(v){}switch(h.refreshstate){case"firstpage":b(m).trigger("reloadGrid",[{page:1}]);break;case"current":b(m).trigger("reloadGrid",[{current:true}]);break}if(b.isFunction(h.afterRefresh)){h.afterRefresh()}}return false}).hover(function(){if(!b(this).hasClass("ui-state-disabled")){b(this).addClass("ui-state-hover")}},function(){b(this).removeClass("ui-state-hover")});q=null}k=b(".ui-jqgrid").css("font-size")||"11px";b("body").append("<div id='testpg2' class='ui-jqgrid ui-widget ui-widget-content' style='font-size:"+k+";visibility:hidden;' ></div>");o=b(s).clone().appendTo("#testpg2").width();b("#testpg2").remove();b(l+"_"+h.position,l).append(s);if(m.p._nvtd){if(o>m.p._nvtd[0]){b(l+"_"+h.position,l).width(o);m.p._nvtd[0]=o}m.p._nvtd[1]=o}k=null;o=null;s=null;this.nav=true}})},navButtonAdd:function(c,d){d=b.extend({caption:"newButton",title:"",buttonicon:"ui-icon-newwin",onClickButton:null,position:"last",cursor:"pointer"},d||{});return this.each(function(){if(!this.grid){return}if(c.indexOf("#")!==0){c="#"+c}var e=b(".navtable",c)[0],g=this;if(e){if(d.id&&b("#"+d.id,e).html()!==null){return}var f=b("<td></td>");if(d.buttonicon.toString().toUpperCase()=="NONE"){b(f).addClass("ui-pg-button ui-corner-all").append("<div class='ui-pg-div'>"+d.caption+"</div>")}else{b(f).addClass("ui-pg-button ui-corner-all").append("<div class='ui-pg-div'><span class='ui-icon "+d.buttonicon+"'></span>"+d.caption+"</div>")}if(d.id){b(f).attr("id",d.id)}if(d.position=="first"){if(e.rows[0].cells.length===0){b("tr",e).append(f)}else{b("tr td:eq(0)",e).before(f)}}else{b("tr",e).append(f)}b(f,e).attr("title",d.title||"").click(function(h){if(!b(this).hasClass("ui-state-disabled")){if(b.isFunction(d.onClickButton)){d.onClickButton.call(g,h)}}return false}).hover(function(){if(!b(this).hasClass("ui-state-disabled")){b(this).addClass("ui-state-hover")}},function(){b(this).removeClass("ui-state-hover")})}})},navSeparatorAdd:function(c,d){d=b.extend({sepclass:"ui-separator",sepcontent:""},d||{});return this.each(function(){if(!this.grid){return}if(c.indexOf("#")!==0){c="#"+c}var f=b(".navtable",c)[0];if(f){var e="<td class='ui-pg-button ui-state-disabled' style='width:4px;'><span class='"+d.sepclass+"'></span>"+d.sepcontent+"</td>";b("tr",f).append(e)}})},GridToForm:function(c,d){return this.each(function(){var g=this;if(!g.grid){return}var f=b(g).jqGrid("getRowData",c);if(f){for(var e in f){if(b("[name="+b.jgrid.jqID(e)+"]",d).is("input:radio")||b("[name="+b.jgrid.jqID(e)+"]",d).is("input:checkbox")){b("[name="+b.jgrid.jqID(e)+"]",d).each(function(){if(b(this).val()==f[e]){b(this)[g.p.useProp?"prop":"attr"]("checked",true)}else{b(this)[g.p.useProp?"prop":"attr"]("checked",false)}})}else{b("[name="+b.jgrid.jqID(e)+"]",d).val(f[e])}}}})},FormToGrid:function(d,e,f,c){return this.each(function(){var i=this;if(!i.grid){return}if(!f){f="set"}if(!c){c="first"}var g=b(e).serializeArray();var h={};b.each(g,function(j,k){h[k.name]=k.value});if(f=="add"){b(i).jqGrid("addRowData",d,h,c)}else{if(f=="set"){b(i).jqGrid("setRowData",d,h)}}})}})})(jQuery);