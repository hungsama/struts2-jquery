/**
 * jqGrid extension for form editing Grid Data
 * Tony Tomov tony@trirand.com
 * http://trirand.com/blog/
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl-2.0.html
**/
(function(b){var a={};b.jgrid.extend({searchGrid:function(c){c=b.extend({recreateFilter:false,drag:true,sField:"searchField",sValue:"searchString",sOper:"searchOper",sFilter:"filters",loadDefaults:true,beforeShowSearch:null,afterShowSearch:null,onInitializeSearch:null,afterRedraw:null,closeAfterSearch:false,closeAfterReset:false,closeOnEscape:false,multipleSearch:false,multipleGroup:false,top:0,left:0,jqModal:true,modal:false,resize:true,width:450,height:"auto",dataheight:"auto",showQuery:false,errorcheck:true,sopt:null,stringResult:undefined,onClose:null,onSearch:null,onReset:null,toTop:true,overlay:30,columns:[],tmplNames:null,tmplFilters:null,tmplLabel:" Template: ",showOnLoad:false,layer:null},b.jgrid.search,c||{});return this.each(function(){var t=this;if(!t.grid){return}var d="fbox_"+t.p.id,j=true,f={themodal:"searchmod"+d,modalhead:"searchhd"+d,modalcontent:"searchcnt"+d,scrollelm:d},g=t.p.postData[c.sFilter];if(typeof(g)==="string"){g=b.jgrid.parse(g)}if(c.recreateFilter===true){b("#"+f.themodal).remove()}function h(){if(b.isFunction(c.beforeShowSearch)){j=c.beforeShowSearch(b("#"+d));if(typeof(j)==="undefined"){j=true}}if(j){b.jgrid.viewModal("#"+f.themodal,{gbox:"#gbox_"+d,jqm:c.jqModal,modal:c.modal,overlay:c.overlay,toTop:c.toTop});if(b.isFunction(c.afterShowSearch)){c.afterShowSearch(b("#"+d))}}}if(b("#"+f.themodal).html()!==null){h()}else{var u=b("<div><div id='"+d+"' class='searchFilter' style='overflow:auto'></div></div>").insertBefore("#gview_"+t.p.id),s="left",k="";if(t.p.direction=="rtl"){s="right";k=" style='text-align:left'";u.attr("dir","rtl")}if(b.isFunction(c.onInitializeSearch)){c.onInitializeSearch(b("#"+d))}var e=b.extend([],t.p.colModel),p="<a href='javascript:void(0)' id='"+d+"_search' class='fm-button ui-state-default ui-corner-all fm-button-icon-right ui-reset'><span class='ui-icon ui-icon-search'></span>"+c.Find+"</a>",w="<a href='javascript:void(0)' id='"+d+"_reset' class='fm-button ui-state-default ui-corner-all fm-button-icon-left ui-search'><span class='ui-icon ui-icon-arrowreturnthick-1-w'></span>"+c.Reset+"</a>",r="",l="",n,o=false,v,q=-1;if(c.showQuery){r="<a href='javascript:void(0)' id='"+d+"_query' class='fm-button ui-state-default ui-corner-all fm-button-icon-left'><span class='ui-icon ui-icon-comment'></span>Query</a>"}if(!c.columns.length){b.each(e,function(y,B){if(!B.label){B.label=t.p.colNames[y]}if(!o){var x=(typeof B.search==="undefined")?true:B.search,A=(B.hidden===true),z=(B.searchoptions&&B.searchoptions.searchhidden===true);if((z&&x)||(x&&!A)){o=true;n=B.index||B.name;q=y}}})}else{e=c.columns}if((!g&&n)||c.multipleSearch===false){var m="eq";if(q>=0&&e[q].searchoptions&&e[q].searchoptions.sopt){m=e[q].searchoptions.sopt[0]}else{if(c.sopt&&c.sopt.length){m=c.sopt[0]}}g={groupOp:"AND",rules:[{field:n,op:m,data:""}]}}o=false;if(c.tmplNames&&c.tmplNames.length){o=true;l=c.tmplLabel;l+="<select class='ui-template'>";l+="<option value='default'>Default</option>";b.each(c.tmplNames,function(x,y){l+="<option value='"+x+"'>"+y+"</option>"});l+="</select>"}v="<table class='EditTable' style='border:0px none;margin-top:5px' id='"+d+"_2'><tbody><tr><td colspan='2'><hr class='ui-widget-content' style='margin:1px'/></td></tr><tr><td class='EditButton' style='text-align:"+s+"'>"+w+l+"</td><td class='EditButton' "+k+">"+r+p+"</td></tr></tbody></table>";b("#"+d).jqFilter({columns:e,filter:c.loadDefaults?g:null,showQuery:c.showQuery,errorcheck:c.errorcheck,sopt:c.sopt,groupButton:c.multipleGroup,ruleButtons:c.multipleSearch,afterRedraw:c.afterRedraw,_gridsopt:b.jgrid.search.odata,onChange:function(x){if(this.p.showQuery){b(".query",this).html(this.toUserFriendlyString())}},direction:t.p.direction});u.append(v);if(o&&c.tmplFilters&&c.tmplFilters.length){b(".ui-template",u).bind("change",function(y){var x=b(this).val();if(x=="default"){b("#"+d).jqFilter("addFilter",g)}else{b("#"+d).jqFilter("addFilter",c.tmplFilters[parseInt(x,10)])}return false})}if(c.multipleGroup===true){c.multipleSearch=true}if(b.isFunction(c.onInitializeSearch)){c.onInitializeSearch(b("#"+d))}c.gbox="#gbox_"+d;if(c.layer){b.jgrid.createModal(f,u,c,"#gview_"+t.p.id,b("#gbox_"+t.p.id)[0],"#"+c.layer,{position:"relative"})}else{b.jgrid.createModal(f,u,c,"#gview_"+t.p.id,b("#gbox_"+t.p.id)[0])}if(r){b("#"+d+"_query").bind("click",function(x){b(".queryresult",u).toggle();return false})}if(c.stringResult===undefined){c.stringResult=c.multipleSearch}b("#"+d+"_search").bind("click",function(){var A=b("#"+d),y={},x,z=A.jqFilter("filterData");if(c.errorcheck){A[0].hideError();if(!c.showQuery){A.jqFilter("toSQLString")}if(A[0].p.error){A[0].showError();return false}}if(c.stringResult){try{x=xmlJsonClass.toJson(z,"","",false)}catch(C){try{x=JSON.stringify(z)}catch(B){}}if(typeof(x)==="string"){y[c.sFilter]=x;b.each([c.sField,c.sValue,c.sOper],function(){y[this]=""})}}else{if(c.multipleSearch){y[c.sFilter]=z;b.each([c.sField,c.sValue,c.sOper],function(){y[this]=""})}else{y[c.sField]=z.rules[0].field;y[c.sValue]=z.rules[0].data;y[c.sOper]=z.rules[0].op;y[c.sFilter]=""}}t.p.search=true;b.extend(t.p.postData,y);if(b.isFunction(c.onSearch)){c.onSearch()}b(t).trigger("reloadGrid",[{page:1}]);if(c.closeAfterSearch){b.jgrid.hideModal("#"+f.themodal,{gb:"#gbox_"+t.p.id,jqm:c.jqModal,onClose:c.onClose})}return false});b("#"+d+"_reset").bind("click",function(){var x={},y=b("#"+d);t.p.search=false;if(c.multipleSearch===false){x[c.sField]=x[c.sValue]=x[c.sOper]=""}else{x[c.sFilter]=""}y[0].resetFilter();if(o){b(".ui-template",u).val("default")}b.extend(t.p.postData,x);if(b.isFunction(c.onReset)){c.onReset()}b(t).trigger("reloadGrid",[{page:1}]);return false});h();b(".fm-button:not(.ui-state-disabled)",u).hover(function(){b(this).addClass("ui-state-hover")},function(){b(this).removeClass("ui-state-hover")})}})},editGridRow:function(c,d){d=b.extend({top:0,left:0,width:300,height:"auto",dataheight:"auto",modal:false,overlay:30,drag:true,resize:true,url:null,mtype:"POST",clearAfterAdd:true,closeAfterEdit:false,reloadAfterSubmit:true,onInitializeForm:null,beforeInitData:null,beforeShowForm:null,afterShowForm:null,beforeSubmit:null,afterSubmit:null,onclickSubmit:null,afterComplete:null,onclickPgButtons:null,afterclickPgButtons:null,editData:{},recreateForm:false,jqModal:true,closeOnEscape:false,addedrow:"first",topinfo:"",bottominfo:"",saveicon:[],closeicon:[],savekey:[false,13],navkeys:[false,38,40],checkOnSubmit:false,checkOnUpdate:false,_savedData:{},processing:false,onClose:null,ajaxEditOptions:{},serializeEditData:null,viewPagerButtons:true},b.jgrid.edit,d||{});a[b(this)[0].p.id]=d;return this.each(function(){var e=this;if(!e.grid||!c){return}var B=e.p.id,y="FrmGrid_"+B,v="TblGrid_"+B,j={themodal:"editmod"+B,modalhead:"edithd"+B,modalcontent:"editcnt"+B,scrollelm:y},C=b.isFunction(a[e.p.id].beforeShowForm)?a[e.p.id].beforeShowForm:false,M=b.isFunction(a[e.p.id].afterShowForm)?a[e.p.id].afterShowForm:false,L=b.isFunction(a[e.p.id].beforeInitData)?a[e.p.id].beforeInitData:false,p=b.isFunction(a[e.p.id].onInitializeForm)?a[e.p.id].onInitializeForm:false,G=null,Y=true,H=1,r=0,D,P,F,A;if(c==="new"){c="_empty";d.caption=a[e.p.id].addCaption}else{d.caption=a[e.p.id].editCaption}if(d.recreateForm===true&&b("#"+j.themodal).html()!==null){b("#"+j.themodal).remove()}var m=true;if(d.checkOnUpdate&&d.jqModal&&!d.modal){m=false}function X(){b("#"+v+" > tbody > tr > td > .FormElement").each(function(ac){var af=b(".customelement",this);if(af.length){var ad=af[0],aa=b(ad).attr("name");b.each(e.p.colModel,function(ag,ai){if(this.name===aa&&this.editoptions&&b.isFunction(this.editoptions.custom_value)){try{D[aa]=this.editoptions.custom_value(b("#"+b.jgrid.jqID(aa),"#"+v),"get");if(D[aa]===undefined){throw"e1"}}catch(ah){if(ah==="e1"){b.jgrid.info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+b.jgrid.edit.msg.novalue,jQuery.jgrid.edit.bClose)}else{b.jgrid.info_dialog(jQuery.jgrid.errors.errcap,ah.message,jQuery.jgrid.edit.bClose)}}return true}})}else{switch(b(this).get(0).type){case"checkbox":if(b(this).is(":checked")){D[this.name]=b(this).val()}else{var ab=b(this).attr("offval");D[this.name]=ab}break;case"select-one":D[this.name]=b("option:selected",this).val();P[this.name]=b("option:selected",this).text();break;case"select-multiple":D[this.name]=b(this).val();if(D[this.name]){D[this.name]=D[this.name].join(",")}else{D[this.name]=""}var ae=[];b("option:selected",this).each(function(ag,ah){ae[ag]=b(ah).text()});P[this.name]=ae.join(",");break;case"password":case"text":case"textarea":case"button":D[this.name]=b(this).val();break}if(e.p.autoencode){D[this.name]=b.jgrid.htmlEncode(D[this.name])}}});return true}function t(ac,aj,ag,ae){var aq,ak,ab,af=0,ai,ap,aa,am=[],ad=false,al="<td class='CaptionTD'>&#160;</td><td class='DataTD'>&#160;</td>",ao="",ah;for(ah=1;ah<=ae;ah++){ao+=al}if(ac!="_empty"){ad=b(aj).jqGrid("getInd",ac)}b(aj.p.colModel).each(function(au){aq=this.name;if(this.editrules&&this.editrules.edithidden===true){ak=false}else{ak=this.hidden===true?true:false}ap=ak?"style='display:none'":"";if(aq!=="cb"&&aq!=="subgrid"&&this.editable===true&&aq!=="rn"){if(ad===false){ai=""}else{if(aq==aj.p.ExpandColumn&&aj.p.treeGrid===true){ai=b("td:eq("+au+")",aj.rows[ad]).text()}else{try{ai=b.unformat(b("td:eq("+au+")",aj.rows[ad]),{rowId:ac,colModel:this},au)}catch(ar){ai=(this.edittype&&this.edittype=="textarea")?b("td:eq("+au+")",aj.rows[ad]).text():b("td:eq("+au+")",aj.rows[ad]).html()}if(!ai||ai=="&nbsp;"||ai=="&#160;"||(ai.length==1&&ai.charCodeAt(0)==160)){ai=""}}}var at=b.extend({},this.editoptions||{},{id:aq,name:aq}),ay=b.extend({},{elmprefix:"",elmsuffix:"",rowabove:false,rowcontent:""},this.formoptions||{}),av=parseInt(ay.rowpos,10)||af+1,ax=parseInt((parseInt(ay.colpos,10)||1)*2,10);if(ac=="_empty"&&at.defaultValue){ai=b.isFunction(at.defaultValue)?at.defaultValue():at.defaultValue}if(!this.edittype){this.edittype="text"}if(e.p.autoencode){ai=b.jgrid.htmlDecode(ai)}aa=b.jgrid.createEl(this.edittype,at,ai,false,b.extend({},b.jgrid.ajaxOptions,aj.p.ajaxSelectOptions||{}));if(ai===""&&this.edittype=="checkbox"){ai=b(aa).attr("offval")}if(ai===""&&this.edittype=="select"){ai=b("option:eq(0)",aa).text()}if(a[e.p.id].checkOnSubmit||a[e.p.id].checkOnUpdate){a[e.p.id]._savedData[aq]=ai}b(aa).addClass("FormElement");if(this.edittype=="text"||this.edittype=="textarea"){b(aa).addClass("ui-widget-content ui-corner-all")}ab=b(ag).find("tr[rowpos="+av+"]");if(ay.rowabove){var aw=b("<tr><td class='contentinfo' colspan='"+(ae*2)+"'>"+ay.rowcontent+"</td></tr>");b(ag).append(aw);aw[0].rp=av}if(ab.length===0){ab=b("<tr "+ap+" rowpos='"+av+"'></tr>").addClass("FormData").attr("id","tr_"+aq);b(ab).append(ao);b(ag).append(ab);ab[0].rp=av}b("td:eq("+(ax-2)+")",ab[0]).html(typeof ay.label==="undefined"?aj.p.colNames[au]:ay.label);b("td:eq("+(ax-1)+")",ab[0]).append(ay.elmprefix).append(aa).append(ay.elmsuffix);am[af]=au;af++}});if(af>0){var an=b("<tr class='FormData' style='display:none'><td class='CaptionTD'></td><td colspan='"+(ae*2-1)+"' class='DataTD'><input class='FormElement' id='id_g' type='text' name='"+aj.p.id+"_id' value='"+ac+"'/></td></tr>");an[0].rp=af+999;b(ag).append(an);if(a[e.p.id].checkOnSubmit||a[e.p.id].checkOnUpdate){a[e.p.id]._savedData[aj.p.id+"_id"]=ac}}return am}function q(aa,ah,ad){var al,ae=0,ai,ag,ab,af,aj;if(a[e.p.id].checkOnSubmit||a[e.p.id].checkOnUpdate){a[e.p.id]._savedData={};a[e.p.id]._savedData[ah.p.id+"_id"]=aa}var ak=ah.p.colModel;if(aa=="_empty"){b(ak).each(function(am){al=this.name;ab=b.extend({},this.editoptions||{});ag=b("#"+b.jgrid.jqID(al),"#"+ad);if(ag&&ag.length&&ag[0]!==null){af="";if(ab.defaultValue){af=b.isFunction(ab.defaultValue)?ab.defaultValue():ab.defaultValue;if(ag[0].type=="checkbox"){aj=af.toLowerCase();if(aj.search(/(false|0|no|off|undefined)/i)<0&&aj!==""){ag[0].checked=true;ag[0].defaultChecked=true;ag[0].value=af}else{ag[0].checked=false;ag[0].defaultChecked=false}}else{ag.val(af)}}else{if(ag[0].type=="checkbox"){ag[0].checked=false;ag[0].defaultChecked=false;af=b(ag).attr("offval")}else{if(ag[0].type&&ag[0].type.substr(0,6)=="select"){ag[0].selectedIndex=0}else{ag.val(af)}}}if(a[e.p.id].checkOnSubmit===true||a[e.p.id].checkOnUpdate){a[e.p.id]._savedData[al]=af}}});b("#id_g","#"+ad).val(aa);return}var ac=b(ah).jqGrid("getInd",aa,true);if(!ac){return}b("td",ac).each(function(ap){al=ak[ap].name;if(al!=="cb"&&al!=="subgrid"&&al!=="rn"&&ak[ap].editable===true){if(al==ah.p.ExpandColumn&&ah.p.treeGrid===true){ai=b(this).text()}else{try{ai=b.unformat(b(this),{rowId:aa,colModel:ak[ap]},ap)}catch(ao){ai=ak[ap].edittype=="textarea"?b(this).text():b(this).html()}}if(e.p.autoencode){ai=b.jgrid.htmlDecode(ai)}if(a[e.p.id].checkOnSubmit===true||a[e.p.id].checkOnUpdate){a[e.p.id]._savedData[al]=ai}al=b.jgrid.jqID(al);switch(ak[ap].edittype){case"password":case"text":case"button":case"image":case"textarea":if(ai=="&nbsp;"||ai=="&#160;"||(ai.length==1&&ai.charCodeAt(0)==160)){ai=""}b("#"+al,"#"+ad).val(ai);break;case"select":var an=ai.split(",");an=b.map(an,function(ar){return b.trim(ar)});b("#"+al+" option","#"+ad).each(function(ar){if(!ak[ap].editoptions.multiple&&(b.trim(ai)==b.trim(b(this).text())||an[0]==b.trim(b(this).text())||an[0]==b.trim(b(this).val()))){this.selected=true}else{if(ak[ap].editoptions.multiple){if(b.inArray(b.trim(b(this).text()),an)>-1||b.inArray(b.trim(b(this).val()),an)>-1){this.selected=true}else{this.selected=false}}else{this.selected=false}}});break;case"checkbox":ai=ai+"";if(ak[ap].editoptions&&ak[ap].editoptions.value){var am=ak[ap].editoptions.value.split(":");if(am[0]==ai){b("#"+al,"#"+ad)[e.p.useProp?"prop":"attr"]("checked",true);b("#"+al,"#"+ad)[e.p.useProp?"prop":"attr"]("defaultChecked",true)}else{b("#"+al,"#"+ad)[e.p.useProp?"prop":"attr"]("checked",false);b("#"+al,"#"+ad)[e.p.useProp?"prop":"attr"]("defaultChecked",false)}}else{ai=ai.toLowerCase();if(ai.search(/(false|0|no|off|undefined)/i)<0&&ai!==""){b("#"+al,"#"+ad)[e.p.useProp?"prop":"attr"]("checked",true);b("#"+al,"#"+ad)[e.p.useProp?"prop":"attr"]("defaultChecked",true)}else{b("#"+al,"#"+ad)[e.p.useProp?"prop":"attr"]("checked",false);b("#"+al,"#"+ad)[e.p.useProp?"prop":"attr"]("defaultChecked",false)}}break;case"custom":try{if(ak[ap].editoptions&&b.isFunction(ak[ap].editoptions.custom_value)){ak[ap].editoptions.custom_value(b("#"+al,"#"+ad),"set",ai)}else{throw"e1"}}catch(aq){if(aq=="e1"){b.jgrid.info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+b.jgrid.edit.msg.nodefined,jQuery.jgrid.edit.bClose)}else{b.jgrid.info_dialog(jQuery.jgrid.errors.errcap,aq.message,jQuery.jgrid.edit.bClose)}}break}ae++}});if(ae>0){b("#id_g","#"+v).val(aa)}}function k(){var aj,ai=[true,"",""],aa={},ae=e.p.prmNames,ah,ad,am,af;if(b.isFunction(a[e.p.id].beforeCheckValues)){var ag=a[e.p.id].beforeCheckValues(D,b("#"+y),D[e.p.id+"_id"]=="_empty"?ae.addoper:ae.editoper);if(ag&&typeof(ag)==="object"){D=ag}}for(am in D){if(D.hasOwnProperty(am)){ai=b.jgrid.checkValues(D[am],am,e);if(ai[0]===false){break}}}T();if(ai[0]){if(b.isFunction(a[e.p.id].onclickSubmit)){aa=a[e.p.id].onclickSubmit(a[e.p.id],D)||{}}if(b.isFunction(a[e.p.id].beforeSubmit)){ai=a[e.p.id].beforeSubmit(D,b("#"+y))}}if(ai[0]&&!a[e.p.id].processing){a[e.p.id].processing=true;b("#sData","#"+v+"_2").addClass("ui-state-active");ad=ae.oper;ah=ae.id;D[ad]=(b.trim(D[e.p.id+"_id"])=="_empty")?ae.addoper:ae.editoper;if(D[ad]!=ae.addoper){D[ah]=D[e.p.id+"_id"]}else{if(D[ah]===undefined){D[ah]=D[e.p.id+"_id"]}}delete D[e.p.id+"_id"];D=b.extend(D,a[e.p.id].editData,aa);if(e.p.treeGrid===true){if(D[ad]==ae.addoper){af=b(e).jqGrid("getGridParam","selrow");var ab=e.p.treeGridModel=="adjacency"?e.p.treeReader.parent_id_field:"parent_id";D[ab]=af}for(i in e.p.treeReader){var al=e.p.treeReader[i];if(D.hasOwnProperty(al)){if(D[ad]==ae.addoper&&i==="parent_id_field"){continue}delete D[al]}}}D[ah]=b.jgrid.stripPref(e.p.idPrefix,D[ah]);var ac=b.extend({url:a[e.p.id].url?a[e.p.id].url:b(e).jqGrid("getGridParam","editurl"),type:a[e.p.id].mtype,data:b.isFunction(a[e.p.id].serializeEditData)?a[e.p.id].serializeEditData(D):D,complete:function(ap,an){D[ah]=e.p.idPrefix+D[ah];if(an!="success"){ai[0]=false;if(b.isFunction(a[e.p.id].errorTextFormat)){ai[1]=a[e.p.id].errorTextFormat(ap)}else{ai[1]=an+" Status: '"+ap.statusText+"'. Error code: "+ap.status}}else{if(b.isFunction(a[e.p.id].afterSubmit)){ai=a[e.p.id].afterSubmit(ap,D)}}if(ai[0]===false){b("#FormError>td","#"+v).html(ai[1]);b("#FormError","#"+v).show()}else{b.each(e.p.colModel,function(ar,au){if(P[this.name]&&this.formatter&&this.formatter=="select"){try{delete P[this.name]}catch(at){}}});D=b.extend(D,P);if(e.p.autoencode){b.each(D,function(at,ar){D[at]=b.jgrid.htmlDecode(ar)})}if(D[ad]==ae.addoper){if(!ai[2]){ai[2]=b.jgrid.randId()}D[ah]=ai[2];if(a[e.p.id].closeAfterAdd){if(a[e.p.id].reloadAfterSubmit){b(e).trigger("reloadGrid")}else{if(e.p.treeGrid===true){b(e).jqGrid("addChildNode",ai[2],af,D)}else{b(e).jqGrid("addRowData",ai[2],D,d.addedrow);b(e).jqGrid("setSelection",ai[2])}}b.jgrid.hideModal("#"+j.themodal,{gb:"#gbox_"+B,jqm:d.jqModal,onClose:a[e.p.id].onClose})}else{if(a[e.p.id].clearAfterAdd){if(a[e.p.id].reloadAfterSubmit){b(e).trigger("reloadGrid")}else{if(e.p.treeGrid===true){b(e).jqGrid("addChildNode",ai[2],af,D)}else{b(e).jqGrid("addRowData",ai[2],D,d.addedrow)}}q("_empty",e,y)}else{if(a[e.p.id].reloadAfterSubmit){b(e).trigger("reloadGrid")}else{if(e.p.treeGrid===true){b(e).jqGrid("addChildNode",ai[2],af,D)}else{b(e).jqGrid("addRowData",ai[2],D,d.addedrow)}}}}}else{if(a[e.p.id].reloadAfterSubmit){b(e).trigger("reloadGrid");if(!a[e.p.id].closeAfterEdit){setTimeout(function(){b(e).jqGrid("setSelection",D[ah])},1000)}}else{if(e.p.treeGrid===true){b(e).jqGrid("setTreeRow",D[ah],D)}else{b(e).jqGrid("setRowData",D[ah],D)}}if(a[e.p.id].closeAfterEdit){b.jgrid.hideModal("#"+j.themodal,{gb:"#gbox_"+B,jqm:d.jqModal,onClose:a[e.p.id].onClose})}}if(b.isFunction(a[e.p.id].afterComplete)){aj=ap;setTimeout(function(){a[e.p.id].afterComplete(aj,D,b("#"+y));aj=null},500)}if(a[e.p.id].checkOnSubmit||a[e.p.id].checkOnUpdate){b("#"+y).data("disabled",false);if(a[e.p.id]._savedData[e.p.id+"_id"]!="_empty"){for(var ao in a[e.p.id]._savedData){if(D[ao]){a[e.p.id]._savedData[ao]=D[ao]}}}}}a[e.p.id].processing=false;b("#sData","#"+v+"_2").removeClass("ui-state-active");try{b(":input:visible","#"+y)[0].focus()}catch(aq){}}},b.jgrid.ajaxOptions,a[e.p.id].ajaxEditOptions);if(!ac.url&&!a[e.p.id].useDataProxy){if(b.isFunction(e.p.dataProxy)){a[e.p.id].useDataProxy=true}else{ai[0]=false;ai[1]+=" "+b.jgrid.errors.nourl}}if(ai[0]){if(a[e.p.id].useDataProxy){var ak=e.p.dataProxy.call(e,ac,"set_"+e.p.id);if(typeof(ak)=="undefined"){ak=[true,""]}if(ak[0]===false){ai[0]=false;ai[1]=ak[1]||"Error deleting the selected row!"}else{if(ac.data.oper==ae.addoper&&a[e.p.id].closeAfterAdd){b.jgrid.hideModal("#"+j.themodal,{gb:"#gbox_"+B,jqm:d.jqModal,onClose:a[e.p.id].onClose})}if(ac.data.oper==ae.editoper&&a[e.p.id].closeAfterEdit){b.jgrid.hideModal("#"+j.themodal,{gb:"#gbox_"+B,jqm:d.jqModal,onClose:a[e.p.id].onClose})}}}else{b.ajax(ac)}}}if(ai[0]===false){b("#FormError>td","#"+v).html(ai[1]);b("#FormError","#"+v).show()}}function J(ad,aa){var ab=false,ac;for(ac in ad){if(ad[ac]!=aa[ac]){ab=true;break}}return ab}function T(){b.each(e.p.colModel,function(aa,ab){if(ab.editoptions&&ab.editoptions.NullIfEmpty===true){if(D.hasOwnProperty(ab.name)&&D[ab.name]==""){D[ab.name]="null"}}})}function g(){var aa=true;b("#FormError","#"+v).hide();if(a[e.p.id].checkOnUpdate){D={};P={};X();F=b.extend({},D,P);A=J(F,a[e.p.id]._savedData);if(A){b("#"+y).data("disabled",true);b(".confirm","#"+j.themodal).show();aa=false}}return aa}function V(){if(c!=="_empty"&&typeof(e.p.savedRow)!=="undefined"&&e.p.savedRow.length>0&&b.isFunction(b.fn.jqGrid.restoreRow)){for(var aa=0;aa<e.p.savedRow.length;aa++){if(e.p.savedRow[aa].id==c){b(e).jqGrid("restoreRow",c);break}}}}function I(aa,ab){if(aa===0){b("#pData","#"+v+"_2").addClass("ui-state-disabled")}else{b("#pData","#"+v+"_2").removeClass("ui-state-disabled")}if(aa==ab){b("#nData","#"+v+"_2").addClass("ui-state-disabled")}else{b("#nData","#"+v+"_2").removeClass("ui-state-disabled")}}function Z(){var ab=b(e).jqGrid("getDataIDs"),aa=b("#id_g","#"+v).val(),ac=b.inArray(aa,ab);return[ac,ab]}if(b("#"+j.themodal).html()!==null){if(L){Y=L(b("#"+y));if(typeof(Y)=="undefined"){Y=true}}if(Y===false){return}V();b(".ui-jqdialog-title","#"+j.modalhead).html(d.caption);b("#FormError","#"+v).hide();if(a[e.p.id].topinfo){b(".topinfo","#"+v).html(a[e.p.id].topinfo);b(".tinfo","#"+v).show()}else{b(".tinfo","#"+v).hide()}if(a[e.p.id].bottominfo){b(".bottominfo","#"+v+"_2").html(a[e.p.id].bottominfo);b(".binfo","#"+v+"_2").show()}else{b(".binfo","#"+v+"_2").hide()}q(c,e,y);if(c=="_empty"||!a[e.p.id].viewPagerButtons){b("#pData, #nData","#"+v+"_2").hide()}else{b("#pData, #nData","#"+v+"_2").show()}if(a[e.p.id].processing===true){a[e.p.id].processing=false;b("#sData","#"+v+"_2").removeClass("ui-state-active")}if(b("#"+y).data("disabled")===true){b(".confirm","#"+j.themodal).hide();b("#"+y).data("disabled",false)}if(C){C(b("#"+y))}b("#"+j.themodal).data("onClose",a[e.p.id].onClose);b.jgrid.viewModal("#"+j.themodal,{gbox:"#gbox_"+B,jqm:d.jqModal,jqM:false,overlay:d.overlay,modal:d.modal});if(!m){b(".jqmOverlay").click(function(){if(!g()){return false}b.jgrid.hideModal("#"+j.themodal,{gb:"#gbox_"+B,jqm:d.jqModal,onClose:a[e.p.id].onClose});return false})}if(M){M(b("#"+y))}}else{var s=isNaN(d.dataheight)?d.dataheight:d.dataheight+"px",S=b("<form name='FormPost' id='"+y+"' class='FormGrid' onSubmit='return false;' style='width:100%;overflow:auto;position:relative;height:"+s+";'></form>").data("disabled",false),z=b("<table id='"+v+"' class='EditTable' cellspacing='0' cellpadding='0' border='0'><tbody></tbody></table>");if(L){Y=L(b("#"+y));if(typeof(Y)=="undefined"){Y=true}}if(Y===false){return}V();b(e.p.colModel).each(function(aa){var ab=this.formoptions;H=Math.max(H,ab?ab.colpos||0:0);r=Math.max(r,ab?ab.rowpos||0:0)});b(S).append(z);var K=b("<tr id='FormError' style='display:none'><td class='ui-state-error' colspan='"+(H*2)+"'></td></tr>");K[0].rp=0;b(z).append(K);K=b("<tr style='display:none' class='tinfo'><td class='topinfo' colspan='"+(H*2)+"'>"+a[e.p.id].topinfo+"</td></tr>");K[0].rp=0;b(z).append(K);var f=e.p.direction=="rtl"?true:false,R=f?"nData":"pData",U=f?"pData":"nData";t(c,e,z,H);var l="<a href='javascript:void(0)' id='"+R+"' class='fm-button ui-state-default ui-corner-left'><span class='ui-icon ui-icon-triangle-1-w'></span></a>",n="<a href='javascript:void(0)' id='"+U+"' class='fm-button ui-state-default ui-corner-right'><span class='ui-icon ui-icon-triangle-1-e'></span></a>",h="<a href='javascript:void(0)' id='sData' class='fm-button ui-state-default ui-corner-all'>"+d.bSubmit+"</a>",u="<a href='javascript:void(0)' id='cData' class='fm-button ui-state-default ui-corner-all'>"+d.bCancel+"</a>";var O="<table border='0' cellspacing='0' cellpadding='0' class='EditTable' id='"+v+"_2'><tbody><tr><td colspan='2'><hr class='ui-widget-content' style='margin:1px'/></td></tr><tr id='Act_Buttons'><td class='navButton'>"+(f?n+l:l+n)+"</td><td class='EditButton'>"+h+u+"</td></tr>";O+="<tr style='display:none' class='binfo'><td class='bottominfo' colspan='2'>"+a[e.p.id].bottominfo+"</td></tr>";O+="</tbody></table>";if(r>0){var x=[],W={};b.each(b(z)[0].rows,function(aa,ab){x[aa]=ab});x.sort(function(ab,aa){if(ab.rp>aa.rp){return 1}if(ab.rp<aa.rp){return -1}return 0});b.each(x,function(aa,ab){W.html+=ab});b("tbody",z).append(W.html)}d.gbox="#gbox_"+B;var o=false;if(d.closeOnEscape===true){d.closeOnEscape=false;o=true}var N=b("<span></span>").append(S).append(O);b.jgrid.createModal(j,N,d,"#gview_"+e.p.id,b("#gbox_"+e.p.id)[0]);if(f){b("#pData, #nData","#"+v+"_2").css("float","right");b(".EditButton","#"+v+"_2").css("text-align","left")}if(a[e.p.id].topinfo){b(".tinfo","#"+v).show()}if(a[e.p.id].bottominfo){b(".binfo","#"+v+"_2").show()}N=null;O=null;b("#"+j.themodal).keydown(function(aa){var ab=aa.target;if(b("#"+y).data("disabled")===true){return false}if(a[e.p.id].savekey[0]===true&&aa.which==a[e.p.id].savekey[1]){if(ab.tagName!="TEXTAREA"){b("#sData","#"+v+"_2").trigger("click");return false}}if(aa.which===27){if(!g()){return false}if(o){b.jgrid.hideModal(this,{gb:d.gbox,jqm:d.jqModal,onClose:a[e.p.id].onClose})}return false}if(a[e.p.id].navkeys[0]===true){if(b("#id_g","#"+v).val()=="_empty"){return true}if(aa.which==a[e.p.id].navkeys[1]){b("#pData","#"+v+"_2").trigger("click");return false}if(aa.which==a[e.p.id].navkeys[2]){b("#nData","#"+v+"_2").trigger("click");return false}}});if(d.checkOnUpdate){b("a.ui-jqdialog-titlebar-close span","#"+j.themodal).removeClass("jqmClose");b("a.ui-jqdialog-titlebar-close","#"+j.themodal).unbind("click").click(function(){if(!g()){return false}b.jgrid.hideModal("#"+j.themodal,{gb:"#gbox_"+B,jqm:d.jqModal,onClose:a[e.p.id].onClose});return false})}d.saveicon=b.extend([true,"left","ui-icon-disk"],d.saveicon);d.closeicon=b.extend([true,"left","ui-icon-close"],d.closeicon);if(d.saveicon[0]===true){b("#sData","#"+v+"_2").addClass(d.saveicon[1]=="right"?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+d.saveicon[2]+"'></span>")}if(d.closeicon[0]===true){b("#cData","#"+v+"_2").addClass(d.closeicon[1]=="right"?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+d.closeicon[2]+"'></span>")}if(a[e.p.id].checkOnSubmit||a[e.p.id].checkOnUpdate){h="<a href='javascript:void(0)' id='sNew' class='fm-button ui-state-default ui-corner-all' style='z-index:1002'>"+d.bYes+"</a>";n="<a href='javascript:void(0)' id='nNew' class='fm-button ui-state-default ui-corner-all' style='z-index:1002'>"+d.bNo+"</a>";u="<a href='javascript:void(0)' id='cNew' class='fm-button ui-state-default ui-corner-all' style='z-index:1002'>"+d.bExit+"</a>";var E,w=d.zIndex||999;w++;if(b.browser.msie&&b.browser.version==6){E='<iframe style="display:block;position:absolute;z-index:-1;filter:Alpha(Opacity=\'0\');" src="javascript:false;"></iframe>'}else{E=""}b("<div class='ui-widget-overlay jqgrid-overlay confirm' style='z-index:"+w+";display:none;'>&#160;"+E+"</div><div class='confirm ui-widget-content ui-jqconfirm' style='z-index:"+(w+1)+"'>"+d.saveData+"<br/><br/>"+h+n+u+"</div>").insertAfter("#"+y);b("#sNew","#"+j.themodal).click(function(){k();b("#"+y).data("disabled",false);b(".confirm","#"+j.themodal).hide();return false});b("#nNew","#"+j.themodal).click(function(){b(".confirm","#"+j.themodal).hide();b("#"+y).data("disabled",false);setTimeout(function(){b(":input","#"+y)[0].focus()},0);return false});b("#cNew","#"+j.themodal).click(function(){b(".confirm","#"+j.themodal).hide();b("#"+y).data("disabled",false);b.jgrid.hideModal("#"+j.themodal,{gb:"#gbox_"+B,jqm:d.jqModal,onClose:a[e.p.id].onClose});return false})}if(p){p(b("#"+y))}if(c=="_empty"||!a[e.p.id].viewPagerButtons){b("#pData,#nData","#"+v+"_2").hide()}else{b("#pData,#nData","#"+v+"_2").show()}if(C){C(b("#"+y))}b("#"+j.themodal).data("onClose",a[e.p.id].onClose);b.jgrid.viewModal("#"+j.themodal,{gbox:"#gbox_"+B,jqm:d.jqModal,overlay:d.overlay,modal:d.modal});if(!m){b(".jqmOverlay").click(function(){if(!g()){return false}b.jgrid.hideModal("#"+j.themodal,{gb:"#gbox_"+B,jqm:d.jqModal,onClose:a[e.p.id].onClose});return false})}if(M){M(b("#"+y))}b(".fm-button","#"+j.themodal).hover(function(){b(this).addClass("ui-state-hover")},function(){b(this).removeClass("ui-state-hover")});b("#sData","#"+v+"_2").click(function(aa){D={};P={};b("#FormError","#"+v).hide();X();if(D[e.p.id+"_id"]=="_empty"){k()}else{if(d.checkOnSubmit===true){F=b.extend({},D,P);A=J(F,a[e.p.id]._savedData);if(A){b("#"+y).data("disabled",true);b(".confirm","#"+j.themodal).show()}else{k()}}else{k()}}return false});b("#cData","#"+v+"_2").click(function(aa){if(!g()){return false}b.jgrid.hideModal("#"+j.themodal,{gb:"#gbox_"+B,jqm:d.jqModal,onClose:a[e.p.id].onClose});return false});b("#nData","#"+v+"_2").click(function(aa){if(!g()){return false}b("#FormError","#"+v).hide();var ab=Z();ab[0]=parseInt(ab[0],10);if(ab[0]!=-1&&ab[1][ab[0]+1]){if(b.isFunction(d.onclickPgButtons)){d.onclickPgButtons("next",b("#"+y),ab[1][ab[0]])}q(ab[1][ab[0]+1],e,y);b(e).jqGrid("setSelection",ab[1][ab[0]+1]);if(b.isFunction(d.afterclickPgButtons)){d.afterclickPgButtons("next",b("#"+y),ab[1][ab[0]+1])}I(ab[0]+1,ab[1].length-1)}return false});b("#pData","#"+v+"_2").click(function(ab){if(!g()){return false}b("#FormError","#"+v).hide();var aa=Z();if(aa[0]!=-1&&aa[1][aa[0]-1]){if(b.isFunction(d.onclickPgButtons)){d.onclickPgButtons("prev",b("#"+y),aa[1][aa[0]])}q(aa[1][aa[0]-1],e,y);b(e).jqGrid("setSelection",aa[1][aa[0]-1]);if(b.isFunction(d.afterclickPgButtons)){d.afterclickPgButtons("prev",b("#"+y),aa[1][aa[0]-1])}I(aa[0]-1,aa[1].length-1)}return false})}var Q=Z();I(Q[0],Q[1].length-1)})},viewGridRow:function(c,d){d=b.extend({top:0,left:0,width:0,height:"auto",dataheight:"auto",modal:false,overlay:30,drag:true,resize:true,jqModal:true,closeOnEscape:false,labelswidth:"30%",closeicon:[],navkeys:[false,38,40],onClose:null,beforeShowForm:null,beforeInitData:null,viewPagerButtons:true},b.jgrid.view,d||{});return this.each(function(){var x=this;if(!x.grid||!c){return}var t=x.p.id,B="ViewGrid_"+t,u="ViewTbl_"+t,k={themodal:"viewmod"+t,modalhead:"viewhd"+t,modalcontent:"viewcnt"+t,scrollelm:B},A=b.isFunction(d.beforeInitData)?d.beforeInitData:false,n=true,h=1,g=0;function l(){if(d.closeOnEscape===true||d.navkeys[0]===true){setTimeout(function(){b(".ui-jqdialog-titlebar-close","#"+k.modalhead).focus()},0)}}function p(L,R,P,X){var H,K,S,V=0,aa,ab,Z=[],Q=false,M="<td class='CaptionTD form-view-label ui-widget-content' width='"+d.labelswidth+"'>&#160;</td><td class='DataTD form-view-data ui-helper-reset ui-widget-content'>&#160;</td>",O="",I="<td class='CaptionTD form-view-label ui-widget-content'>&#160;</td><td class='DataTD form-view-data ui-widget-content'>&#160;</td>",N=["integer","number","currency"],U=0,T=0,J,G,Y;for(var W=1;W<=X;W++){O+=W==1?M:I}b(R.p.colModel).each(function(ad){if(this.editrules&&this.editrules.edithidden===true){K=false}else{K=this.hidden===true?true:false}if(!K&&this.align==="right"){if(this.formatter&&b.inArray(this.formatter,N)!==-1){U=Math.max(U,parseInt(this.width,10))}else{T=Math.max(T,parseInt(this.width,10))}}});J=U!==0?U:T!==0?T:0;Q=b(R).jqGrid("getInd",L);b(R.p.colModel).each(function(ae){H=this.name;G=false;if(this.editrules&&this.editrules.edithidden===true){K=false}else{K=this.hidden===true?true:false}ab=K?"style='display:none'":"";Y=(typeof this.viewable!="boolean")?true:this.viewable;if(H!=="cb"&&H!=="subgrid"&&H!=="rn"&&Y){if(Q===false){aa=""}else{if(H==R.p.ExpandColumn&&R.p.treeGrid===true){aa=b("td:eq("+ae+")",R.rows[Q]).text()}else{aa=b("td:eq("+ae+")",R.rows[Q]).html()}}G=this.align==="right"&&J!==0?true:false;var ad=b.extend({},this.editoptions||{},{id:H,name:H}),ai=b.extend({},{rowabove:false,rowcontent:""},this.formoptions||{}),af=parseInt(ai.rowpos,10)||V+1,ah=parseInt((parseInt(ai.colpos,10)||1)*2,10);if(ai.rowabove){var ag=b("<tr><td class='contentinfo' colspan='"+(X*2)+"'>"+ai.rowcontent+"</td></tr>");b(P).append(ag);ag[0].rp=af}S=b(P).find("tr[rowpos="+af+"]");if(S.length===0){S=b("<tr "+ab+" rowpos='"+af+"'></tr>").addClass("FormData").attr("id","trv_"+H);b(S).append(O);b(P).append(S);S[0].rp=af}b("td:eq("+(ah-2)+")",S[0]).html("<b>"+(typeof ai.label==="undefined"?R.p.colNames[ae]:ai.label)+"</b>");b("td:eq("+(ah-1)+")",S[0]).append("<span>"+aa+"</span>").attr("id","v_"+H);if(G){b("td:eq("+(ah-1)+") span",S[0]).css({"text-align":"right",width:J+"px"})}Z[V]=ae;V++}});if(V>0){var ac=b("<tr class='FormData' style='display:none'><td class='CaptionTD'></td><td colspan='"+(X*2-1)+"' class='DataTD'><input class='FormElement' id='id_g' type='text' name='id' value='"+L+"'/></td></tr>");ac[0].rp=V+99;b(P).append(ac)}return Z}function o(K,M){var G,N,J=0,I,H,L;L=b(M).jqGrid("getInd",K,true);if(!L){return}b("td",L).each(function(O){G=M.p.colModel[O].name;if(M.p.colModel[O].editrules&&M.p.colModel[O].editrules.edithidden===true){N=false}else{N=M.p.colModel[O].hidden===true?true:false}if(G!=="cb"&&G!=="subgrid"&&G!=="rn"){if(G==M.p.ExpandColumn&&M.p.treeGrid===true){I=b(this).text()}else{I=b(this).html()}H=b.extend({},M.p.colModel[O].editoptions||{});G=b.jgrid.jqID("v_"+G);b("#"+G+" span","#"+u).html(I);if(N){b("#"+G,"#"+u).parents("tr:first").hide()}J++}});if(J>0){b("#id_g","#"+u).val(K)}}function q(G,H){if(G===0){b("#pData","#"+u+"_2").addClass("ui-state-disabled")}else{b("#pData","#"+u+"_2").removeClass("ui-state-disabled")}if(G==H){b("#nData","#"+u+"_2").addClass("ui-state-disabled")}else{b("#nData","#"+u+"_2").removeClass("ui-state-disabled")}}function j(){var H=b(x).jqGrid("getDataIDs"),G=b("#id_g","#"+u).val(),I=b.inArray(G,H);return[I,H]}if(b("#"+k.themodal).html()!==null){if(A){n=A(b("#"+B));if(typeof(n)=="undefined"){n=true}}if(n===false){return}b(".ui-jqdialog-title","#"+k.modalhead).html(d.caption);b("#FormError","#"+u).hide();o(c,x);if(b.isFunction(d.beforeShowForm)){d.beforeShowForm(b("#"+B))}b.jgrid.viewModal("#"+k.themodal,{gbox:"#gbox_"+t,jqm:d.jqModal,jqM:false,overlay:d.overlay,modal:d.modal});l()}else{var z=isNaN(d.dataheight)?d.dataheight:d.dataheight+"px";var D=b("<form name='FormPost' id='"+B+"' class='FormGrid' style='width:100%;overflow:auto;position:relative;height:"+z+";'></form>"),m=b("<table id='"+u+"' class='EditTable' cellspacing='1' cellpadding='2' border='0' style='table-layout:fixed'><tbody></tbody></table>");if(A){n=A(b("#"+B));if(typeof(n)=="undefined"){n=true}}if(n===false){return}b(x.p.colModel).each(function(G){var H=this.formoptions;h=Math.max(h,H?H.colpos||0:0);g=Math.max(g,H?H.rowpos||0:0)});b(D).append(m);p(c,x,m,h);var y=x.p.direction=="rtl"?true:false,F=y?"nData":"pData",f=y?"pData":"nData",v="<a href='javascript:void(0)' id='"+F+"' class='fm-button ui-state-default ui-corner-left'><span class='ui-icon ui-icon-triangle-1-w'></span></a>",w="<a href='javascript:void(0)' id='"+f+"' class='fm-button ui-state-default ui-corner-right'><span class='ui-icon ui-icon-triangle-1-e'></span></a>",E="<a href='javascript:void(0)' id='cData' class='fm-button ui-state-default ui-corner-all'>"+d.bClose+"</a>";if(g>0){var e=[];b.each(b(m)[0].rows,function(G,H){e[G]=H});e.sort(function(H,G){if(H.rp>G.rp){return 1}if(H.rp<G.rp){return -1}return 0});b.each(e,function(G,H){b("tbody",m).append(H)})}d.gbox="#gbox_"+t;var s=false;if(d.closeOnEscape===true){d.closeOnEscape=false;s=true}var C=b("<span></span>").append(D).append("<table border='0' class='EditTable' id='"+u+"_2'><tbody><tr id='Act_Buttons'><td class='navButton' width='"+d.labelswidth+"'>"+(y?w+v:v+w)+"</td><td class='EditButton'>"+E+"</td></tr></tbody></table>");b.jgrid.createModal(k,C,d,"#gview_"+x.p.id,b("#gview_"+x.p.id)[0]);if(y){b("#pData, #nData","#"+u+"_2").css("float","right");b(".EditButton","#"+u+"_2").css("text-align","left")}if(!d.viewPagerButtons){b("#pData, #nData","#"+u+"_2").hide()}C=null;b("#"+k.themodal).keydown(function(G){if(G.which===27){if(s){b.jgrid.hideModal(this,{gb:d.gbox,jqm:d.jqModal,onClose:d.onClose})}return false}if(d.navkeys[0]===true){if(G.which===d.navkeys[1]){b("#pData","#"+u+"_2").trigger("click");return false}if(G.which===d.navkeys[2]){b("#nData","#"+u+"_2").trigger("click");return false}}});d.closeicon=b.extend([true,"left","ui-icon-close"],d.closeicon);if(d.closeicon[0]===true){b("#cData","#"+u+"_2").addClass(d.closeicon[1]=="right"?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+d.closeicon[2]+"'></span>")}if(b.isFunction(d.beforeShowForm)){d.beforeShowForm(b("#"+B))}b.jgrid.viewModal("#"+k.themodal,{gbox:"#gbox_"+t,jqm:d.jqModal,modal:d.modal});b(".fm-button:not(.ui-state-disabled)","#"+u+"_2").hover(function(){b(this).addClass("ui-state-hover")},function(){b(this).removeClass("ui-state-hover")});l();b("#cData","#"+u+"_2").click(function(G){b.jgrid.hideModal("#"+k.themodal,{gb:"#gbox_"+t,jqm:d.jqModal,onClose:d.onClose});return false});b("#nData","#"+u+"_2").click(function(G){b("#FormError","#"+u).hide();var H=j();H[0]=parseInt(H[0],10);if(H[0]!=-1&&H[1][H[0]+1]){if(b.isFunction(d.onclickPgButtons)){d.onclickPgButtons("next",b("#"+B),H[1][H[0]])}o(H[1][H[0]+1],x);b(x).jqGrid("setSelection",H[1][H[0]+1]);if(b.isFunction(d.afterclickPgButtons)){d.afterclickPgButtons("next",b("#"+B),H[1][H[0]+1])}q(H[0]+1,H[1].length-1)}l();return false});b("#pData","#"+u+"_2").click(function(H){b("#FormError","#"+u).hide();var G=j();if(G[0]!=-1&&G[1][G[0]-1]){if(b.isFunction(d.onclickPgButtons)){d.onclickPgButtons("prev",b("#"+B),G[1][G[0]])}o(G[1][G[0]-1],x);b(x).jqGrid("setSelection",G[1][G[0]-1]);if(b.isFunction(d.afterclickPgButtons)){d.afterclickPgButtons("prev",b("#"+B),G[1][G[0]-1])}q(G[0]-1,G[1].length-1)}l();return false})}var r=j();q(r[0],r[1].length-1)})},delGridRow:function(c,d){d=b.extend({top:0,left:0,width:240,height:"auto",dataheight:"auto",modal:false,overlay:30,drag:true,resize:true,url:"",mtype:"POST",reloadAfterSubmit:true,beforeShowForm:null,beforeInitData:null,afterShowForm:null,beforeSubmit:null,onclickSubmit:null,afterSubmit:null,jqModal:true,closeOnEscape:false,delData:{},delicon:[],cancelicon:[],onClose:null,ajaxDelOptions:{},processing:false,serializeDelData:null,useDataProxy:false},b.jgrid.del,d||{});a[b(this)[0].p.id]=d;return this.each(function(){var p=this;if(!p.grid){return}if(!c){return}var q=b.isFunction(a[p.p.id].beforeShowForm),g=b.isFunction(a[p.p.id].afterShowForm),t=b.isFunction(a[p.p.id].beforeInitData)?a[p.p.id].beforeInitData:false,e=p.p.id,f={},l=true,m="DelTbl_"+e,s,r,o,k,h={themodal:"delmod"+e,modalhead:"delhd"+e,modalcontent:"delcnt"+e,scrollelm:m};if(jQuery.isArray(c)){c=c.join()}if(b("#"+h.themodal).html()!==null){if(t){l=t(b("#"+m));if(typeof(l)=="undefined"){l=true}}if(l===false){return}b("#DelData>td","#"+m).text(c);b("#DelError","#"+m).hide();if(a[p.p.id].processing===true){a[p.p.id].processing=false;b("#dData","#"+m).removeClass("ui-state-active")}if(q){a[p.p.id].beforeShowForm(b("#"+m))}b.jgrid.viewModal("#"+h.themodal,{gbox:"#gbox_"+e,jqm:a[p.p.id].jqModal,jqM:false,overlay:a[p.p.id].overlay,modal:a[p.p.id].modal});if(g){a[p.p.id].afterShowForm(b("#"+m))}}else{var u=isNaN(a[p.p.id].dataheight)?a[p.p.id].dataheight:a[p.p.id].dataheight+"px";var n="<div id='"+m+"' class='formdata' style='width:100%;overflow:auto;position:relative;height:"+u+";'>";n+="<table class='DelTable'><tbody>";n+="<tr id='DelError' style='display:none'><td class='ui-state-error'></td></tr>";n+="<tr id='DelData' style='display:none'><td >"+c+"</td></tr>";n+='<tr><td class="delmsg" style="white-space:pre;">'+a[p.p.id].msg+"</td></tr><tr><td >&#160;</td></tr>";n+="</tbody></table></div>";var j="<a href='javascript:void(0)' id='dData' class='fm-button ui-state-default ui-corner-all'>"+d.bSubmit+"</a>",v="<a href='javascript:void(0)' id='eData' class='fm-button ui-state-default ui-corner-all'>"+d.bCancel+"</a>";n+="<table cellspacing='0' cellpadding='0' border='0' class='EditTable' id='"+m+"_2'><tbody><tr><td><hr class='ui-widget-content' style='margin:1px'/></td></tr><tr><td class='DelButton EditButton'>"+j+"&#160;"+v+"</td></tr></tbody></table>";d.gbox="#gbox_"+e;b.jgrid.createModal(h,n,d,"#gview_"+p.p.id,b("#gview_"+p.p.id)[0]);if(t){l=t(b("#"+m));if(typeof(l)=="undefined"){l=true}}if(l===false){return}b(".fm-button","#"+m+"_2").hover(function(){b(this).addClass("ui-state-hover")},function(){b(this).removeClass("ui-state-hover")});d.delicon=b.extend([true,"left","ui-icon-scissors"],a[p.p.id].delicon);d.cancelicon=b.extend([true,"left","ui-icon-cancel"],a[p.p.id].cancelicon);if(d.delicon[0]===true){b("#dData","#"+m+"_2").addClass(d.delicon[1]=="right"?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+d.delicon[2]+"'></span>")}if(d.cancelicon[0]===true){b("#eData","#"+m+"_2").addClass(d.cancelicon[1]=="right"?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+d.cancelicon[2]+"'></span>")}b("#dData","#"+m+"_2").click(function(B){var y=[true,""];f={};var z=b("#DelData>td","#"+m).text();if(b.isFunction(a[p.p.id].onclickSubmit)){f=a[p.p.id].onclickSubmit(a[p.p.id],z)||{}}if(b.isFunction(a[p.p.id].beforeSubmit)){y=a[p.p.id].beforeSubmit(z)}if(y[0]&&!a[p.p.id].processing){a[p.p.id].processing=true;b(this).addClass("ui-state-active");o=p.p.prmNames;s=b.extend({},a[p.p.id].delData,f);k=o.oper;s[k]=o.deloper;r=o.id;z=z.split(",");for(var A in z){if(z.hasOwnProperty(A)){z[A]=b.jgrid.stripPref(p.p.idPrefix,z[A])}}s[r]=z.join();var w=b.extend({url:a[p.p.id].url?a[p.p.id].url:b(p).jqGrid("getGridParam","editurl"),type:a[p.p.id].mtype,data:b.isFunction(a[p.p.id].serializeDelData)?a[p.p.id].serializeDelData(s):s,complete:function(F,D){if(D!="success"){y[0]=false;if(b.isFunction(a[p.p.id].errorTextFormat)){y[1]=a[p.p.id].errorTextFormat(F)}else{y[1]=D+" Status: '"+F.statusText+"'. Error code: "+F.status}}else{if(b.isFunction(a[p.p.id].afterSubmit)){y=a[p.p.id].afterSubmit(F,s)}}if(y[0]===false){b("#DelError>td","#"+m).html(y[1]);b("#DelError","#"+m).show()}else{if(a[p.p.id].reloadAfterSubmit&&p.p.datatype!="local"){b(p).trigger("reloadGrid")}else{var C=[];C=z.split(",");if(p.p.treeGrid===true){try{b(p).jqGrid("delTreeNode",p.p.idPrefix+C[0])}catch(G){}}else{for(var E=0;E<C.length;E++){b(p).jqGrid("delRowData",p.p.idPrefix+C[E])}}p.p.selrow=null;p.p.selarrrow=[]}if(b.isFunction(a[p.p.id].afterComplete)){setTimeout(function(){a[p.p.id].afterComplete(F,z)},500)}}a[p.p.id].processing=false;b("#dData","#"+m+"_2").removeClass("ui-state-active");if(y[0]){b.jgrid.hideModal("#"+h.themodal,{gb:"#gbox_"+e,jqm:d.jqModal,onClose:a[p.p.id].onClose})}}},b.jgrid.ajaxOptions,a[p.p.id].ajaxDelOptions);if(!w.url&&!a[p.p.id].useDataProxy){if(b.isFunction(p.p.dataProxy)){a[p.p.id].useDataProxy=true}else{y[0]=false;y[1]+=" "+b.jgrid.errors.nourl}}if(y[0]){if(a[p.p.id].useDataProxy){var x=p.p.dataProxy.call(p,w,"del_"+p.p.id);if(typeof(x)=="undefined"){x=[true,""]}if(x[0]===false){y[0]=false;y[1]=x[1]||"Error deleting the selected row!"}else{b.jgrid.hideModal("#"+h.themodal,{gb:"#gbox_"+e,jqm:d.jqModal,onClose:a[p.p.id].onClose})}}else{b.ajax(w)}}}if(y[0]===false){b("#DelError>td","#"+m).html(y[1]);b("#DelError","#"+m).show()}return false});b("#eData","#"+m+"_2").click(function(w){b.jgrid.hideModal("#"+h.themodal,{gb:"#gbox_"+e,jqm:a[p.p.id].jqModal,onClose:a[p.p.id].onClose});return false});if(q){a[p.p.id].beforeShowForm(b("#"+m))}b.jgrid.viewModal("#"+h.themodal,{gbox:"#gbox_"+e,jqm:a[p.p.id].jqModal,overlay:a[p.p.id].overlay,modal:a[p.p.id].modal});if(g){a[p.p.id].afterShowForm(b("#"+m))}}if(a[p.p.id].closeOnEscape===true){setTimeout(function(){b(".ui-jqdialog-titlebar-close","#"+h.modalhead).focus()},0)}})},navGrid:function(f,h,e,g,d,c,j){h=b.extend({edit:true,editicon:"ui-icon-pencil",add:true,addicon:"ui-icon-plus",del:true,delicon:"ui-icon-trash",search:true,searchicon:"ui-icon-search",refresh:true,refreshicon:"ui-icon-refresh",refreshstate:"firstpage",view:false,viewicon:"ui-icon-document",position:"left",closeOnEscape:true,beforeRefresh:null,afterRefresh:null,cloneToTop:false,alertwidth:200,alertheight:"auto",alerttop:null,alertleft:null,alertzIndex:null},b.jgrid.nav,h||{});return this.each(function(){if(this.nav){return}var k={themodal:"alertmod",modalhead:"alerthd",modalcontent:"alertcnt"},n=this,p,l;if(!n.grid||typeof f!="string"){return}if(b("#"+k.themodal).html()===null){if(!h.alerttop&&!h.alertleft){if(typeof window.innerWidth!="undefined"){h.alertleft=window.innerWidth;h.alerttop=window.innerHeight}else{if(typeof document.documentElement!="undefined"&&typeof document.documentElement.clientWidth!="undefined"&&document.documentElement.clientWidth!==0){h.alertleft=document.documentElement.clientWidth;h.alerttop=document.documentElement.clientHeight}else{h.alertleft=1024;h.alerttop=768}}h.alertleft=h.alertleft/2-parseInt(h.alertwidth,10)/2;h.alerttop=h.alerttop/2-25}b.jgrid.createModal(k,"<div>"+h.alerttext+"</div><span tabindex='0'><span tabindex='-1' id='jqg_alrt'></span></span>",{gbox:"#gbox_"+n.p.id,jqModal:true,drag:true,resize:true,caption:h.alertcap,top:h.alerttop,left:h.alertleft,width:h.alertwidth,height:h.alertheight,closeOnEscape:h.closeOnEscape,zIndex:h.alertzIndex},"","",true)}var q=1;if(h.cloneToTop&&n.p.toppager){q=2}for(var o=0;o<q;o++){var r,t=b("<table cellspacing='0' cellpadding='0' border='0' class='ui-pg-table navtable' style='float:left;table-layout:auto;'><tbody><tr></tr></tbody></table>"),u="<td class='ui-pg-button ui-state-disabled' style='width:4px;'><span class='ui-separator'></span></td>",m,s;if(o===0){m=f;s=n.p.id;if(m==n.p.toppager){s+="_top";q=1}}else{m=n.p.toppager;s=n.p.id+"_top"}if(n.p.direction=="rtl"){b(t).attr("dir","rtl").css("float","right")}if(h.add){g=g||{};r=b("<td class='ui-pg-button ui-corner-all'></td>");b(r).append("<div class='ui-pg-div'><span class='ui-icon "+h.addicon+"'></span>"+h.addtext+"</div>");b("tr",t).append(r);b(r,t).attr({title:h.addtitle||"",id:g.id||"add_"+s}).click(function(){if(!b(this).hasClass("ui-state-disabled")){if(b.isFunction(h.addfunc)){h.addfunc()}else{b(n).jqGrid("editGridRow","new",g)}}return false}).hover(function(){if(!b(this).hasClass("ui-state-disabled")){b(this).addClass("ui-state-hover")}},function(){b(this).removeClass("ui-state-hover")});r=null}if(h.edit){r=b("<td class='ui-pg-button ui-corner-all'></td>");e=e||{};b(r).append("<div class='ui-pg-div'><span class='ui-icon "+h.editicon+"'></span>"+h.edittext+"</div>");b("tr",t).append(r);b(r,t).attr({title:h.edittitle||"",id:e.id||"edit_"+s}).click(function(){if(!b(this).hasClass("ui-state-disabled")){var v=n.p.selrow;if(v){if(b.isFunction(h.editfunc)){h.editfunc(v)}else{b(n).jqGrid("editGridRow",v,e)}}else{b.jgrid.viewModal("#"+k.themodal,{gbox:"#gbox_"+n.p.id,jqm:true});b("#jqg_alrt").focus()}}return false}).hover(function(){if(!b(this).hasClass("ui-state-disabled")){b(this).addClass("ui-state-hover")}},function(){b(this).removeClass("ui-state-hover")});r=null}if(h.view){r=b("<td class='ui-pg-button ui-corner-all'></td>");j=j||{};b(r).append("<div class='ui-pg-div'><span class='ui-icon "+h.viewicon+"'></span>"+h.viewtext+"</div>");b("tr",t).append(r);b(r,t).attr({title:h.viewtitle||"",id:j.id||"view_"+s}).click(function(){if(!b(this).hasClass("ui-state-disabled")){var v=n.p.selrow;if(v){if(b.isFunction(h.viewfunc)){h.viewfunc(v)}else{b(n).jqGrid("viewGridRow",v,j)}}else{b.jgrid.viewModal("#"+k.themodal,{gbox:"#gbox_"+n.p.id,jqm:true});b("#jqg_alrt").focus()}}return false}).hover(function(){if(!b(this).hasClass("ui-state-disabled")){b(this).addClass("ui-state-hover")}},function(){b(this).removeClass("ui-state-hover")});r=null}if(h.del){r=b("<td class='ui-pg-button ui-corner-all'></td>");d=d||{};b(r).append("<div class='ui-pg-div'><span class='ui-icon "+h.delicon+"'></span>"+h.deltext+"</div>");b("tr",t).append(r);b(r,t).attr({title:h.deltitle||"",id:d.id||"del_"+s}).click(function(){if(!b(this).hasClass("ui-state-disabled")){var v;if(n.p.multiselect){v=n.p.selarrrow;if(v.length===0){v=null}}else{v=n.p.selrow}if(v){if("function"==typeof h.delfunc){h.delfunc(v)}else{b(n).jqGrid("delGridRow",v,d)}}else{b.jgrid.viewModal("#"+k.themodal,{gbox:"#gbox_"+n.p.id,jqm:true});b("#jqg_alrt").focus()}}return false}).hover(function(){if(!b(this).hasClass("ui-state-disabled")){b(this).addClass("ui-state-hover")}},function(){b(this).removeClass("ui-state-hover")});r=null}if(h.add||h.edit||h.del||h.view){b("tr",t).append(u)}if(h.search){r=b("<td class='ui-pg-button ui-corner-all'></td>");c=c||{};b(r).append("<div class='ui-pg-div'><span class='ui-icon "+h.searchicon+"'></span>"+h.searchtext+"</div>");b("tr",t).append(r);b(r,t).attr({title:h.searchtitle||"",id:c.id||"search_"+s}).click(function(){if(!b(this).hasClass("ui-state-disabled")){b(n).jqGrid("searchGrid",c)}return false}).hover(function(){if(!b(this).hasClass("ui-state-disabled")){b(this).addClass("ui-state-hover")}},function(){b(this).removeClass("ui-state-hover")});if(c.showOnLoad&&c.showOnLoad===true){b(r,t).click()}r=null}if(h.refresh){r=b("<td class='ui-pg-button ui-corner-all'></td>");b(r).append("<div class='ui-pg-div'><span class='ui-icon "+h.refreshicon+"'></span>"+h.refreshtext+"</div>");b("tr",t).append(r);b(r,t).attr({title:h.refreshtitle||"",id:"refresh_"+s}).click(function(){if(!b(this).hasClass("ui-state-disabled")){if(b.isFunction(h.beforeRefresh)){h.beforeRefresh()}n.p.search=false;try{var v=n.p.id;n.p.postData.filters="";b("#fbox_"+v).jqFilter("resetFilter");if(b.isFunction(n.clearToolbar)){n.clearToolbar(false)}}catch(w){}switch(h.refreshstate){case"firstpage":b(n).trigger("reloadGrid",[{page:1}]);break;case"current":b(n).trigger("reloadGrid",[{current:true}]);break}if(b.isFunction(h.afterRefresh)){h.afterRefresh()}}return false}).hover(function(){if(!b(this).hasClass("ui-state-disabled")){b(this).addClass("ui-state-hover")}},function(){b(this).removeClass("ui-state-hover")});r=null}l=b(".ui-jqgrid").css("font-size")||"11px";b("body").append("<div id='testpg2' class='ui-jqgrid ui-widget ui-widget-content' style='font-size:"+l+";visibility:hidden;' ></div>");p=b(t).clone().appendTo("#testpg2").width();b("#testpg2").remove();b(m+"_"+h.position,m).append(t);if(n.p._nvtd){if(p>n.p._nvtd[0]){b(m+"_"+h.position,m).width(p);n.p._nvtd[0]=p}n.p._nvtd[1]=p}l=null;p=null;t=null;this.nav=true}})},navButtonAdd:function(c,d){d=b.extend({caption:"newButton",title:"",buttonicon:"ui-icon-newwin",onClickButton:null,position:"last",cursor:"pointer"},d||{});return this.each(function(){if(!this.grid){return}if(c.indexOf("#")!==0){c="#"+c}var e=b(".navtable",c)[0],g=this;if(e){if(d.id&&b("#"+d.id,e).html()!==null){return}var f=b("<td></td>");if(d.buttonicon.toString().toUpperCase()=="NONE"){b(f).addClass("ui-pg-button ui-corner-all").append("<div class='ui-pg-div'>"+d.caption+"</div>")}else{b(f).addClass("ui-pg-button ui-corner-all").append("<div class='ui-pg-div'><span class='ui-icon "+d.buttonicon+"'></span>"+d.caption+"</div>")}if(d.id){b(f).attr("id",d.id)}if(d.position=="first"){if(e.rows[0].cells.length===0){b("tr",e).append(f)}else{b("tr td:eq(0)",e).before(f)}}else{b("tr",e).append(f)}b(f,e).attr("title",d.title||"").click(function(h){if(!b(this).hasClass("ui-state-disabled")){if(b.isFunction(d.onClickButton)){d.onClickButton.call(g,h)}}return false}).hover(function(){if(!b(this).hasClass("ui-state-disabled")){b(this).addClass("ui-state-hover")}},function(){b(this).removeClass("ui-state-hover")})}})},navSeparatorAdd:function(c,d){d=b.extend({sepclass:"ui-separator",sepcontent:""},d||{});return this.each(function(){if(!this.grid){return}if(c.indexOf("#")!==0){c="#"+c}var f=b(".navtable",c)[0];if(f){var e="<td class='ui-pg-button ui-state-disabled' style='width:4px;'><span class='"+d.sepclass+"'></span>"+d.sepcontent+"</td>";b("tr",f).append(e)}})},GridToForm:function(c,d){return this.each(function(){var g=this;if(!g.grid){return}var f=b(g).jqGrid("getRowData",c);if(f){for(var e in f){if(b("[name="+b.jgrid.jqID(e)+"]",d).is("input:radio")||b("[name="+b.jgrid.jqID(e)+"]",d).is("input:checkbox")){b("[name="+b.jgrid.jqID(e)+"]",d).each(function(){if(b(this).val()==f[e]){b(this)[g.p.useProp?"prop":"attr"]("checked",true)}else{b(this)[g.p.useProp?"prop":"attr"]("checked",false)}})}else{b("[name="+b.jgrid.jqID(e)+"]",d).val(f[e])}}}})},FormToGrid:function(d,e,f,c){return this.each(function(){var j=this;if(!j.grid){return}if(!f){f="set"}if(!c){c="first"}var g=b(e).serializeArray();var h={};b.each(g,function(k,l){h[l.name]=l.value});if(f=="add"){b(j).jqGrid("addRowData",d,h,c)}else{if(f=="set"){b(j).jqGrid("setRowData",d,h)}}})}})})(jQuery);