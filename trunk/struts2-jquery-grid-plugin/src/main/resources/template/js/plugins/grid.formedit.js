/**
 * jqGrid extension for form editing Grid Data
 * Tony Tomov tony@trirand.com
 * http://trirand.com/blog/
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl-2.0.html
**/
(function(b){var a={};b.jgrid.extend({searchGrid:function(c){c=b.extend({recreateFilter:false,drag:true,sField:"searchField",sValue:"searchString",sOper:"searchOper",sFilter:"filters",loadDefaults:true,beforeShowSearch:null,afterShowSearch:null,onInitializeSearch:null,afterRedraw:null,closeAfterSearch:false,closeAfterReset:false,closeOnEscape:false,multipleSearch:false,multipleGroup:false,top:0,left:0,jqModal:true,modal:false,resize:true,width:450,height:"auto",dataheight:"auto",showQuery:false,errorcheck:true,sopt:null,stringResult:undefined,onClose:null,onSearch:null,onReset:null,toTop:true,overlay:30,columns:[],tmplNames:null,tmplFilters:null,tmplLabel:" Template: ",showOnLoad:false,layer:null},b.jgrid.search,c||{});return this.each(function(){var n=this;if(!n.grid){return}var h="fbox_"+n.p.id,j=true,e={themodal:"searchmod"+h,modalhead:"searchhd"+h,modalcontent:"searchcnt"+h,scrollelm:h},o=n.p.postData[c.sFilter];if(typeof(o)==="string"){o=b.jgrid.parse(o)}if(c.recreateFilter===true){b("#"+e.themodal).remove()}function f(){if(b.isFunction(c.beforeShowSearch)){j=c.beforeShowSearch(b("#"+h));if(typeof(j)==="undefined"){j=true}}if(j){b.jgrid.viewModal("#"+e.themodal,{gbox:"#gbox_"+h,jqm:c.jqModal,modal:c.modal,overlay:c.overlay,toTop:c.toTop});if(b.isFunction(c.afterShowSearch)){c.afterShowSearch(b("#"+h))}}}if(b("#"+e.themodal).html()!==null){f()}else{var s=b("<span><div id='"+h+"' class='searchFilter' style='overflow:auto'></div></span>").insertBefore("#gview_"+n.p.id);if(b.isFunction(c.onInitializeSearch)){c.onInitializeSearch(b("#"+h))}var k=b.extend([],n.p.colModel),g="<a href='javascript:void(0)' id='"+h+"_search' class='fm-button ui-state-default ui-corner-all fm-button-icon-right ui-reset'><span class='ui-icon ui-icon-search'></span>"+c.Find+"</a>",u="<a href='javascript:void(0)' id='"+h+"_reset' class='fm-button ui-state-default ui-corner-all fm-button-icon-left ui-search'><span class='ui-icon ui-icon-arrowreturnthick-1-w'></span>"+c.Reset+"</a>",m="",p="",r,t=false,q,d=-1;if(c.showQuery){m="<a href='javascript:void(0)' id='"+h+"_query' class='fm-button ui-state-default ui-corner-all fm-button-icon-left'><span class='ui-icon ui-icon-comment'></span>Query</a>"}if(!c.columns.length){b.each(k,function(w,z){if(!z.label){z.label=n.p.colNames[w]}if(!t){var v=(typeof z.search==="undefined")?true:z.search,y=(z.hidden===true),x=(z.searchoptions&&z.searchoptions.searchhidden===true);if((x&&v)||(v&&!y)){t=true;r=z.index||z.name;d=w}}})}else{k=c.columns}if((!o&&r)||c.multipleSearch===false){var l="eq";if(d>=0&&k[d].searchoptions&&k[d].searchoptions.sopt){l=k[d].searchoptions.sopt[0]}else{if(c.sopt&&c.sopt.length){l=c.sopt[0]}}o={groupOp:"AND",rules:[{field:r,op:l,data:""}]}}t=false;if(c.tmplNames&&c.tmplNames.length){t=true;p=c.tmplLabel;p+="<select class='ui-template'>";p+="<option value='default'>Default</option>";b.each(c.tmplNames,function(v,w){p+="<option value='"+v+"'>"+w+"</option>"});p+="</select>"}q="<table class='EditTable' style='border:0px none;margin-top:5px' id='"+h+"_2'><tbody><tr><td colspan='2'><hr class='ui-widget-content' style='margin:1px'/></td></tr><tr><td class='EditButton' style='text-align:left'>"+u+p+"</td><td class='EditButton'>"+m+g+"</td></tr></tbody></table>";b("#"+h).jqFilter({columns:k,filter:c.loadDefaults?o:null,showQuery:c.showQuery,errorcheck:c.errorcheck,sopt:c.sopt,groupButton:c.multipleGroup,ruleButtons:c.multipleSearch,afterRedraw:c.afterRedraw,_gridsopt:b.jgrid.search.odata,onChange:function(v){if(this.p.showQuery){b(".query",this).html(this.toUserFriendlyString())}}});s.append(q);if(t&&c.tmplFilters&&c.tmplFilters.length){b(".ui-template",s).bind("change",function(w){var v=b(this).val();if(v=="default"){b("#"+h).jqFilter("addFilter",o)}else{b("#"+h).jqFilter("addFilter",c.tmplFilters[parseInt(v,10)])}return false})}if(c.multipleGroup===true){c.multipleSearch=true}if(b.isFunction(c.onInitializeSearch)){c.onInitializeSearch(b("#"+h))}if(c.layer){b.jgrid.createModal(e,s,c,"#gview_"+n.p.id,b("#gbox_"+n.p.id)[0],"#"+c.layer,{position:"relative"})}else{b.jgrid.createModal(e,s,c,"#gview_"+n.p.id,b("#gbox_"+n.p.id)[0])}if(m){b("#"+h+"_query").bind("click",function(v){b(".queryresult",s).toggle();return false})}if(c.stringResult===undefined){c.stringResult=c.multipleSearch}b("#"+h+"_search").bind("click",function(){var y=b("#"+h),w={},v,x=y.jqFilter("filterData");if(c.errorcheck){y[0].hideError();if(!c.showQuery){y.jqFilter("toSQLString")}if(y[0].p.error){y[0].showError();return false}}if(c.stringResult){try{v=xmlJsonClass.toJson(x,"","",false)}catch(A){try{v=JSON.stringify(x)}catch(z){}}if(typeof(v)==="string"){w[c.sFilter]=v;b.each([c.sField,c.sValue,c.sOper],function(){w[this]=""})}}else{if(c.multipleSearch){w[c.sFilter]=x;b.each([c.sField,c.sValue,c.sOper],function(){w[this]=""})}else{w[c.sField]=x.rules[0].field;w[c.sValue]=x.rules[0].data;w[c.sOper]=x.rules[0].op;w[c.sFilter]=""}}n.p.search=true;b.extend(n.p.postData,w);if(b.isFunction(c.onSearch)){c.onSearch()}b(n).trigger("reloadGrid",[{page:1}]);if(c.closeAfterSearch){b.jgrid.hideModal("#"+e.themodal,{gb:"#gbox_"+n.p.id,jqm:c.jqModal,onClose:c.onClose})}return false});b("#"+h+"_reset").bind("click",function(){var v={},w=b("#"+h);n.p.search=false;if(c.multipleSearch===false){v[c.sField]=v[c.sValue]=v[c.sOper]=""}else{v[c.sFilter]=""}w[0].resetFilter();if(t){b(".ui-template",s).val("default")}b.extend(n.p.postData,v);if(b.isFunction(c.onReset)){c.onReset()}b(n).trigger("reloadGrid",[{page:1}]);return false});f();b(".fm-button:not(.ui-state-disabled)",s).hover(function(){b(this).addClass("ui-state-hover")},function(){b(this).removeClass("ui-state-hover")})}})},editGridRow:function(c,d){d=b.extend({top:0,left:0,width:300,height:"auto",dataheight:"auto",modal:false,overlay:30,drag:true,resize:true,url:null,mtype:"POST",clearAfterAdd:true,closeAfterEdit:false,reloadAfterSubmit:true,onInitializeForm:null,beforeInitData:null,beforeShowForm:null,afterShowForm:null,beforeSubmit:null,afterSubmit:null,onclickSubmit:null,afterComplete:null,onclickPgButtons:null,afterclickPgButtons:null,editData:{},recreateForm:false,jqModal:true,closeOnEscape:false,addedrow:"first",topinfo:"",bottominfo:"",saveicon:[],closeicon:[],savekey:[false,13],navkeys:[false,38,40],checkOnSubmit:false,checkOnUpdate:false,_savedData:{},processing:false,onClose:null,ajaxEditOptions:{},serializeEditData:null,viewPagerButtons:true},b.jgrid.edit,d||{});a[b(this)[0].p.id]=d;return this.each(function(){var e=this;if(!e.grid||!c){return}var B=e.p.id,y="FrmGrid_"+B,v="TblGrid_"+B,j={themodal:"editmod"+B,modalhead:"edithd"+B,modalcontent:"editcnt"+B,scrollelm:y},C=b.isFunction(a[e.p.id].beforeShowForm)?a[e.p.id].beforeShowForm:false,M=b.isFunction(a[e.p.id].afterShowForm)?a[e.p.id].afterShowForm:false,L=b.isFunction(a[e.p.id].beforeInitData)?a[e.p.id].beforeInitData:false,p=b.isFunction(a[e.p.id].onInitializeForm)?a[e.p.id].onInitializeForm:false,G=null,X=true,H=1,r=0,D,P,F,A;if(c==="new"){c="_empty";d.caption=a[e.p.id].addCaption}else{d.caption=a[e.p.id].editCaption}if(d.recreateForm===true&&b("#"+j.themodal).html()!==null){b("#"+j.themodal).remove()}var m=true;if(d.checkOnUpdate&&d.jqModal&&!d.modal){m=false}function W(){b("#"+v+" > tbody > tr > td > .FormElement").each(function(ab){var ae=b(".customelement",this);if(ae.length){var ac=ae[0],Z=b(ac).attr("name");b.each(e.p.colModel,function(af,ah){if(this.name===Z&&this.editoptions&&b.isFunction(this.editoptions.custom_value)){try{D[Z]=this.editoptions.custom_value(b("#"+b.jgrid.jqID(Z),"#"+v),"get");if(D[Z]===undefined){throw"e1"}}catch(ag){if(ag==="e1"){b.jgrid.info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+b.jgrid.edit.msg.novalue,jQuery.jgrid.edit.bClose)}else{b.jgrid.info_dialog(jQuery.jgrid.errors.errcap,ag.message,jQuery.jgrid.edit.bClose)}}return true}})}else{switch(b(this).get(0).type){case"checkbox":if(b(this).attr("checked")){D[this.name]=b(this).val()}else{var aa=b(this).attr("offval");D[this.name]=aa}break;case"select-one":D[this.name]=b("option:selected",this).val();P[this.name]=b("option:selected",this).text();break;case"select-multiple":D[this.name]=b(this).val();if(D[this.name]){D[this.name]=D[this.name].join(",")}else{D[this.name]=""}var ad=[];b("option:selected",this).each(function(af,ag){ad[af]=b(ag).text()});P[this.name]=ad.join(",");break;case"password":case"text":case"textarea":case"button":D[this.name]=b(this).val();break}if(e.p.autoencode){D[this.name]=b.jgrid.htmlEncode(D[this.name])}}});return true}function t(ab,ai,af,ad){var ap,aj,aa,ae=0,ah,ao,Z,al=[],ac=false,ak="<td class='CaptionTD'>&#160;</td><td class='DataTD'>&#160;</td>",an="",ag;for(ag=1;ag<=ad;ag++){an+=ak}if(ab!="_empty"){ac=b(ai).jqGrid("getInd",ab)}b(ai.p.colModel).each(function(at){ap=this.name;if(this.editrules&&this.editrules.edithidden===true){aj=false}else{aj=this.hidden===true?true:false}ao=aj?"style='display:none'":"";if(ap!=="cb"&&ap!=="subgrid"&&this.editable===true&&ap!=="rn"){if(ac===false){ah=""}else{if(ap==ai.p.ExpandColumn&&ai.p.treeGrid===true){ah=b("td:eq("+at+")",ai.rows[ac]).text()}else{try{ah=b.unformat(b("td:eq("+at+")",ai.rows[ac]),{rowId:ab,colModel:this},at)}catch(aq){ah=(this.edittype&&this.edittype=="textarea")?b("td:eq("+at+")",ai.rows[ac]).text():b("td:eq("+at+")",ai.rows[ac]).html()}if(!ah||ah=="&nbsp;"||ah=="&#160;"||(ah.length==1&&ah.charCodeAt(0)==160)){ah=""}}}var ar=b.extend({},this.editoptions||{},{id:ap,name:ap}),ax=b.extend({},{elmprefix:"",elmsuffix:"",rowabove:false,rowcontent:""},this.formoptions||{}),au=parseInt(ax.rowpos,10)||ae+1,aw=parseInt((parseInt(ax.colpos,10)||1)*2,10);if(ab=="_empty"&&ar.defaultValue){ah=b.isFunction(ar.defaultValue)?ar.defaultValue():ar.defaultValue}if(!this.edittype){this.edittype="text"}if(e.p.autoencode){ah=b.jgrid.htmlDecode(ah)}Z=b.jgrid.createEl(this.edittype,ar,ah,false,b.extend({},b.jgrid.ajaxOptions,ai.p.ajaxSelectOptions||{}));if(ah===""&&this.edittype=="checkbox"){ah=b(Z).attr("offval")}if(ah===""&&this.edittype=="select"){ah=b("option:eq(0)",Z).text()}if(a[e.p.id].checkOnSubmit||a[e.p.id].checkOnUpdate){a[e.p.id]._savedData[ap]=ah}b(Z).addClass("FormElement");if(this.edittype=="text"||this.edittype=="textarea"){b(Z).addClass("ui-widget-content ui-corner-all")}aa=b(af).find("tr[rowpos="+au+"]");if(ax.rowabove){var av=b("<tr><td class='contentinfo' colspan='"+(ad*2)+"'>"+ax.rowcontent+"</td></tr>");b(af).append(av);av[0].rp=au}if(aa.length===0){aa=b("<tr "+ao+" rowpos='"+au+"'></tr>").addClass("FormData").attr("id","tr_"+ap);b(aa).append(an);b(af).append(aa);aa[0].rp=au}b("td:eq("+(aw-2)+")",aa[0]).html(typeof ax.label==="undefined"?ai.p.colNames[at]:ax.label);b("td:eq("+(aw-1)+")",aa[0]).append(ax.elmprefix).append(Z).append(ax.elmsuffix);al[ae]=at;ae++}});if(ae>0){var am=b("<tr class='FormData' style='display:none'><td class='CaptionTD'></td><td colspan='"+(ad*2-1)+"' class='DataTD'><input class='FormElement' id='id_g' type='text' name='"+ai.p.id+"_id' value='"+ab+"'/></td></tr>");am[0].rp=ae+999;b(af).append(am);if(a[e.p.id].checkOnSubmit||a[e.p.id].checkOnUpdate){a[e.p.id]._savedData[ai.p.id+"_id"]=ab}}return al}function q(Z,ag,ac){var ak,ad=0,ah,af,aa,ae,ai;if(a[e.p.id].checkOnSubmit||a[e.p.id].checkOnUpdate){a[e.p.id]._savedData={};a[e.p.id]._savedData[ag.p.id+"_id"]=Z}var aj=ag.p.colModel;if(Z=="_empty"){b(aj).each(function(al){ak=this.name;aa=b.extend({},this.editoptions||{});af=b("#"+b.jgrid.jqID(ak),"#"+ac);if(af&&af.length&&af[0]!==null){ae="";if(aa.defaultValue){ae=b.isFunction(aa.defaultValue)?aa.defaultValue():aa.defaultValue;if(af[0].type=="checkbox"){ai=ae.toLowerCase();if(ai.search(/(false|0|no|off|undefined)/i)<0&&ai!==""){af[0].checked=true;af[0].defaultChecked=true;af[0].value=ae}else{af.attr({checked:"",defaultChecked:""})}}else{af.val(ae)}}else{if(af[0].type=="checkbox"){af[0].checked=false;af[0].defaultChecked=false;ae=b(af).attr("offval")}else{if(af[0].type&&af[0].type.substr(0,6)=="select"){af[0].selectedIndex=0}else{af.val(ae)}}}if(a[e.p.id].checkOnSubmit===true||a[e.p.id].checkOnUpdate){a[e.p.id]._savedData[ak]=ae}}});b("#id_g","#"+ac).val(Z);return}var ab=b(ag).jqGrid("getInd",Z,true);if(!ab){return}b("td",ab).each(function(ao){ak=aj[ao].name;if(ak!=="cb"&&ak!=="subgrid"&&ak!=="rn"&&aj[ao].editable===true){if(ak==ag.p.ExpandColumn&&ag.p.treeGrid===true){ah=b(this).text()}else{try{ah=b.unformat(b(this),{rowId:Z,colModel:aj[ao]},ao)}catch(an){ah=aj[ao].edittype=="textarea"?b(this).text():b(this).html()}}if(e.p.autoencode){ah=b.jgrid.htmlDecode(ah)}if(a[e.p.id].checkOnSubmit===true||a[e.p.id].checkOnUpdate){a[e.p.id]._savedData[ak]=ah}ak=b.jgrid.jqID(ak);switch(aj[ao].edittype){case"password":case"text":case"button":case"image":case"textarea":if(ah=="&nbsp;"||ah=="&#160;"||(ah.length==1&&ah.charCodeAt(0)==160)){ah=""}b("#"+ak,"#"+ac).val(ah);break;case"select":var am=ah.split(",");am=b.map(am,function(aq){return b.trim(aq)});b("#"+ak+" option","#"+ac).each(function(aq){if(!aj[ao].editoptions.multiple&&(am[0]==b.trim(b(this).text())||am[0]==b.trim(b(this).val()))){this.selected=true}else{if(aj[ao].editoptions.multiple){if(b.inArray(b.trim(b(this).text()),am)>-1||b.inArray(b.trim(b(this).val()),am)>-1){this.selected=true}else{this.selected=false}}else{this.selected=false}}});break;case"checkbox":ah=ah+"";if(aj[ao].editoptions&&aj[ao].editoptions.value){var al=aj[ao].editoptions.value.split(":");if(al[0]==ah){b("#"+ak,"#"+ac).attr("checked",true);b("#"+ak,"#"+ac).attr("defaultChecked",true)}else{b("#"+ak,"#"+ac).attr("checked",false);b("#"+ak,"#"+ac).attr("defaultChecked","")}}else{ah=ah.toLowerCase();if(ah.search(/(false|0|no|off|undefined)/i)<0&&ah!==""){b("#"+ak,"#"+ac).attr("checked",true);b("#"+ak,"#"+ac).attr("defaultChecked",true)}else{b("#"+ak,"#"+ac).attr("checked",false);b("#"+ak,"#"+ac).attr("defaultChecked","")}}break;case"custom":try{if(aj[ao].editoptions&&b.isFunction(aj[ao].editoptions.custom_value)){aj[ao].editoptions.custom_value(b("#"+ak,"#"+ac),"set",ah)}else{throw"e1"}}catch(ap){if(ap=="e1"){b.jgrid.info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+b.jgrid.edit.msg.nodefined,jQuery.jgrid.edit.bClose)}else{b.jgrid.info_dialog(jQuery.jgrid.errors.errcap,ap.message,jQuery.jgrid.edit.bClose)}}break}ad++}});if(ad>0){b("#id_g","#"+v).val(Z)}}function k(){var ai,ah=[true,"",""],Z={},ad=e.p.prmNames,ag,ac,ak,ae;if(b.isFunction(a[e.p.id].beforeCheckValues)){var af=a[e.p.id].beforeCheckValues(D,b("#"+y),D[e.p.id+"_id"]=="_empty"?ad.addoper:ad.editoper);if(af&&typeof(af)==="object"){D=af}}for(ak in D){if(D.hasOwnProperty(ak)){ah=b.jgrid.checkValues(D[ak],ak,e);if(ah[0]===false){break}}}T();if(ah[0]){if(b.isFunction(a[e.p.id].onclickSubmit)){Z=a[e.p.id].onclickSubmit(a[e.p.id],D)||{}}if(b.isFunction(a[e.p.id].beforeSubmit)){ah=a[e.p.id].beforeSubmit(D,b("#"+y))}}if(ah[0]&&!a[e.p.id].processing){a[e.p.id].processing=true;b("#sData","#"+v+"_2").addClass("ui-state-active");ac=ad.oper;ag=ad.id;D[ac]=(b.trim(D[e.p.id+"_id"])=="_empty")?ad.addoper:ad.editoper;if(D[ac]!=ad.addoper){D[ag]=D[e.p.id+"_id"]}else{if(D[ag]===undefined){D[ag]=D[e.p.id+"_id"]}}delete D[e.p.id+"_id"];D=b.extend(D,a.editData,Z);if(e.p.treeGrid===true){if(D[ac]==ad.addoper){ae=b(e).jqGrid("getGridParam","selrow");var aa=e.p.treeGridModel=="adjacency"?e.p.treeReader.parent_id_field:"parent_id";D[aa]=ae}for(i in e.p.treeReader){var aj=e.p.treeReader[i];if(D.hasOwnProperty(aj)){if(D[ac]==ad.addoper&&i==="parent_id_field"){continue}delete D[aj]}}}var ab=b.extend({url:a[e.p.id].url?a[e.p.id].url:b(e).jqGrid("getGridParam","editurl"),type:a[e.p.id].mtype,data:b.isFunction(a[e.p.id].serializeEditData)?a[e.p.id].serializeEditData(D):D,complete:function(an,al){if(al!="success"){ah[0]=false;if(b.isFunction(a[e.p.id].errorTextFormat)){ah[1]=a[e.p.id].errorTextFormat(an)}else{ah[1]=al+" Status: '"+an.statusText+"'. Error code: "+an.status}}else{if(b.isFunction(a[e.p.id].afterSubmit)){ah=a[e.p.id].afterSubmit(an,D)}}if(ah[0]===false){b("#FormError>td","#"+v).html(ah[1]);b("#FormError","#"+v).show()}else{b.each(e.p.colModel,function(ap,ar){if(P[this.name]&&this.formatter&&this.formatter=="select"){try{delete P[this.name]}catch(aq){}}});D=b.extend(D,P);if(e.p.autoencode){b.each(D,function(aq,ap){D[aq]=b.jgrid.htmlDecode(ap)})}if(D[ac]==ad.addoper){if(!ah[2]){ah[2]=b.jgrid.randId()}D[ag]=ah[2];if(a[e.p.id].closeAfterAdd){if(a[e.p.id].reloadAfterSubmit){b(e).trigger("reloadGrid")}else{if(e.p.treeGrid===true){b(e).jqGrid("addChildNode",ah[2],ae,D)}else{b(e).jqGrid("addRowData",ah[2],D,d.addedrow);b(e).jqGrid("setSelection",ah[2])}}b.jgrid.hideModal("#"+j.themodal,{gb:"#gbox_"+B,jqm:d.jqModal,onClose:a[e.p.id].onClose})}else{if(a[e.p.id].clearAfterAdd){if(a[e.p.id].reloadAfterSubmit){b(e).trigger("reloadGrid")}else{if(e.p.treeGrid===true){b(e).jqGrid("addChildNode",ah[2],ae,D)}else{b(e).jqGrid("addRowData",ah[2],D,d.addedrow)}}q("_empty",e,y)}else{if(a[e.p.id].reloadAfterSubmit){b(e).trigger("reloadGrid")}else{if(e.p.treeGrid===true){b(e).jqGrid("addChildNode",ah[2],ae,D)}else{b(e).jqGrid("addRowData",ah[2],D,d.addedrow)}}}}}else{if(a[e.p.id].reloadAfterSubmit){b(e).trigger("reloadGrid");if(!a[e.p.id].closeAfterEdit){setTimeout(function(){b(e).jqGrid("setSelection",D[ag])},1000)}}else{if(e.p.treeGrid===true){b(e).jqGrid("setTreeRow",D[ag],D)}else{b(e).jqGrid("setRowData",D[ag],D)}}if(a[e.p.id].closeAfterEdit){b.jgrid.hideModal("#"+j.themodal,{gb:"#gbox_"+B,jqm:d.jqModal,onClose:a[e.p.id].onClose})}}if(b.isFunction(a[e.p.id].afterComplete)){ai=an;setTimeout(function(){a[e.p.id].afterComplete(ai,D,b("#"+y));ai=null},500)}if(a[e.p.id].checkOnSubmit||a[e.p.id].checkOnUpdate){b("#"+y).data("disabled",false);if(a[e.p.id]._savedData[e.p.id+"_id"]!="_empty"){for(var am in a[e.p.id]._savedData){if(D[am]){a[e.p.id]._savedData[am]=D[am]}}}}}a[e.p.id].processing=false;b("#sData","#"+v+"_2").removeClass("ui-state-active");try{b(":input:visible","#"+y)[0].focus()}catch(ao){}}},b.jgrid.ajaxOptions,a[e.p.id].ajaxEditOptions);if(!ab.url&&!a[e.p.id].useDataProxy){if(b.isFunction(e.p.dataProxy)){a[e.p.id].useDataProxy=true}else{ah[0]=false;ah[1]+=" "+b.jgrid.errors.nourl}}if(ah[0]){if(a[e.p.id].useDataProxy){e.p.dataProxy.call(e,ab,"set_"+e.p.id)}else{b.ajax(ab)}}}if(ah[0]===false){b("#FormError>td","#"+v).html(ah[1]);b("#FormError","#"+v).show()}}function J(ac,Z){var aa=false,ab;for(ab in ac){if(ac[ab]!=Z[ab]){aa=true;break}}return aa}function T(){b.each(e.p.colModel,function(Z,aa){if(aa.editoptions&&aa.editoptions.NullIfEmpty===true){if(D.hasOwnProperty(aa.name)&&D[aa.name]==""){D[aa.name]="null"}}})}function g(){var Z=true;b("#FormError","#"+v).hide();if(a[e.p.id].checkOnUpdate){D={};P={};W();F=b.extend({},D,P);A=J(F,a[e.p.id]._savedData);if(A){b("#"+y).data("disabled",true);b(".confirm","#"+j.themodal).show();Z=false}}return Z}function V(){if(c!=="_empty"&&typeof(e.p.savedRow)!=="undefined"&&e.p.savedRow.length>0&&b.isFunction(b.fn.jqGrid.restoreRow)){for(var Z=0;Z<e.p.savedRow.length;Z++){if(e.p.savedRow[Z].id==c){b(e).jqGrid("restoreRow",c);break}}}}function I(Z,aa){if(Z===0){b("#pData","#"+v+"_2").addClass("ui-state-disabled")}else{b("#pData","#"+v+"_2").removeClass("ui-state-disabled")}if(Z==aa){b("#nData","#"+v+"_2").addClass("ui-state-disabled")}else{b("#nData","#"+v+"_2").removeClass("ui-state-disabled")}}function Y(){var aa=b(e).jqGrid("getDataIDs"),Z=b("#id_g","#"+v).val(),ab=b.inArray(Z,aa);return[ab,aa]}if(b("#"+j.themodal).html()!==null){if(L){X=L(b("#"+y));if(typeof(X)=="undefined"){X=true}}if(X===false){return}V();b(".ui-jqdialog-title","#"+j.modalhead).html(d.caption);b("#FormError","#"+v).hide();if(a[e.p.id].topinfo){b(".topinfo","#"+v+"_2").html(a[e.p.id].topinfo);b(".tinfo","#"+v+"_2").show()}else{b(".tinfo","#"+v+"_2").hide()}if(a[e.p.id].bottominfo){b(".bottominfo","#"+v+"_2").html(a[e.p.id].bottominfo);b(".binfo","#"+v+"_2").show()}else{b(".binfo","#"+v+"_2").hide()}q(c,e,y);if(c=="_empty"||!a[e.p.id].viewPagerButtons){b("#pData, #nData","#"+v+"_2").hide()}else{b("#pData, #nData","#"+v+"_2").show()}if(a[e.p.id].processing===true){a[e.p.id].processing=false;b("#sData","#"+v+"_2").removeClass("ui-state-active")}if(b("#"+y).data("disabled")===true){b(".confirm","#"+j.themodal).hide();b("#"+y).data("disabled",false)}if(C){C(b("#"+y))}b("#"+j.themodal).data("onClose",a[e.p.id].onClose);b.jgrid.viewModal("#"+j.themodal,{gbox:"#gbox_"+B,jqm:d.jqModal,jqM:false,overlay:d.overlay,modal:d.modal});if(!m){b(".jqmOverlay").click(function(){if(!g()){return false}b.jgrid.hideModal("#"+j.themodal,{gb:"#gbox_"+B,jqm:d.jqModal,onClose:a[e.p.id].onClose});return false})}if(M){M(b("#"+y))}}else{var s=isNaN(d.dataheight)?d.dataheight:d.dataheight+"px",S=b("<form name='FormPost' id='"+y+"' class='FormGrid' onSubmit='return false;' style='width:100%;overflow:auto;position:relative;height:"+s+";'></form>").data("disabled",false),z=b("<table id='"+v+"' class='EditTable' cellspacing='0' cellpadding='0' border='0'><tbody></tbody></table>");if(L){X=L(b("#"+y));if(typeof(X)=="undefined"){X=true}}if(X===false){return}V();b(e.p.colModel).each(function(Z){var aa=this.formoptions;H=Math.max(H,aa?aa.colpos||0:0);r=Math.max(r,aa?aa.rowpos||0:0)});b(S).append(z);var K=b("<tr id='FormError' style='display:none'><td class='ui-state-error' colspan='"+(H*2)+"'></td></tr>");K[0].rp=0;b(z).append(K);K=b("<tr style='display:none' class='tinfo'><td class='topinfo' colspan='"+(H*2)+"'>"+a[e.p.id].topinfo+"</td></tr>");K[0].rp=0;b(z).append(K);var f=e.p.direction=="rtl"?true:false,R=f?"nData":"pData",U=f?"pData":"nData";t(c,e,z,H);var l="<a href='javascript:void(0)' id='"+R+"' class='fm-button ui-state-default ui-corner-left'><span class='ui-icon ui-icon-triangle-1-w'></span></a>",n="<a href='javascript:void(0)' id='"+U+"' class='fm-button ui-state-default ui-corner-right'><span class='ui-icon ui-icon-triangle-1-e'></span></a>",h="<a href='javascript:void(0)' id='sData' class='fm-button ui-state-default ui-corner-all'>"+d.bSubmit+"</a>",u="<a href='javascript:void(0)' id='cData' class='fm-button ui-state-default ui-corner-all'>"+d.bCancel+"</a>";var O="<table border='0' cellspacing='0' cellpadding='0' class='EditTable' id='"+v+"_2'><tbody><tr><td colspan='2'><hr class='ui-widget-content' style='margin:1px'/></td></tr><tr id='Act_Buttons'><td class='navButton'>"+(f?n+l:l+n)+"</td><td class='EditButton'>"+h+u+"</td></tr>";O+="<tr style='display:none' class='binfo'><td class='bottominfo' colspan='2'>"+a[e.p.id].bottominfo+"</td></tr>";O+="</tbody></table>";if(r>0){var x=[];b.each(b(z)[0].rows,function(Z,aa){x[Z]=aa});x.sort(function(aa,Z){if(aa.rp>Z.rp){return 1}if(aa.rp<Z.rp){return -1}return 0});b.each(x,function(Z,aa){b("tbody",z).append(aa)})}d.gbox="#gbox_"+B;var o=false;if(d.closeOnEscape===true){d.closeOnEscape=false;o=true}var N=b("<span></span>").append(S).append(O);b.jgrid.createModal(j,N,d,"#gview_"+e.p.id,b("#gbox_"+e.p.id)[0]);if(f){b("#pData, #nData","#"+v+"_2").css("float","right");b(".EditButton","#"+v+"_2").css("text-align","left")}if(a[e.p.id].topinfo){b(".tinfo","#"+v+"_2").show()}if(a[e.p.id].bottominfo){b(".binfo","#"+v+"_2").show()}N=null;O=null;b("#"+j.themodal).keydown(function(Z){var aa=Z.target;if(b("#"+y).data("disabled")===true){return false}if(a[e.p.id].savekey[0]===true&&Z.which==a[e.p.id].savekey[1]){if(aa.tagName!="TEXTAREA"){b("#sData","#"+v+"_2").trigger("click");return false}}if(Z.which===27){if(!g()){return false}if(o){b.jgrid.hideModal(this,{gb:d.gbox,jqm:d.jqModal,onClose:a[e.p.id].onClose})}return false}if(a[e.p.id].navkeys[0]===true){if(b("#id_g","#"+v).val()=="_empty"){return true}if(Z.which==a[e.p.id].navkeys[1]){b("#pData","#"+v+"_2").trigger("click");return false}if(Z.which==a[e.p.id].navkeys[2]){b("#nData","#"+v+"_2").trigger("click");return false}}});if(d.checkOnUpdate){b("a.ui-jqdialog-titlebar-close span","#"+j.themodal).removeClass("jqmClose");b("a.ui-jqdialog-titlebar-close","#"+j.themodal).unbind("click").click(function(){if(!g()){return false}b.jgrid.hideModal("#"+j.themodal,{gb:"#gbox_"+B,jqm:d.jqModal,onClose:a[e.p.id].onClose});return false})}d.saveicon=b.extend([true,"left","ui-icon-disk"],d.saveicon);d.closeicon=b.extend([true,"left","ui-icon-close"],d.closeicon);if(d.saveicon[0]===true){b("#sData","#"+v+"_2").addClass(d.saveicon[1]=="right"?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+d.saveicon[2]+"'></span>")}if(d.closeicon[0]===true){b("#cData","#"+v+"_2").addClass(d.closeicon[1]=="right"?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+d.closeicon[2]+"'></span>")}if(a[e.p.id].checkOnSubmit||a[e.p.id].checkOnUpdate){h="<a href='javascript:void(0)' id='sNew' class='fm-button ui-state-default ui-corner-all' style='z-index:1002'>"+d.bYes+"</a>";n="<a href='javascript:void(0)' id='nNew' class='fm-button ui-state-default ui-corner-all' style='z-index:1002'>"+d.bNo+"</a>";u="<a href='javascript:void(0)' id='cNew' class='fm-button ui-state-default ui-corner-all' style='z-index:1002'>"+d.bExit+"</a>";var E,w=d.zIndex||999;w++;if(b.browser.msie&&b.browser.version==6){E='<iframe style="display:block;position:absolute;z-index:-1;filter:Alpha(Opacity=\'0\');" src="javascript:false;"></iframe>'}else{E=""}b("<div class='ui-widget-overlay jqgrid-overlay confirm' style='z-index:"+w+";display:none;'>&#160;"+E+"</div><div class='confirm ui-widget-content ui-jqconfirm' style='z-index:"+(w+1)+"'>"+d.saveData+"<br/><br/>"+h+n+u+"</div>").insertAfter("#"+y);b("#sNew","#"+j.themodal).click(function(){k();b("#"+y).data("disabled",false);b(".confirm","#"+j.themodal).hide();return false});b("#nNew","#"+j.themodal).click(function(){b(".confirm","#"+j.themodal).hide();b("#"+y).data("disabled",false);setTimeout(function(){b(":input","#"+y)[0].focus()},0);return false});b("#cNew","#"+j.themodal).click(function(){b(".confirm","#"+j.themodal).hide();b("#"+y).data("disabled",false);b.jgrid.hideModal("#"+j.themodal,{gb:"#gbox_"+B,jqm:d.jqModal,onClose:a[e.p.id].onClose});return false})}if(p){p(b("#"+y))}if(c=="_empty"||!a[e.p.id].viewPagerButtons){b("#pData,#nData","#"+v+"_2").hide()}else{b("#pData,#nData","#"+v+"_2").show()}if(C){C(b("#"+y))}b("#"+j.themodal).data("onClose",a[e.p.id].onClose);b.jgrid.viewModal("#"+j.themodal,{gbox:"#gbox_"+B,jqm:d.jqModal,overlay:d.overlay,modal:d.modal});if(!m){b(".jqmOverlay").click(function(){if(!g()){return false}b.jgrid.hideModal("#"+j.themodal,{gb:"#gbox_"+B,jqm:d.jqModal,onClose:a[e.p.id].onClose});return false})}if(M){M(b("#"+y))}b(".fm-button","#"+j.themodal).hover(function(){b(this).addClass("ui-state-hover")},function(){b(this).removeClass("ui-state-hover")});b("#sData","#"+v+"_2").click(function(Z){D={};P={};b("#FormError","#"+v).hide();W();if(D[e.p.id+"_id"]=="_empty"){k()}else{if(d.checkOnSubmit===true){F=b.extend({},D,P);A=J(F,a[e.p.id]._savedData);if(A){b("#"+y).data("disabled",true);b(".confirm","#"+j.themodal).show()}else{k()}}else{k()}}return false});b("#cData","#"+v+"_2").click(function(Z){if(!g()){return false}b.jgrid.hideModal("#"+j.themodal,{gb:"#gbox_"+B,jqm:d.jqModal,onClose:a[e.p.id].onClose});return false});b("#nData","#"+v+"_2").click(function(Z){if(!g()){return false}b("#FormError","#"+v).hide();var aa=Y();aa[0]=parseInt(aa[0],10);if(aa[0]!=-1&&aa[1][aa[0]+1]){if(b.isFunction(d.onclickPgButtons)){d.onclickPgButtons("next",b("#"+y),aa[1][aa[0]])}q(aa[1][aa[0]+1],e,y);b(e).jqGrid("setSelection",aa[1][aa[0]+1]);if(b.isFunction(d.afterclickPgButtons)){d.afterclickPgButtons("next",b("#"+y),aa[1][aa[0]+1])}I(aa[0]+1,aa[1].length-1)}return false});b("#pData","#"+v+"_2").click(function(aa){if(!g()){return false}b("#FormError","#"+v).hide();var Z=Y();if(Z[0]!=-1&&Z[1][Z[0]-1]){if(b.isFunction(d.onclickPgButtons)){d.onclickPgButtons("prev",b("#"+y),Z[1][Z[0]])}q(Z[1][Z[0]-1],e,y);b(e).jqGrid("setSelection",Z[1][Z[0]-1]);if(b.isFunction(d.afterclickPgButtons)){d.afterclickPgButtons("prev",b("#"+y),Z[1][Z[0]-1])}I(Z[0]-1,Z[1].length-1)}return false})}var Q=Y();I(Q[0],Q[1].length-1)})},viewGridRow:function(c,d){d=b.extend({top:0,left:0,width:0,height:"auto",dataheight:"auto",modal:false,overlay:30,drag:true,resize:true,jqModal:true,closeOnEscape:false,labelswidth:"30%",closeicon:[],navkeys:[false,38,40],onClose:null,beforeShowForm:null,beforeInitData:null,viewPagerButtons:true},b.jgrid.view,d||{});return this.each(function(){var x=this;if(!x.grid||!c){return}if(!d.imgpath){d.imgpath=x.p.imgpath}var t=x.p.id,B="ViewGrid_"+t,u="ViewTbl_"+t,k={themodal:"viewmod"+t,modalhead:"viewhd"+t,modalcontent:"viewcnt"+t,scrollelm:B},A=b.isFunction(d.beforeInitData)?d.beforeInitData:false,n=true,h=1,g=0;function l(){if(d.closeOnEscape===true||d.navkeys[0]===true){setTimeout(function(){b(".ui-jqdialog-titlebar-close","#"+k.modalhead).focus()},0)}}function p(L,R,P,X){var H,K,S,V=0,aa,ab,Z=[],Q=false,M="<td class='CaptionTD form-view-label ui-widget-content' width='"+d.labelswidth+"'>&#160;</td><td class='DataTD form-view-data ui-helper-reset ui-widget-content'>&#160;</td>",O="",I="<td class='CaptionTD form-view-label ui-widget-content'>&#160;</td><td class='DataTD form-view-data ui-widget-content'>&#160;</td>",N=["integer","number","currency"],U=0,T=0,J,G,Y;for(var W=1;W<=X;W++){O+=W==1?M:I}b(R.p.colModel).each(function(ad){if(this.editrules&&this.editrules.edithidden===true){K=false}else{K=this.hidden===true?true:false}if(!K&&this.align==="right"){if(this.formatter&&b.inArray(this.formatter,N)!==-1){U=Math.max(U,parseInt(this.width,10))}else{T=Math.max(T,parseInt(this.width,10))}}});J=U!==0?U:T!==0?T:0;Q=b(R).jqGrid("getInd",L);b(R.p.colModel).each(function(ae){H=this.name;G=false;if(this.editrules&&this.editrules.edithidden===true){K=false}else{K=this.hidden===true?true:false}ab=K?"style='display:none'":"";Y=(typeof this.viewable!="boolean")?true:this.viewable;if(H!=="cb"&&H!=="subgrid"&&H!=="rn"&&Y){if(Q===false){aa=""}else{if(H==R.p.ExpandColumn&&R.p.treeGrid===true){aa=b("td:eq("+ae+")",R.rows[Q]).text()}else{aa=b("td:eq("+ae+")",R.rows[Q]).html()}}G=this.align==="right"&&J!==0?true:false;var ad=b.extend({},this.editoptions||{},{id:H,name:H}),ai=b.extend({},{rowabove:false,rowcontent:""},this.formoptions||{}),af=parseInt(ai.rowpos,10)||V+1,ah=parseInt((parseInt(ai.colpos,10)||1)*2,10);if(ai.rowabove){var ag=b("<tr><td class='contentinfo' colspan='"+(X*2)+"'>"+ai.rowcontent+"</td></tr>");b(P).append(ag);ag[0].rp=af}S=b(P).find("tr[rowpos="+af+"]");if(S.length===0){S=b("<tr "+ab+" rowpos='"+af+"'></tr>").addClass("FormData").attr("id","trv_"+H);b(S).append(O);b(P).append(S);S[0].rp=af}b("td:eq("+(ah-2)+")",S[0]).html("<b>"+(typeof ai.label==="undefined"?R.p.colNames[ae]:ai.label)+"</b>");b("td:eq("+(ah-1)+")",S[0]).append("<span>"+aa+"</span>").attr("id","v_"+H);if(G){b("td:eq("+(ah-1)+") span",S[0]).css({"text-align":"right",width:J+"px"})}Z[V]=ae;V++}});if(V>0){var ac=b("<tr class='FormData' style='display:none'><td class='CaptionTD'></td><td colspan='"+(X*2-1)+"' class='DataTD'><input class='FormElement' id='id_g' type='text' name='id' value='"+L+"'/></td></tr>");ac[0].rp=V+99;b(P).append(ac)}return Z}function o(K,M){var G,N,J=0,I,H,L;L=b(M).jqGrid("getInd",K,true);if(!L){return}b("td",L).each(function(O){G=M.p.colModel[O].name;if(M.p.colModel[O].editrules&&M.p.colModel[O].editrules.edithidden===true){N=false}else{N=M.p.colModel[O].hidden===true?true:false}if(G!=="cb"&&G!=="subgrid"&&G!=="rn"){if(G==M.p.ExpandColumn&&M.p.treeGrid===true){I=b(this).text()}else{I=b(this).html()}H=b.extend({},M.p.colModel[O].editoptions||{});G=b.jgrid.jqID("v_"+G);b("#"+G+" span","#"+u).html(I);if(N){b("#"+G,"#"+u).parents("tr:first").hide()}J++}});if(J>0){b("#id_g","#"+u).val(K)}}function q(G,H){if(G===0){b("#pData","#"+u+"_2").addClass("ui-state-disabled")}else{b("#pData","#"+u+"_2").removeClass("ui-state-disabled")}if(G==H){b("#nData","#"+u+"_2").addClass("ui-state-disabled")}else{b("#nData","#"+u+"_2").removeClass("ui-state-disabled")}}function j(){var H=b(x).jqGrid("getDataIDs"),G=b("#id_g","#"+u).val(),I=b.inArray(G,H);return[I,H]}if(b("#"+k.themodal).html()!==null){if(A){n=A(b("#"+B));if(typeof(n)=="undefined"){n=true}}if(n===false){return}b(".ui-jqdialog-title","#"+k.modalhead).html(d.caption);b("#FormError","#"+u).hide();o(c,x);if(b.isFunction(d.beforeShowForm)){d.beforeShowForm(b("#"+B))}b.jgrid.viewModal("#"+k.themodal,{gbox:"#gbox_"+t,jqm:d.jqModal,jqM:false,overlay:d.overlay,modal:d.modal});l()}else{var z=isNaN(d.dataheight)?d.dataheight:d.dataheight+"px";var D=b("<form name='FormPost' id='"+B+"' class='FormGrid' style='width:100%;overflow:auto;position:relative;height:"+z+";'></form>"),m=b("<table id='"+u+"' class='EditTable' cellspacing='1' cellpadding='2' border='0' style='table-layout:fixed'><tbody></tbody></table>");if(A){n=A(b("#"+B));if(typeof(n)=="undefined"){n=true}}if(n===false){return}b(x.p.colModel).each(function(G){var H=this.formoptions;h=Math.max(h,H?H.colpos||0:0);g=Math.max(g,H?H.rowpos||0:0)});b(D).append(m);p(c,x,m,h);var y=x.p.direction=="rtl"?true:false,F=y?"nData":"pData",f=y?"pData":"nData",v="<a href='javascript:void(0)' id='"+F+"' class='fm-button ui-state-default ui-corner-left'><span class='ui-icon ui-icon-triangle-1-w'></span></a>",w="<a href='javascript:void(0)' id='"+f+"' class='fm-button ui-state-default ui-corner-right'><span class='ui-icon ui-icon-triangle-1-e'></span></a>",E="<a href='javascript:void(0)' id='cData' class='fm-button ui-state-default ui-corner-all'>"+d.bClose+"</a>";if(g>0){var e=[];b.each(b(m)[0].rows,function(G,H){e[G]=H});e.sort(function(H,G){if(H.rp>G.rp){return 1}if(H.rp<G.rp){return -1}return 0});b.each(e,function(G,H){b("tbody",m).append(H)})}d.gbox="#gbox_"+t;var s=false;if(d.closeOnEscape===true){d.closeOnEscape=false;s=true}var C=b("<span></span>").append(D).append("<table border='0' class='EditTable' id='"+u+"_2'><tbody><tr id='Act_Buttons'><td class='navButton' width='"+d.labelswidth+"'>"+(y?w+v:v+w)+"</td><td class='EditButton'>"+E+"</td></tr></tbody></table>");b.jgrid.createModal(k,C,d,"#gview_"+x.p.id,b("#gview_"+x.p.id)[0]);if(y){b("#pData, #nData","#"+u+"_2").css("float","right");b(".EditButton","#"+u+"_2").css("text-align","left")}if(!d.viewPagerButtons){b("#pData, #nData","#"+u+"_2").hide()}C=null;b("#"+k.themodal).keydown(function(G){if(G.which===27){if(s){b.jgrid.hideModal(this,{gb:d.gbox,jqm:d.jqModal,onClose:d.onClose})}return false}if(d.navkeys[0]===true){if(G.which===d.navkeys[1]){b("#pData","#"+u+"_2").trigger("click");return false}if(G.which===d.navkeys[2]){b("#nData","#"+u+"_2").trigger("click");return false}}});d.closeicon=b.extend([true,"left","ui-icon-close"],d.closeicon);if(d.closeicon[0]===true){b("#cData","#"+u+"_2").addClass(d.closeicon[1]=="right"?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+d.closeicon[2]+"'></span>")}if(b.isFunction(d.beforeShowForm)){d.beforeShowForm(b("#"+B))}b.jgrid.viewModal("#"+k.themodal,{gbox:"#gbox_"+t,jqm:d.jqModal,modal:d.modal});b(".fm-button:not(.ui-state-disabled)","#"+u+"_2").hover(function(){b(this).addClass("ui-state-hover")},function(){b(this).removeClass("ui-state-hover")});l();b("#cData","#"+u+"_2").click(function(G){b.jgrid.hideModal("#"+k.themodal,{gb:"#gbox_"+t,jqm:d.jqModal,onClose:d.onClose});return false});b("#nData","#"+u+"_2").click(function(G){b("#FormError","#"+u).hide();var H=j();H[0]=parseInt(H[0],10);if(H[0]!=-1&&H[1][H[0]+1]){if(b.isFunction(d.onclickPgButtons)){d.onclickPgButtons("next",b("#"+B),H[1][H[0]])}o(H[1][H[0]+1],x);b(x).jqGrid("setSelection",H[1][H[0]+1]);if(b.isFunction(d.afterclickPgButtons)){d.afterclickPgButtons("next",b("#"+B),H[1][H[0]+1])}q(H[0]+1,H[1].length-1)}l();return false});b("#pData","#"+u+"_2").click(function(H){b("#FormError","#"+u).hide();var G=j();if(G[0]!=-1&&G[1][G[0]-1]){if(b.isFunction(d.onclickPgButtons)){d.onclickPgButtons("prev",b("#"+B),G[1][G[0]])}o(G[1][G[0]-1],x);b(x).jqGrid("setSelection",G[1][G[0]-1]);if(b.isFunction(d.afterclickPgButtons)){d.afterclickPgButtons("prev",b("#"+B),G[1][G[0]-1])}q(G[0]-1,G[1].length-1)}l();return false})}var r=j();q(r[0],r[1].length-1)})},delGridRow:function(c,d){d=b.extend({top:0,left:0,width:240,height:"auto",dataheight:"auto",modal:false,overlay:30,drag:true,resize:true,url:"",mtype:"POST",reloadAfterSubmit:true,beforeShowForm:null,beforeInitData:null,afterShowForm:null,beforeSubmit:null,onclickSubmit:null,afterSubmit:null,jqModal:true,closeOnEscape:false,delData:{},delicon:[],cancelicon:[],onClose:null,ajaxDelOptions:{},processing:false,serializeDelData:null,useDataProxy:false},b.jgrid.del,d||{});a[b(this)[0].p.id]=d;return this.each(function(){var p=this;if(!p.grid){return}if(!c){return}var q=b.isFunction(a[p.p.id].beforeShowForm),g=b.isFunction(a[p.p.id].afterShowForm),t=b.isFunction(a[p.p.id].beforeInitData)?a[p.p.id].beforeInitData:false,e=p.p.id,f={},l=true,m="DelTbl_"+e,s,r,o,k,h={themodal:"delmod"+e,modalhead:"delhd"+e,modalcontent:"delcnt"+e,scrollelm:m};if(jQuery.isArray(c)){c=c.join()}if(b("#"+h.themodal).html()!==null){if(t){l=t(b("#"+m));if(typeof(l)=="undefined"){l=true}}if(l===false){return}b("#DelData>td","#"+m).text(c);b("#DelError","#"+m).hide();if(a[p.p.id].processing===true){a[p.p.id].processing=false;b("#dData","#"+m).removeClass("ui-state-active")}if(q){a[p.p.id].beforeShowForm(b("#"+m))}b.jgrid.viewModal("#"+h.themodal,{gbox:"#gbox_"+e,jqm:a[p.p.id].jqModal,jqM:false,overlay:a[p.p.id].overlay,modal:a[p.p.id].modal});if(g){a[p.p.id].afterShowForm(b("#"+m))}}else{var u=isNaN(a[p.p.id].dataheight)?a[p.p.id].dataheight:a[p.p.id].dataheight+"px";var n="<div id='"+m+"' class='formdata' style='width:100%;overflow:auto;position:relative;height:"+u+";'>";n+="<table class='DelTable'><tbody>";n+="<tr id='DelError' style='display:none'><td class='ui-state-error'></td></tr>";n+="<tr id='DelData' style='display:none'><td >"+c+"</td></tr>";n+='<tr><td class="delmsg" style="white-space:pre;">'+a[p.p.id].msg+"</td></tr><tr><td >&#160;</td></tr>";n+="</tbody></table></div>";var j="<a href='javascript:void(0)' id='dData' class='fm-button ui-state-default ui-corner-all'>"+d.bSubmit+"</a>",v="<a href='javascript:void(0)' id='eData' class='fm-button ui-state-default ui-corner-all'>"+d.bCancel+"</a>";n+="<table cellspacing='0' cellpadding='0' border='0' class='EditTable' id='"+m+"_2'><tbody><tr><td><hr class='ui-widget-content' style='margin:1px'/></td></tr><tr><td class='DelButton EditButton'>"+j+"&#160;"+v+"</td></tr></tbody></table>";d.gbox="#gbox_"+e;b.jgrid.createModal(h,n,d,"#gview_"+p.p.id,b("#gview_"+p.p.id)[0]);if(t){l=t(b("#"+m));if(typeof(l)=="undefined"){l=true}}if(l===false){return}b(".fm-button","#"+m+"_2").hover(function(){b(this).addClass("ui-state-hover")},function(){b(this).removeClass("ui-state-hover")});d.delicon=b.extend([true,"left","ui-icon-scissors"],a[p.p.id].delicon);d.cancelicon=b.extend([true,"left","ui-icon-cancel"],a[p.p.id].cancelicon);if(d.delicon[0]===true){b("#dData","#"+m+"_2").addClass(d.delicon[1]=="right"?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+d.delicon[2]+"'></span>")}if(d.cancelicon[0]===true){b("#eData","#"+m+"_2").addClass(d.cancelicon[1]=="right"?"fm-button-icon-right":"fm-button-icon-left").append("<span class='ui-icon "+d.cancelicon[2]+"'></span>")}b("#dData","#"+m+"_2").click(function(z){var x=[true,""];f={};var y=b("#DelData>td","#"+m).text();if(b.isFunction(a[p.p.id].onclickSubmit)){f=a[p.p.id].onclickSubmit(a[p.p.id],y)||{}}if(b.isFunction(a[p.p.id].beforeSubmit)){x=a[p.p.id].beforeSubmit(y)}if(x[0]&&!a[p.p.id].processing){a[p.p.id].processing=true;b(this).addClass("ui-state-active");o=p.p.prmNames;s=b.extend({},a[p.p.id].delData,f);k=o.oper;s[k]=o.deloper;r=o.id;s[r]=y;var w=b.extend({url:a[p.p.id].url?a[p.p.id].url:b(p).jqGrid("getGridParam","editurl"),type:a[p.p.id].mtype,data:b.isFunction(a[p.p.id].serializeDelData)?a[p.p.id].serializeDelData(s):s,complete:function(D,B){if(B!="success"){x[0]=false;if(b.isFunction(a[p.p.id].errorTextFormat)){x[1]=a[p.p.id].errorTextFormat(D)}else{x[1]=B+" Status: '"+D.statusText+"'. Error code: "+D.status}}else{if(b.isFunction(a[p.p.id].afterSubmit)){x=a[p.p.id].afterSubmit(D,s)}}if(x[0]===false){b("#DelError>td","#"+m).html(x[1]);b("#DelError","#"+m).show()}else{if(a[p.p.id].reloadAfterSubmit&&p.p.datatype!="local"){b(p).trigger("reloadGrid")}else{var A=[];A=y.split(",");if(p.p.treeGrid===true){try{b(p).jqGrid("delTreeNode",A[0])}catch(E){}}else{for(var C=0;C<A.length;C++){b(p).jqGrid("delRowData",A[C])}}p.p.selrow=null;p.p.selarrrow=[]}if(b.isFunction(a[p.p.id].afterComplete)){setTimeout(function(){a[p.p.id].afterComplete(D,y)},500)}}a[p.p.id].processing=false;b("#dData","#"+m+"_2").removeClass("ui-state-active");if(x[0]){b.jgrid.hideModal("#"+h.themodal,{gb:"#gbox_"+e,jqm:d.jqModal,onClose:a[p.p.id].onClose})}}},b.jgrid.ajaxOptions,a[p.p.id].ajaxDelOptions);if(!w.url&&!a[p.p.id].useDataProxy){if(b.isFunction(p.p.dataProxy)){a[p.p.id].useDataProxy=true}else{x[0]=false;x[1]+=" "+b.jgrid.errors.nourl}}if(x[0]){if(a[p.p.id].useDataProxy){p.p.dataProxy.call(p,w,"del_"+p.p.id)}else{b.ajax(w)}}}if(x[0]===false){b("#DelError>td","#"+m).html(x[1]);b("#DelError","#"+m).show()}return false});b("#eData","#"+m+"_2").click(function(w){b.jgrid.hideModal("#"+h.themodal,{gb:"#gbox_"+e,jqm:a[p.p.id].jqModal,onClose:a[p.p.id].onClose});return false});if(q){a[p.p.id].beforeShowForm(b("#"+m))}b.jgrid.viewModal("#"+h.themodal,{gbox:"#gbox_"+e,jqm:a[p.p.id].jqModal,overlay:a[p.p.id].overlay,modal:a[p.p.id].modal});if(g){a[p.p.id].afterShowForm(b("#"+m))}}if(a[p.p.id].closeOnEscape===true){setTimeout(function(){b(".ui-jqdialog-titlebar-close","#"+h.modalhead).focus()},0)}})},navGrid:function(f,h,e,g,d,c,j){h=b.extend({edit:true,editicon:"ui-icon-pencil",add:true,addicon:"ui-icon-plus",del:true,delicon:"ui-icon-trash",search:true,searchicon:"ui-icon-search",refresh:true,refreshicon:"ui-icon-refresh",refreshstate:"firstpage",view:false,viewicon:"ui-icon-document",position:"left",closeOnEscape:true,beforeRefresh:null,afterRefresh:null,cloneToTop:false},b.jgrid.nav,h||{});return this.each(function(){if(this.nav){return}var k={themodal:"alertmod",modalhead:"alerthd",modalcontent:"alertcnt"},o=this,n,w,q,l;if(!o.grid||typeof f!="string"){return}if(b("#"+k.themodal).html()===null){if(typeof window.innerWidth!="undefined"){n=window.innerWidth;w=window.innerHeight}else{if(typeof document.documentElement!="undefined"&&typeof document.documentElement.clientWidth!="undefined"&&document.documentElement.clientWidth!==0){n=document.documentElement.clientWidth;w=document.documentElement.clientHeight}else{n=1024;w=768}}b.jgrid.createModal(k,"<div>"+h.alerttext+"</div><span tabindex='0'><span tabindex='-1' id='jqg_alrt'></span></span>",{gbox:"#gbox_"+o.p.id,jqModal:true,drag:true,resize:true,caption:h.alertcap,top:w/2-25,left:n/2-100,width:200,height:"auto",closeOnEscape:h.closeOnEscape},"","",true)}var r=1;if(h.cloneToTop&&o.p.toppager){r=2}for(var p=0;p<r;p++){var s,u=b("<table cellspacing='0' cellpadding='0' border='0' class='ui-pg-table navtable' style='float:left;table-layout:auto;'><tbody><tr></tr></tbody></table>"),v="<td class='ui-pg-button ui-state-disabled' style='width:4px;'><span class='ui-separator'></span></td>",m,t;if(p===0){m=f;t=o.p.id;if(m==o.p.toppager){t+="_top";r=1}}else{m=o.p.toppager;t=o.p.id+"_top"}if(o.p.direction=="rtl"){b(u).attr("dir","rtl").css("float","right")}if(h.add){g=g||{};s=b("<td class='ui-pg-button ui-corner-all'></td>");b(s).append("<div class='ui-pg-div'><span class='ui-icon "+h.addicon+"'></span>"+h.addtext+"</div>");b("tr",u).append(s);b(s,u).attr({title:h.addtitle||"",id:g.id||"add_"+t}).click(function(){if(!b(this).hasClass("ui-state-disabled")){if(b.isFunction(h.addfunc)){h.addfunc()}else{b(o).jqGrid("editGridRow","new",g)}}return false}).hover(function(){if(!b(this).hasClass("ui-state-disabled")){b(this).addClass("ui-state-hover")}},function(){b(this).removeClass("ui-state-hover")});s=null}if(h.edit){s=b("<td class='ui-pg-button ui-corner-all'></td>");e=e||{};b(s).append("<div class='ui-pg-div'><span class='ui-icon "+h.editicon+"'></span>"+h.edittext+"</div>");b("tr",u).append(s);b(s,u).attr({title:h.edittitle||"",id:e.id||"edit_"+t}).click(function(){if(!b(this).hasClass("ui-state-disabled")){var x=o.p.selrow;if(x){if(b.isFunction(h.editfunc)){h.editfunc(x)}else{b(o).jqGrid("editGridRow",x,e)}}else{b.jgrid.viewModal("#"+k.themodal,{gbox:"#gbox_"+o.p.id,jqm:true});b("#jqg_alrt").focus()}}return false}).hover(function(){if(!b(this).hasClass("ui-state-disabled")){b(this).addClass("ui-state-hover")}},function(){b(this).removeClass("ui-state-hover")});s=null}if(h.view){s=b("<td class='ui-pg-button ui-corner-all'></td>");j=j||{};b(s).append("<div class='ui-pg-div'><span class='ui-icon "+h.viewicon+"'></span>"+h.viewtext+"</div>");b("tr",u).append(s);b(s,u).attr({title:h.viewtitle||"",id:j.id||"view_"+t}).click(function(){if(!b(this).hasClass("ui-state-disabled")){var x=o.p.selrow;if(x){if(b.isFunction(h.viewfunc)){h.viewfunc(x)}else{b(o).jqGrid("viewGridRow",x,j)}}else{b.jgrid.viewModal("#"+k.themodal,{gbox:"#gbox_"+o.p.id,jqm:true});b("#jqg_alrt").focus()}}return false}).hover(function(){if(!b(this).hasClass("ui-state-disabled")){b(this).addClass("ui-state-hover")}},function(){b(this).removeClass("ui-state-hover")});s=null}if(h.del){s=b("<td class='ui-pg-button ui-corner-all'></td>");d=d||{};b(s).append("<div class='ui-pg-div'><span class='ui-icon "+h.delicon+"'></span>"+h.deltext+"</div>");b("tr",u).append(s);b(s,u).attr({title:h.deltitle||"",id:d.id||"del_"+t}).click(function(){if(!b(this).hasClass("ui-state-disabled")){var x;if(o.p.multiselect){x=o.p.selarrrow;if(x.length===0){x=null}}else{x=o.p.selrow}if(x){if("function"==typeof h.delfunc){h.delfunc(x)}else{b(o).jqGrid("delGridRow",x,d)}}else{b.jgrid.viewModal("#"+k.themodal,{gbox:"#gbox_"+o.p.id,jqm:true});b("#jqg_alrt").focus()}}return false}).hover(function(){if(!b(this).hasClass("ui-state-disabled")){b(this).addClass("ui-state-hover")}},function(){b(this).removeClass("ui-state-hover")});s=null}if(h.add||h.edit||h.del||h.view){b("tr",u).append(v)}if(h.search){s=b("<td class='ui-pg-button ui-corner-all'></td>");c=c||{};b(s).append("<div class='ui-pg-div'><span class='ui-icon "+h.searchicon+"'></span>"+h.searchtext+"</div>");b("tr",u).append(s);b(s,u).attr({title:h.searchtitle||"",id:c.id||"search_"+t}).click(function(){if(!b(this).hasClass("ui-state-disabled")){b(o).jqGrid("searchGrid",c)}return false}).hover(function(){if(!b(this).hasClass("ui-state-disabled")){b(this).addClass("ui-state-hover")}},function(){b(this).removeClass("ui-state-hover")});if(c.showOnLoad&&c.showOnLoad===true){b(s,u).click()}s=null}if(h.refresh){s=b("<td class='ui-pg-button ui-corner-all'></td>");b(s).append("<div class='ui-pg-div'><span class='ui-icon "+h.refreshicon+"'></span>"+h.refreshtext+"</div>");b("tr",u).append(s);b(s,u).attr({title:h.refreshtitle||"",id:"refresh_"+t}).click(function(){if(!b(this).hasClass("ui-state-disabled")){if(b.isFunction(h.beforeRefresh)){h.beforeRefresh()}o.p.search=false;try{var x=o.p.id;o.p.postData.filters="";b("#fbox_"+x).jqFilter("resetFilter");if(b.isFunction(o.clearToolbar)){o.clearToolbar(false)}}catch(y){}switch(h.refreshstate){case"firstpage":b(o).trigger("reloadGrid",[{page:1}]);break;case"current":b(o).trigger("reloadGrid",[{current:true}]);break}if(b.isFunction(h.afterRefresh)){h.afterRefresh()}}return false}).hover(function(){if(!b(this).hasClass("ui-state-disabled")){b(this).addClass("ui-state-hover")}},function(){b(this).removeClass("ui-state-hover")});s=null}l=b(".ui-jqgrid").css("font-size")||"11px";b("body").append("<div id='testpg2' class='ui-jqgrid ui-widget ui-widget-content' style='font-size:"+l+";visibility:hidden;' ></div>");q=b(u).clone().appendTo("#testpg2").width();b("#testpg2").remove();b(m+"_"+h.position,m).append(u);if(o.p._nvtd){if(q>o.p._nvtd[0]){b(m+"_"+h.position,m).width(q);o.p._nvtd[0]=q}o.p._nvtd[1]=q}l=null;q=null;u=null;this.nav=true}})},navButtonAdd:function(c,d){d=b.extend({caption:"newButton",title:"",buttonicon:"ui-icon-newwin",onClickButton:null,position:"last",cursor:"pointer"},d||{});return this.each(function(){if(!this.grid){return}if(c.indexOf("#")!==0){c="#"+c}var e=b(".navtable",c)[0],g=this;if(e){if(d.id&&b("#"+d.id,e).html()!==null){return}var f=b("<td></td>");if(d.buttonicon.toString().toUpperCase()=="NONE"){b(f).addClass("ui-pg-button ui-corner-all").append("<div class='ui-pg-div'>"+d.caption+"</div>")}else{b(f).addClass("ui-pg-button ui-corner-all").append("<div class='ui-pg-div'><span class='ui-icon "+d.buttonicon+"'></span>"+d.caption+"</div>")}if(d.id){b(f).attr("id",d.id)}if(d.position=="first"){if(e.rows[0].cells.length===0){b("tr",e).append(f)}else{b("tr td:eq(0)",e).before(f)}}else{b("tr",e).append(f)}b(f,e).attr("title",d.title||"").click(function(h){if(!b(this).hasClass("ui-state-disabled")){if(b.isFunction(d.onClickButton)){d.onClickButton.call(g,h)}}return false}).hover(function(){if(!b(this).hasClass("ui-state-disabled")){b(this).addClass("ui-state-hover")}},function(){b(this).removeClass("ui-state-hover")})}})},navSeparatorAdd:function(c,d){d=b.extend({sepclass:"ui-separator",sepcontent:""},d||{});return this.each(function(){if(!this.grid){return}if(c.indexOf("#")!==0){c="#"+c}var f=b(".navtable",c)[0];if(f){var e="<td class='ui-pg-button ui-state-disabled' style='width:4px;'><span class='"+d.sepclass+"'></span>"+d.sepcontent+"</td>";b("tr",f).append(e)}})},GridToForm:function(c,d){return this.each(function(){var g=this;if(!g.grid){return}var f=b(g).jqGrid("getRowData",c);if(f){for(var e in f){if(b("[name="+b.jgrid.jqID(e)+"]",d).is("input:radio")||b("[name="+b.jgrid.jqID(e)+"]",d).is("input:checkbox")){b("[name="+b.jgrid.jqID(e)+"]",d).each(function(){if(b(this).val()==f[e]){b(this).attr("checked","checked")}else{b(this).attr("checked","")}})}else{b("[name="+b.jgrid.jqID(e)+"]",d).val(f[e])}}}})},FormToGrid:function(d,e,f,c){return this.each(function(){var j=this;if(!j.grid){return}if(!f){f="set"}if(!c){c="first"}var g=b(e).serializeArray();var h={};b.each(g,function(k,l){h[l.name]=l.value});if(f=="add"){b(j).jqGrid("addRowData",d,h,c)}else{if(f=="set"){b(j).jqGrid("setRowData",d,h)}}})}})})(jQuery);