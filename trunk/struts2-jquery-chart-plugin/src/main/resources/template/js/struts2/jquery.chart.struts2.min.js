/*
 * jquery.chart.struts2.js
 *
 * Integration of charts with struts 2
 *
 * Requires use of jquery.struts2.js
 *
 * Copyright (c) 2010 Johannes Geppert http://www.jgeppert.com
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 */
(function(a){a.struts2_jquery_chart={debugPrefix:"[struts2_jquery_chart] ",charts:[],chart:function(d,f){var c=this;c.require("js/flot/jquery.flot.js");var b=[];c.charts[f.id]=[];a.each(f.data,function(g,h){if(h.href){h.plot=f;h.plot.data=null;b.push(h)}else{c.charts[f.id].push(h)}});a.plot(d,c.charts[f.id],f);var e="_s2j_chart_topic";a.each(b,function(h,j){var g=e+h;c.subscribeTopics(d,g,"_s2j_chart",j);d.publish(g,j)})}};a.extend(a.struts2_jquery_chart,a.struts2_jquery);a.subscribeHandler("_s2j_chart",function(b,e){var d=a.struts2_jquery;var i=a(b.target);var g={};if(e){a.extend(g,e)}if(b.data){a.extend(g,b.data)}var h=g.indicatorid;d.showIndicator(h);d.publishTopic(i,g.onalw,g);d.publishTopic(i,g.onbef,g);var f={};f.complete=d.pubCom(b.target,g.onalw,g.oncom,g.targets,h,g);f.error=d.pubErr(b.target,g.onalw,g.onerr,g.errortext,"html");f.success=function(p,k,n){var o={};o.data=p;o.status=k;o.request=n;var j=0;if(p[g.list]!==null){var m=false;if(!a.isArray(p[g.list])){m=true}var c=[];a.each(p[g.list],function(r,u){if(m){var s=[];s.push(r);s.push(u);c.push(s)}else{if(g.listkey!==undefined&&g.listvalue!==undefined){var q=[];q.push(u[g.listkey]);q.push(u[g.listvalue]);c.push(q)}else{var t=[];t.push(p[g.list][j]);t.push(p[g.list][j]);c.push(t)}}j++});g.data=c;var l=g.plot;g.data=c;g.plot=null;a.struts2_jquery_chart.charts[l.id].push(g);a.plot(i,a.struts2_jquery_chart.charts[l.id],l)}if(g.onsuc){d.publishTopic(i,g.onsuc,o);d.publishTopic(i,g.onalw,o)}};if(g.href){f.url=g.href;f.data="";if(g.hrefparameter){f.data=g.hrefparameter}if(g.requesttype){f.type=g.requesttype}else{f.type="POST"}if(g.formids&&f.data===""){if(!d.loadAtOnce){d.require("js/plugins/jquery.form"+d.minSuffix+".js")}a.each(g.formids.split(","),function(c,k){var j=a(d.escId(k)).formSerialize();if(f.data!==""){f.data=f.data+"&"+j}else{f.data=j}})}f.dataType="json";if(!f.data){f.data={}}g.options=f;d.publishTopic(i,g.onalw,g);d.publishTopic(i,g.onbef,g);a.ajax(f)}})})(jQuery);