/*
 * jquery.richtext.struts2.min.js
 *
 * Integration of richtext editor with struts 2 
 *
 * Requires use of jquery.struts2.js
 *
 * Copyright (c) 2010 Johannes Geppert http://www.jgeppert.com
 *
 * Dual licensed under the MIT licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 */
(function(a){a.struts2_jquery_richtext={debugPrefix:"[struts2_jquery_richtext] ",editors:[],editorsTinymce:[],clean:function(c){var b=this;if(!window.CKEDITOR){return}a.each(b.editors,function(d,e){var f=CKEDITOR.instances[e];if(c.length===0||!f||f.textarea!=c[0]){a.struts2_jquery_richtext.editors.splice(d);delete CKEDITOR.instances[e]}})},ckeditor:function(c,g){var b=this;b.log("ckeditor for : "+g.id);b.require("js/ckeditor/ckeditor.js");b.require("js/ckeditor/adapters/jquery.js");var f=CKEDITOR.instances[g.id];if(f){CKEDITOR.remove(f)}b.clean(c);var e=function(){b.editors[b.editors.length]=g.id;if(g.onEditorReadyTopics){var h={};b.publishTopic(c,g.onEditorReadyTopics,h);b.publishTopic(c,g.onalw,h)}};if(g.editorLocal){g.language=g.editorLocal}else{g.language=b.local}if(g.href&&g.href!="#"){var d="s2j_ckeditor_"+g.id;if(c.isSubscribed(d)){c.unsubscribe(d)}c.subscribe(d,function(h,i){c.ckeditor(e,g)});if(g.oncom&&g.oncom!=""){g.oncom=g.oncom+","+d}else{g.oncom=d}b.container(c,g)}else{b.container(c,g);c.ckeditor(e,g)}if(g.onblurtopics){CKEDITOR.instances[g.id].on("blur",function(){b.publishTopic(c,g.onblurtopics,{});b.publishTopic(c,g.onalw,{})})}if(g.onfocustopics){CKEDITOR.instances[g.id].on("focus",function(){b.publishTopic(c,g.onfocustopics,{});b.publishTopic(c,g.onalw,{})})}},tinymce:function(c,f){var b=this;b.log("tinymce for : "+f.id);b.require("js/tinymce/jquery.tinymce.js");if(a.struts2_jquery_richtext.editorsTinymce.length>0&&tinyMCE.get(f.id)){var e=tinyMCE.get(f.id);if(e!==undefined){b.log("cleanup tinymce : "+f.id)}}b.editorsTinymce[a.struts2_jquery_richtext.editorsTinymce.length]=f.id;f.resizable=false;if(f.editorResizable){f.theme_advanced_resizing=true}b.container(c,f);f.script_url=f.path+"tiny_mce.js";f.setup=function(g){g.onInit.add(function(h){tinyMCE.execCommand("mceRepaint")});g.onSaveContent.add(function(i,h){if(f.onsavetopics){var j={};j.editor=i;j.content=h.content;b.publishTopic(c,f.onsavetopics,j);b.publishTopic(c,f.onalw,j)}return false});g.onChange.add(function(i,h){if(f.onchangetopics){var j={};j.editor=i;j.content=h.content;b.publishTopic(c,f.oncha,j);b.publishTopic(c,f.onalw,j)}})};if(f.editorLocal){f.language=f.editorLocal}else{f.language=b.local}if(f.href&&f.href!="#"){var d="s2j_tinymce_"+f.id;if(c.isSubscribed(d)){c.unsubscribe(d)}c.subscribe(d,function(g,h){c.tinymce(f);a.each(f.formids.split(","),function(j,k){b.log("bind tinymce to form : "+k);a(b.escId(k)).bind("form-pre-serialize",function(i){tinyMCE.triggerSave()})})});if(f.oncom&&f.oncom!=""){f.oncom=d}else{f.oncom=d}b.container(c,f)}else{b.container(c,f);c.tinymce(f);a.each(f.formids.split(","),function(g,h){b.log("bind tinymce to form : "+h);a(b.escId(h)).bind("form-pre-serialize",function(i){tinyMCE.triggerSave()})})}}};a.extend(a.struts2_jquery_richtext,a.struts2_jquery)})(jQuery);