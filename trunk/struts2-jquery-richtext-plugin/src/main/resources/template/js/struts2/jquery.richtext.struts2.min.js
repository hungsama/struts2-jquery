/*
 * jquery.richtext.struts2.min.js
 *
 * Integration of richtext editor with struts 2 
 *
 * Requires use of jquery.struts2.js
 *
 * Copyright (c) 2010 Johannes Geppert http://www.jgeppert.com
 *
 * Dual licensed under the MIT licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 */
(function(a){a.struts2_jquery_richtext={debugPrefix:"[struts2_jquery_richtext] ",editors:[],editorsTinymce:[],clean:function(c){var b=this;if(!window.CKEDITOR){return}a.each(b.editors,function(d,e){var f=CKEDITOR.instances[e];if(c.length===0||!f||f.textarea!=c[0]){a.struts2_jquery_richtext.editors.splice(d);delete CKEDITOR.instances[e]}})},ckeditor:function(c,g){var b=this;b.log("ckeditor for : "+g.id);b.require("js/ckeditor/ckeditor.js");b.require("js/ckeditor/adapters/jquery.js");var f=CKEDITOR.instances[g.id];if(f){CKEDITOR.remove(f)}b.clean(c);var e=function(){b.editors[b.editors.length]=g.id;if(g.onEditorReadyTopics){var h={};b.publishTopic(c,g.onEditorReadyTopics,h);b.publishTopic(c,g.onalw,h)}};if(g.editorLocal){g.language=g.editorLocal}else{g.language=b.local}if(g.href&&g.href!="#"){var d="s2j_ckeditor_"+g.id;if(c.isSubscribed(d)){c.unsubscribe(d)}c.subscribe(d,function(h,i){c.ckeditor(e,g)});if(g.oncom&&g.oncom!=""){g.oncom=g.oncom+","+d}else{g.oncom=d}b.container(c,g)}else{b.container(c,g);c.ckeditor(e,g)}if(g.onblurtopics){CKEDITOR.instances[g.id].on("blur",function(){b.publishTopic(c,g.onblurtopics,{});b.publishTopic(c,g.onalw,{})})}if(g.onfocustopics){CKEDITOR.instances[g.id].on("focus",function(){b.publishTopic(c,g.onfocustopics,{});b.publishTopic(c,g.onalw,{})})}},tinymce:function(c,e){var b=this;b.log("tinymce for : "+e.id);b.require("js/tinymce/jquery.tinymce.js");e.resizable=false;if(e.editorResizable){e.theme_advanced_resizing=true}b.container(c,e);e.script_url=e.path+"tiny_mce.js";e.setup=function(f){f.onInit.add(function(g){tinyMCE.execCommand("mceRepaint")});f.onSaveContent.add(function(h,g){if(e.onsavetopics){var i={};i.editor=h;i.content=g.content;b.publishTopic(c,e.onsavetopics,i);b.publishTopic(c,e.onalw,i)}return false});f.onChange.add(function(h,g){if(e.onchangetopics){var i={};i.editor=h;i.content=g.content;b.publishTopic(c,e.oncha,i);b.publishTopic(c,e.onalw,i)}})};if(e.editorLocal){e.language=e.editorLocal}else{e.language=b.local}if(e.href&&e.href!="#"){var d="s2j_tinymce_"+e.id;if(c.isSubscribed(d)){c.unsubscribe(d)}c.subscribe(d,function(f,g){c.tinymce(e);a.each(e.formids.split(","),function(h,j){b.log("bind tinymce to form : "+j);a(b.escId(j)).bind("form-pre-serialize",function(i){tinyMCE.triggerSave()})})});if(e.oncom&&e.oncom!=""){e.oncom=d}else{e.oncom=d}b.container(c,e)}else{b.container(c,e);c.tinymce(e);a.each(e.formids.split(","),function(f,g){b.log("bind tinymce to form : "+g);a(b.escId(g)).bind("form-pre-serialize",function(h){tinyMCE.triggerSave()})})}}};a.extend(a.struts2_jquery_richtext,a.struts2_jquery)})(jQuery);