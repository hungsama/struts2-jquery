/*
 * jquery.richtext.struts2.min.js
 *
 * Integration of richtext editor with struts 2 
 *
 * Requires use of jquery.struts2.js
 *
 * Copyright (c) 2010 Johannes Geppert http://www.jgeppert.com
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 */
(function(a){a.struts2_jquery_richtext={editors:[],clean:function(b){if(!window.CKEDITOR){return}a.each(this.editors,function(c,d){var e=CKEDITOR.instances[d];if(b.length===0||!e||e.textarea!=b[0]){a.struts2_jquery_richtext.editors.splice(c);delete CKEDITOR.instances[d]}})},ckeditor:function(b,f){this.log("ckeditor for : "+f.id);this.require("js/ckeditor/ckeditor.js");this.require("js/ckeditor/adapters/jquery.js");var e=CKEDITOR.instances[f.id];if(e){CKEDITOR.remove(e)}this.clean(b);var d=function(){a.struts2_jquery_richtext.editors[a.struts2_jquery_richtext.editors.length]=f.id;if(f.onEditorReadyTopics){var g={};a.struts2_jquery.publishTopic(b,f.onEditorReadyTopics,g);a.struts2_jquery.publishTopic(b,f.onalwaystopics,g)}};if(f.editorLocal){f.language=f.editorLocal}else{f.language=this.local}if(f.href&&f.href!="#"){var c="s2j_ckeditor_"+f.id;if(b.isSubscribed(c)){b.unsubscribe(c)}b.subscribe(c,function(g,h){b.ckeditor(d,f)});if(f.oncompletetopics&&f.oncompletetopics!=""){f.oncompletetopics=c}else{f.oncompletetopics=c}this.container(b,f)}else{this.container(b,f);b.ckeditor(d,f)}if(f.onblurtopics){CKEDITOR.instances[f.id].on("blur",function(){a.struts2_jquery.publishTopic(b,f.onblurtopics,{});a.struts2_jquery.publishTopic(b,f.onalwaystopics,{})})}if(f.onfocustopics){CKEDITOR.instances[f.id].on("focus",function(){a.struts2_jquery.publishTopic(b,f.onfocustopics,{});a.struts2_jquery.publishTopic(b,f.onalwaystopics,{})})}},tinymce:function(b,d){this.log("tinymce for : "+d.id);this.require("js/tinymce/jquery.tinymce.js");this.container(b,d);d.script_url=d.path+"tiny_mce.js";d.resizable=false;if(d.editorLocal){d.language=d.editorLocal}else{d.language=this.local}if(d.href&&d.href!="#"){var c="s2j_tinymce_"+d.id;if(b.isSubscribed(c)){b.unsubscribe(c)}b.subscribe(c,function(e,f){if(d.editorResizable){d.theme_advanced_resizing=true}b.tinymce(d);a.each(d.formids.split(","),function(g,h){a.struts2_jquery.log("bind tinymce to form : "+h);a(a.struts2_jquery.escId(h)).bind("form-pre-serialize",function(i){tinyMCE.triggerSave()})})});if(d.oncompletetopics&&d.oncompletetopics!=""){d.oncompletetopics=c}else{d.oncompletetopics=c}this.container(b,d)}else{this.container(b,d);b.tinymce(d);a.each(d.formids.split(","),function(e,f){a.struts2_jquery.log("bind tinymce to form : "+f);a(a.struts2_jquery.escId(f)).bind("form-pre-serialize",function(g){tinyMCE.triggerSave()})})}}};a.extend(a.struts2_jquery_richtext,a.struts2_jquery)})(jQuery);