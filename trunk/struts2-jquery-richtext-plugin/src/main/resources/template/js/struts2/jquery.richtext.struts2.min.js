/*
 * jquery.richtext.struts2.min.js
 *
 * Integration of richtext editor with struts 2 
 *
 * Requires use of jquery.struts2.js
 *
 * Copyright (c) 2010 Johannes Geppert http://www.jgeppert.com
 *
 * Dual licensed under the MIT licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 */
(function(a){a.struts2_jquery_richtext={editors:[],editorsTinymce:[],clean:function(b){if(!window.CKEDITOR){return}a.each(this.editors,function(c,d){var e=CKEDITOR.instances[d];if(b.length===0||!e||e.textarea!=b[0]){a.struts2_jquery_richtext.editors.splice(c);delete CKEDITOR.instances[d]}})},ckeditor:function(b,f){this.log("ckeditor for : "+f.id);this.require("js/ckeditor/ckeditor.js");this.require("js/ckeditor/adapters/jquery.js");var e=CKEDITOR.instances[f.id];if(e){CKEDITOR.remove(e)}this.clean(b);var d=function(){a.struts2_jquery_richtext.editors[a.struts2_jquery_richtext.editors.length]=f.id;if(f.onEditorReadyTopics){var g={};a.struts2_jquery.publishTopic(b,f.onEditorReadyTopics,g);a.struts2_jquery.publishTopic(b,f.onalw,g)}};if(f.editorLocal){f.language=f.editorLocal}else{f.language=this.local}if(f.href&&f.href!="#"){var c="s2j_ckeditor_"+f.id;if(b.isSubscribed(c)){b.unsubscribe(c)}b.subscribe(c,function(g,h){b.ckeditor(d,f)});if(f.oncom&&f.oncom!=""){f.oncom=f.oncom+","+c}else{f.oncom=c}this.container(b,f)}else{this.container(b,f);b.ckeditor(d,f)}if(f.onblurtopics){CKEDITOR.instances[f.id].on("blur",function(){a.struts2_jquery.publishTopic(b,f.onblurtopics,{});a.struts2_jquery.publishTopic(b,f.onalw,{})})}if(f.onfocustopics){CKEDITOR.instances[f.id].on("focus",function(){a.struts2_jquery.publishTopic(b,f.onfocustopics,{});a.struts2_jquery.publishTopic(b,f.onalw,{})})}},tinymce:function(b,e){this.log("tinymce for : "+e.id);this.require("js/tinymce/jquery.tinymce.js");if(a.struts2_jquery_richtext.editorsTinymce.length>0&&tinyMCE.get(e.id)){var d=tinyMCE.get(e.id);if(d!==undefined){this.log("cleanup tinymce : "+e.id)}}a.struts2_jquery_richtext.editorsTinymce[a.struts2_jquery_richtext.editorsTinymce.length]=e.id;e.resizable=false;if(e.editorResizable){e.theme_advanced_resizing=true}alert("editorResizable : "+e.editorResizable+" o.theme_advanced_resizing : "+e.theme_advanced_resizing);this.container(b,e);e.script_url=e.path+"tiny_mce.js";e.setup=function(f){f.onInit.add(function(g){tinyMCE.execCommand("mceRepaint")});f.onSaveContent.add(function(h,g){if(e.onsavetopics){var i={};i.editor=h;i.content=g.content;a.struts2_jquery.publishTopic(b,e.onsavetopics,i);a.struts2_jquery.publishTopic(b,e.onalw,i)}return false});f.onChange.add(function(h,g){if(e.onchangetopics){var i={};i.editor=h;i.content=g.content;a.struts2_jquery.publishTopic(b,e.oncha,i);a.struts2_jquery.publishTopic(b,e.onalw,i)}})};if(e.editorLocal){e.language=e.editorLocal}else{e.language=this.local}if(e.href&&e.href!="#"){var c="s2j_tinymce_"+e.id;if(b.isSubscribed(c)){b.unsubscribe(c)}b.subscribe(c,function(f,g){b.tinymce(e);a.each(e.formids.split(","),function(h,j){a.struts2_jquery.log("bind tinymce to form : "+j);a(a.struts2_jquery.escId(j)).bind("form-pre-serialize",function(i){tinyMCE.triggerSave()})})});if(e.oncom&&e.oncom!=""){e.oncom=c}else{e.oncom=c}this.container(b,e)}else{this.container(b,e);b.tinymce(e);a.each(e.formids.split(","),function(f,g){a.struts2_jquery.log("bind tinymce to form : "+g);a(a.struts2_jquery.escId(g)).bind("form-pre-serialize",function(h){tinyMCE.triggerSave()})})}}};a.extend(a.struts2_jquery_richtext,a.struts2_jquery)})(jQuery);