(function(b){function c(f){var j=null,H=0,l=0,d=null,B=null,q=null,m=null,A=0,i=true,D=10,w=0.95,z=0,n=false,J=false,s=null;var G=[];f.hooks.processOptions.push(C);f.hooks.bindEvents.push(L);function C(O,N){if(N.series.pie.show){N.grid.show=false;if(N.series.pie.label.show=="auto"){if(N.legend.show){N.series.pie.label.show=false}else{N.series.pie.label.show=true}}if(N.series.pie.radius=="auto"){if(N.series.pie.label.show){N.series.pie.radius=3/4}else{N.series.pie.radius=1}}if(N.series.pie.tilt>1){N.series.pie.tilt=1}else{if(N.series.pie.tilt<0){N.series.pie.tilt=0}}O.hooks.processDatapoints.push(p);O.hooks.drawOverlay.push(E);O.hooks.draw.push(M)}}function L(P,N){var O=P.getOptions();if(O.series.pie.show){if(O.grid.hoverable){N.unbind("mousemove").mousemove(e)}if(O.grid.clickable){N.unbind("click").click(t)}}}function o(O){var P="";function N(S,T){if(!T){T=0}for(var R=0;R<S.length;++R){for(var Q=0;Q<T;Q++){P+="\t"}if(typeof S[R]=="object"){P+=""+R+":\n";N(S[R],T+1)}else{P+=""+R+": "+S[R]+"\n"}}}N(O);alert(P)}function v(P){for(var N=0;N<P.length;++N){var O=parseFloat(P[N].data[0][1]);if(O){A+=O}}}function p(Q,N,O,P){if(!n){n=true;j=Q.getCanvas();d=b(j).parent();a=Q.getOptions();H=Q.getPlaceholder().width();l=Q.getPlaceholder().height();Q.setData(F(Q.getData()))}}function u(){z=d.children().filter(".legend").children().width()||0;B=Math.min(H,l/a.series.pie.tilt)/2;m=l/2+a.series.pie.offset.top;q=H/2;if(a.series.pie.offset.left=="auto"){if(a.legend.position.match("w")){q+=z/2}else{q-=z/2}}else{q+=a.series.pie.offset.left}if(q<B){q=B}else{if(q>H-B){q=H-B}}}function r(O){for(var N=0;N<O.length;++N){if(typeof(O[N].data)=="number"){O[N].data=[[1,O[N].data]]}else{if(typeof(O[N].data)=="undefined"||typeof(O[N].data[0])=="undefined"){if(typeof(O[N].data)!="undefined"&&typeof(O[N].data.label)!="undefined"){O[N].label=O[N].data.label}O[N].data=[[1,0]]}}}return O}function F(Q){Q=r(Q);v(Q);var P=0;var S=0;var N=a.series.pie.combine.color;var R=[];for(var O=0;O<Q.length;++O){Q[O].data[0][1]=parseFloat(Q[O].data[0][1]);if(!Q[O].data[0][1]){Q[O].data[0][1]=0}if(Q[O].data[0][1]/A<=a.series.pie.combine.threshold){P+=Q[O].data[0][1];S++;if(!N){N=Q[O].color}}else{R.push({data:[[1,Q[O].data[0][1]]],color:Q[O].color,label:Q[O].label,angle:Q[O].data[0][1]*Math.PI*2/A,percent:Q[O].data[0][1]/A*100})}}if(S>0){R.push({data:[[1,P]],color:N,label:a.series.pie.combine.label,angle:P*Math.PI*2/A,percent:P/A*100})}return R}function M(S,Q){if(!d){return}s=Q;u();var T=S.getData();var P=0;while(i&&P<D){i=false;if(P>0){B*=w}P+=1;N();if(a.series.pie.tilt<=0.8){O()}R()}if(P>=D){N();d.prepend("<div class='error'>Could not draw pie with labels contained inside canvas</div>")}if(S.setSeries&&S.insertLegend){S.setSeries(T);S.insertLegend()}function N(){s.clearRect(0,0,H,l);d.children().filter(".pieLabel, .pieLabelBackground").remove()}function O(){var Z=a.series.pie.shadow.left;var Y=a.series.pie.shadow.top;var W=10;var X=a.series.pie.shadow.alpha;var U=a.series.pie.radius>1?a.series.pie.radius:B*a.series.pie.radius;if(U>=H/2-Z||U*a.series.pie.tilt>=l/2-Y||U<=W){return}s.save();s.translate(Z,Y);s.globalAlpha=X;s.fillStyle="#000";s.translate(q,m);s.scale(1,a.series.pie.tilt);for(var V=1;V<=W;V++){s.beginPath();s.arc(0,0,U,0,Math.PI*2,false);s.fill();U-=V}s.restore()}function R(){var X=Math.PI*a.series.pie.startAngle;var U=a.series.pie.radius>1?a.series.pie.radius:B*a.series.pie.radius;s.save();s.translate(q,m);s.scale(1,a.series.pie.tilt);s.save();var Z=X;for(var W=0;W<T.length;++W){T[W].startAngle=Z;Y(T[W].angle,T[W].color,true)}s.restore();if(a.series.pie.stroke.width>0){s.save();s.lineWidth=a.series.pie.stroke.width;Z=X;for(var W=0;W<T.length;++W){Y(T[W].angle,a.series.pie.stroke.color,false)}s.restore()}y(s);if(a.series.pie.label.show){V()}s.restore();function Y(ac,aa,ab){if(ac<=0||isNaN(ac)){return}if(ab){s.fillStyle=aa}else{s.strokeStyle=aa;s.lineJoin="round"}s.beginPath();if(Math.abs(ac-Math.PI*2)>1e-9){s.moveTo(0,0)}else{if(b.browser.msie){ac-=0.0001}}s.arc(0,0,U,Z,Z+ac/2,false);s.arc(0,0,U,Z+ac/2,Z+ac,false);s.closePath();Z+=ac;if(ab){s.fill()}else{s.stroke()}}function V(){var ad=X;var aa=a.series.pie.label.radius>1?a.series.pie.label.radius:B*a.series.pie.label.radius;for(var ac=0;ac<T.length;++ac){if(T[ac].percent>=a.series.pie.label.threshold*100){ab(T[ac],ad,ac)}ad+=T[ac].angle}function ab(aq,aj,ah){if(aq.data[0][1]==0){return}var at=a.legend.labelFormatter,ar,af=a.series.pie.label.formatter;if(at){ar=at(aq.label,aq)}else{ar=aq.label}if(af){ar=af(ar,aq)}var ak=((aj+aq.angle)+aj)/2;var ap=q+Math.round(Math.cos(ak)*aa);var an=m+Math.round(Math.sin(ak)*aa)*a.series.pie.tilt;var ag="<span class='pieLabel' id='pieLabel"+ah+"' style='position:absolute;top:"+an+"px;left:"+ap+"px;'>"+ar+"</span>";d.append(ag);var ao=d.children("#pieLabel"+ah);var ae=(an-ao.height()/2);var ai=(ap-ao.width()/2);ao.css("top",ae);ao.css("left",ai);if(0-ae>0||0-ai>0||l-(ae+ao.height())<0||H-(ai+ao.width())<0){i=true}if(a.series.pie.label.background.opacity!=0){var al=a.series.pie.label.background.color;if(al==null){al=aq.color}var am="top:"+ae+"px;left:"+ai+"px;";b("<div class='pieLabelBackground' style='position:absolute;width:"+ao.width()+"px;height:"+ao.height()+"px;"+am+"background-color:"+al+";'></div>").css("opacity",a.series.pie.label.background.opacity).insertBefore(ao)}}}}}function y(N){if(a.series.pie.innerRadius>0){N.save();var O=a.series.pie.innerRadius>1?a.series.pie.innerRadius:B*a.series.pie.innerRadius;N.globalCompositeOperation="destination-out";N.beginPath();N.fillStyle=a.series.pie.stroke.color;N.arc(0,0,O,0,Math.PI*2,false);N.fill();N.closePath();N.restore();N.save();N.beginPath();N.strokeStyle=a.series.pie.stroke.color;N.arc(0,0,O,0,Math.PI*2,false);N.stroke();N.closePath();N.restore()}}function k(Q,R){for(var S=false,P=-1,N=Q.length,O=N-1;++P<N;O=P){((Q[P][1]<=R[1]&&R[1]<Q[O][1])||(Q[O][1]<=R[1]&&R[1]<Q[P][1]))&&(R[0]<(Q[O][0]-Q[P][0])*(R[1]-Q[P][1])/(Q[O][1]-Q[P][1])+Q[P][0])&&(S=!S)}return S}function g(V,U){var P=f.getData(),S=f.getOptions(),T=S.series.pie.radius>1?S.series.pie.radius:B*S.series.pie.radius,Y,W;for(var af=0;af<P.length;++af){var ab=P[af];if(ab.pie.show){s.save();s.beginPath();s.moveTo(0,0);s.arc(0,0,T,ab.startAngle,ab.startAngle+ab.angle/2,false);s.arc(0,0,T,ab.startAngle+ab.angle/2,ab.startAngle+ab.angle,false);s.closePath();Y=V-q;W=U-m;if(s.isPointInPath){if(s.isPointInPath(V-q,U-m)){s.restore();return{datapoint:[ab.percent,ab.data],dataIndex:0,series:ab,seriesIndex:af}}}else{var ae=T*Math.cos(ab.startAngle),ad=T*Math.sin(ab.startAngle),Q=T*Math.cos(ab.startAngle+ab.angle/4),N=T*Math.sin(ab.startAngle+ab.angle/4),Z=T*Math.cos(ab.startAngle+ab.angle/2),X=T*Math.sin(ab.startAngle+ab.angle/2),ah=T*Math.cos(ab.startAngle+ab.angle/1.5),ag=T*Math.sin(ab.startAngle+ab.angle/1.5),R=T*Math.cos(ab.startAngle+ab.angle),O=T*Math.sin(ab.startAngle+ab.angle),ac=[[0,0],[ae,ad],[Q,N],[Z,X],[ah,ag],[R,O]],aa=[Y,W];if(k(ac,aa)){s.restore();return{datapoint:[ab.percent,ab.data],dataIndex:0,series:ab,seriesIndex:af}}}s.restore()}}return null}function e(N){h("plothover",N)}function t(N){h("plotclick",N)}function h(N,T){var O=f.offset();var R=parseInt(T.pageX-O.left);var P=parseInt(T.pageY-O.top);var V=g(R,P);if(a.grid.autoHighlight){for(var Q=0;Q<G.length;++Q){var S=G[Q];if(S.auto==N&&!(V&&S.series==V.series)){I(S.series)}}}if(V){K(V.series,N)}var U={pageX:T.pageX,pageY:T.pageY};d.trigger(N,[U,V])}function K(O,P){var N=x(O);if(N==-1){G.push({series:O,auto:P});f.triggerRedrawOverlay()}else{if(!P){G[N].auto=false}}}function I(O){if(O==null){G=[];f.triggerRedrawOverlay()}var N=x(O);if(N!=-1){G.splice(N,1);f.triggerRedrawOverlay()}}function x(P){for(var N=0;N<G.length;++N){var O=G[N];if(O.series==P){return N}}return -1}function E(R,S){var P=R.getOptions();var N=P.series.pie.radius>1?P.series.pie.radius:B*P.series.pie.radius;S.save();S.translate(q,m);S.scale(1,P.series.pie.tilt);for(var Q=0;Q<G.length;++Q){O(G[Q].series)}y(S);S.restore();function O(T){if(T.angle<=0||isNaN(T.angle)){return}S.fillStyle="rgba(255, 255, 255, "+P.series.pie.highlight.opacity+")";S.beginPath();if(Math.abs(T.angle-Math.PI*2)>1e-9){S.moveTo(0,0)}S.arc(0,0,N,T.startAngle,T.startAngle+T.angle/2,false);S.arc(0,0,N,T.startAngle+T.angle/2,T.startAngle+T.angle,false);S.closePath();S.fill()}}}var a={series:{pie:{show:false,radius:"auto",innerRadius:0,startAngle:3/2,tilt:1,shadow:{left:5,top:15,alpha:0.02},offset:{top:0,left:"auto"},stroke:{color:"#fff",width:1},label:{show:"auto",formatter:function(d,e){return"<div style='font-size:x-small;text-align:center;padding:2px;color:"+e.color+";'>"+d+"<br/>"+Math.round(e.percent)+"%</div>"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{opacity:0.5}}}};b.plot.plugins.push({init:c,options:a,name:"pie",version:"1.1"})})(jQuery);