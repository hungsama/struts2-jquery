/*!
 * jquery.chart.struts2.js
 *
 * Integration of charts with struts 2
 *
 * Requires use of jquery.struts2.js
 *
 * Copyright (c) 2010 Johannes Geppert http://www.jgeppert.com
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 */
(function(a){a.struts2_jquery_chart={debugPrefix:"[struts2_jquery_chart] ",charts:[],chart:function(d,g){var c=this;if(a.browser.msie){c.require("js/flot/excanvas"+c.minSuffix+".js")}c.require("js/flot/jquery.flot"+c.minSuffix+".js");if(g.crosshair){c.require("js/flot/jquery.flot.crosshair"+c.minSuffix+".js")}if(g.series&&g.series.pie){c.require("js/flot/jquery.flot.pie"+c.minSuffix+".js")}var b=[];c.charts[g.id]=[];a.each(g.data,function(h,j){if(j.href){j.plot=g;j.plot.data=null;b.push(j)}else{c.charts[g.id].push(j)}});if(g.onclick||g.onhover){g.grid={};if(g.onclick){g.grid.clickable=true}if(g.onhover){g.grid.hoverable=true}}var f=a.plot(d,c.charts[g.id],g);if(g.onclick){d.bind("plotclick",function(i,k,h){var j={};j.plot=f;j.event=i;j.pos=k;j.item=h;c.publishTopic(d,g.onclick,j)})}if(g.onhover){d.bind("plothover",function(i,k,h){var j={};j.plot=f;j.event=i;j.pos=k;j.item=h;c.publishTopic(d,g.onhover,j)})}var e="_s2j_chart_topic";a.each(b,function(j,k){var h=e+j;c.subscribeTopics(d,h,"_s2j_chart",k);c.subscribeTopics(d,k.reloadtopics,"_s2j_chart",k);c.subscribeTopics(d,k.listentopics,"_s2j_chart",k);if(!k.deferredloading){d.publish(h,k)}})}};a.extend(a.struts2_jquery_chart,a.struts2_jquery);a.subscribeHandler("_s2j_chart",function(b,e){var d=a.struts2_jquery;var i=a(b.target);var g={};if(e){a.extend(g,e)}if(b.data){a.extend(g,b.data)}var h=g.indicatorid;d.showIndicator(h);d.publishTopic(i,g.onalw,g);d.publishTopic(i,g.onbef,g);var f={};f.complete=d.pubCom(b.target,g.onalw,g.oncom,g.targets,h,g);f.error=d.pubErr(b.target,g.onalw,g.onerr,g.errortext,"html");f.success=function(l,k,j){var c={};c.data=l;c.status=k;c.request=j;var n=0;if(l[g.list]!==null){var p=false;if(!a.isArray(l[g.list])){p=true}var q=[];a.each(l[g.list],function(s,v){if(p){var t=[];t.push(s);t.push(v);q.push(t)}else{if(g.listkey!==undefined&&g.listvalue!==undefined){var r=[];r.push(v[g.listkey]);r.push(v[g.listvalue]);q.push(r)}else{var u=[];u.push(n);u.push(l[g.list][n]);q.push(u)}}n++});g.data=q;var m=g.plot;g.data=q;g.plot=null;var o=false;a.each(a.struts2_jquery_chart.charts[m.id],function(r,s){if(s&&s.id&&s.id==g.id){o=true;s.data=q}});if(!o){a.struts2_jquery_chart.charts[m.id].push(g)}a.plot(i,a.struts2_jquery_chart.charts[m.id],m)}if(g.onsuc){d.publishTopic(i,g.onsuc,c);d.publishTopic(i,g.onalw,c)}};if(g.href){f.url=g.href;f.data="";if(g.hrefparameter){f.data=g.hrefparameter}if(g.requesttype){f.type=g.requesttype}else{f.type="POST"}if(g.formids&&f.data===""){if(!d.loadAtOnce){d.require("js/plugins/jquery.form"+d.minSuffix+".js")}a.each(g.formids.split(","),function(c,k){var j=a(d.escId(k)).formSerialize();if(f.data!==""){f.data=f.data+"&"+j}else{f.data=j}})}f.dataType="json";if(!f.data){f.data={}}g.options=f;d.publishTopic(i,g.onalw,g);d.publishTopic(i,g.onbef,g);a.ajax(f)}})})(jQuery);